<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts/fby" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Mastering the Art of Filtering: An In-Depth Look at fby in KDB/Q | DefconQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://DefconQ.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://DefconQ.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://DefconQ.github.io/docs/concepts/fby"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Mastering the Art of Filtering: An In-Depth Look at fby in KDB/Q | DefconQ"><meta data-rh="true" name="description" content="Graffiti Filter Byfby"><meta data-rh="true" property="og:description" content="Graffiti Filter Byfby"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://DefconQ.github.io/docs/concepts/fby"><link data-rh="true" rel="alternate" href="https://DefconQ.github.io/docs/concepts/fby" hreflang="en"><link data-rh="true" rel="alternate" href="https://DefconQ.github.io/docs/concepts/fby" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://R6JV2N50EX-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="DefconQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="DefconQ Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E9ED09HNE3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-E9ED09HNE3",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="DefconQ" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.5860f28a.css">
<script src="/assets/js/runtime~main.de196548.js" defer="defer"></script>
<script src="/assets/js/main.f241a4c7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#74e8a3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Stay up to date with the latest blogs posts - subscribe to my free Substack newsletter now <a href="https://defconq.substack.com">Free Substack Newsletter</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="DefconQ Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="150" width="50"><img src="/img/logoLight.svg" alt="DefconQ Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="150" width="50"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Learn</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/about/about">About</a><a class="navbar__item navbar__link" href="/testimonials/testimonials">Testimonials</a><a class="navbar__item navbar__link" href="/cv/cv">CV</a><a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://defconq.myspreadshop.co.uk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Swag<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/DefconQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-study-roadmap">KDB/Q Study Roadmap</a><button aria-label="Expand sidebar category &#x27;KDB/Q Study Roadmap&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-language">KDB/Q Language</a><button aria-label="Expand sidebar category &#x27;KDB/Q Language&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdb-architecture">KDB Architecture</a><button aria-label="Expand sidebar category &#x27;KDB Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/important-concepts">Important Concepts</a><button aria-label="Collapse sidebar category &#x27;Important Concepts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/attributes">Attributes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/memoryManagement">Memory Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/garbageCollection">Garbage Collection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/amend">Amend, Amend At: The Swiss Army knife among KDB/Q operators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/dictionariesTables">Dictionaries and Tables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/qsql">QSQL - Querying Your Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/concepts/fby">Mastering the Art of Filtering: An In-Depth Look at fby in KDB/Q</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/functionalSelect">Embracing Terseness: Functional Forms and Parse Trees</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/joins">Joins: Connecting the Dots for Data Clarity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/iterators">Iterators: Navigating Vectors Without the Need for Loops</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/tutorials">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/productivity-tools">Productivity Tools</a><button aria-label="Expand sidebar category &#x27;Productivity Tools&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/important-concepts"><span itemprop="name">Important Concepts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Mastering the Art of Filtering: An In-Depth Look at fby in KDB/Q</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Mastering the Art of Filtering: An In-Depth Look at <code>fby</code> in KDB/Q</h1>
<p><img decoding="async" loading="lazy" alt="Graffiti Filter Byfby" src="/assets/images/fbyGraffiti-4daae07c1fa8f6a53b6d24d1813de170.png" width="1024" height="1024" class="img_ev3q"></p>
<p>In my previous blog post, I gave you an in-depth exploration of <a href="https://www.defconq.tech/docs/concepts/qsql" target="_blank" rel="noopener noreferrer">Q-SQL</a> and how to effectively query your data. However, I deliberately left out one crucial function: <code>fby</code>, or Filter-by. There are two reasons for this. Firstly, the post turned out to be much longer than anticipated, and I didn’t want to overload you with too much technical detail. Secondly, I believei <code>fby</code> deserves its own dedicated post. It&#x27;s a powerful operator that highlights what makes KDB/Q so exceptional when working with big data and time series. After this walkthrough, I hope you&#x27;ll agree. So, without further ado, let&#x27;s dive in!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="syntax">Syntax<a href="#syntax" class="hash-link" aria-label="Direct link to Syntax" title="Direct link to Syntax">​</a></h2>
<p><img decoding="async" loading="lazy" alt="Filter By fby Syntax" src="/assets/images/fby-6965ec8d87dce82ead07cc4e8b70d981.png" width="600" height="370" class="img_ev3q"></p>
<p>The syntax of <code>fby</code>, like (almost)  all KDB/Q, is terse and efficient. <code>fby</code> is a binary operator with a parse tree on the left side. Inside parentheses, you specify an aggregation function and the column to which it&#x27;s applied. Following that is the <code>fby</code> keyword, and finally, the column to group by as the right argument to <code>fby</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(faggr;col) fby g</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>where</p>
<ul>
<li><strong>faggr</strong>: is an aggregate function</li>
<li><strong>col</strong>: is the column the aggregation function will be applied to</li>
<li><strong><code>fby</code></strong>: is the keyword of the Filter-by operator</li>
<li><strong>g</strong>: is the column to be grouped by</li>
</ul>
<p>So, what does <code>fby</code> actually do? It applies an aggregation function to a list (or a column in the case of a table) based on groups that are formed from another list (or column).</p>
<p>Let’s approach this from a practical standpoint—after all, a single line of KDB/Q code speaks louder than a thousand words.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fby-in-the-where-clause-powerful-filtering"><code>fby</code> in the <code>where clause</code>: Powerful filtering<a href="#fby-in-the-where-clause-powerful-filtering" class="hash-link" aria-label="Direct link to fby-in-the-where-clause-powerful-filtering" title="Direct link to fby-in-the-where-clause-powerful-filtering">​</a></h2>
<p>The most frequent application of the <code>fby</code> operator is within the where clause of a Q-SQL statement. However, as we’ll discover, <code>fby</code> isn’t restricted to the where clause or even solely to Q-SQL queries—it has broader applications. To ease into the topic and gradually build our understanding, let&#x27;s first explore the application of <code>fby</code> within a where clause.</p>
<p>For demonstration purposes, we&#x27;ll use our <code>trade</code> table again, so let&#x27;s quickly set it up.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)show trade:([] sym:20?`AAPL`GOOG`IBM`MSFT;price:20?100.; quantity:20?1000;exchange:20?`LSE`NASDAQ`CBOE`NYSE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 88.31223 111      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 18.9679  859      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 28.81915 496      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 74.06357 181      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 55.38304 79       NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 50.61626 256      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 14.55868 986      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 38.43624 593      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 25.1761  520      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  33.85685 67       NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  44.10267 181      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  43.60838 682      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  72.47827 763      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 53.51104 105      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 34.38456 951      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, suppose you want to identify all trade records where the price at which a certain stock was traded is greater than or equal to its average price. A basic KDB/Q approach would involve first using an update statement to calculate the average price for each stock and then updating our table accordingly. Following that, we would execute a second query to select all records where the price meets or exceeds the corresponding average price of that stock. The KDB/Q code below demonstrates this inefficient method.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select from (update avgPrice:avg price by sym from trade) where price&gt;=avgPrice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange avgPrice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 88.31223 111      NASDAQ   52.54071</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 74.06357 181      LSE      52.54071</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 55.38304 79       NASDAQ   54.16467</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  44.10267 181      LSE      40.50052</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  43.60838 682      CBOE     40.50052</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  72.47827 763      LSE      40.50052</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.02194 628      LSE      54.16467</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 86.62585 715      LSE      47.0074</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 74.29183 833      NASDAQ   47.0074</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As shown in the output above, the <code>avgPrice</code> column has been updated with the average stock price for each corresponding stock, which is why you see the same price repeated multiple times. However, with the incredible capabilities of the <code>fby</code> operator, we can accomplish all of this in a single query.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where price&gt;=(avg;price) fby sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 88.31223 111      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 74.06357 181      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 55.38304 79       NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  44.10267 181      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  43.60838 682      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  72.47827 763      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.02194 628      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 86.62585 715      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 74.29183 833      NASDAQ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Can we be certain that both queries yield the same result? Let&#x27;s check. Since our first, more verbose approach adds a new column to the table, we&#x27;ll need to remove it before comparing it to the output of our second query.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)(select from trade where price&gt;=(avg;price) fby sym)~delete avgPrice from select from (update avgPrice:avg price by sym from trade) where price&gt;=avgPrice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As expected, the results match perfectly.</p>
<p>You can also group by multiple columns using the <code>fby</code> operator, although the syntax is a bit different from what we’re used to. All you need to do is create an anonymous table with the columns you want to group by. The example below illustrates this concept for better understanding.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where price&gt;(avg;price) fby ([] sym;exchange)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 74.06357 181      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 55.38304 79       NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  33.85685 67       NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  72.47827 763      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 34.38456 951      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.02194 628      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 74.29183 833      NASDAQ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-magic-of-fby-exposed">The Magic of <code>fby</code> exposed<a href="#the-magic-of-fby-exposed" class="hash-link" aria-label="Direct link to the-magic-of-fby-exposed" title="Direct link to the-magic-of-fby-exposed">​</a></h2>
<p>As we&#x27;ve seen, the <code>fby</code> operator is quite powerful. In this section, we&#x27;ll dive deeper into how <code>fby</code> operates under the hood by examining some <code>k</code> code. That&#x27;s right; we’ll be looking at the underlying language of <code>q</code>, which is <code>k</code>, the <code>K</code> in KDB/Q. This exploration is purely for illustrative purposes to help you understand the the mechanics behind the scenes. I do not recommend writing <code>k</code> code for your projects, and I strongly advise against using it in a production environment, as <code>k</code> code is not supported by KX, as noted <a href="https://code.kx.com/q/basics/exposed-infrastructure/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>Now, before we start, we need to quickly review two things: First, how can we obtain the underlying <code>k</code> code for <code>fby</code>? It&#x27;s quite simple. For any operator that reveals its underlying <code>k</code> code, ou just need to type the operator into your <code>q</code> console and hit enter, and the <code>k</code> code will be displayed. Let&#x27;s give it a try.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">k){$[(#x 1)=#y;@[(#y)#x[0]0#x 1;g;:;x[0]&#x27;x[1]g:.=y];&#x27;`length]}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The preceding <code>k)</code> indicates that what is being displayed is K code.</p></div></div>
<p>Next, we need to clarify an important point: Like <code>q</code>, <code>k</code> has a wide range of overloaded functions—actually, even more than <code>q</code>. Most unary functions in <code>k</code> have a corresponding overloaded binary version. To distinguish the unary version from the binary version, <code>q</code> displays <code>k</code> code with a <code>:</code>. Let’s take a look at an example: the <code>k</code> code for the <code>q</code> keyword <code>flip</code>, which is a unary function, is <code>+:</code>, as shown below.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)flip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Great! Let&#x27;s demystify <code>fby</code>. To do so, we only need to convery four <code>q</code> functions into <code>k</code> code: <code>count</code>, <code>group</code>, <code>value</code>, and the iterator <code>each</code>. The cooresponding <code>k</code> code is as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)each</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k){x&#x27;y}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)fby</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k){$[(#x 1)=#y;@[(#y)#x[0]0#x 1;g;:;x[0]&#x27;x[1]g:.=y];&#x27;`length]}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, let’s begin. The first part of <code>fby</code> is a plain, simple <a href="https://code.kx.com/q/ref/cond/" target="_blank" rel="noopener noreferrer"><code>$</code></a> conditional statement. The syntax of this conditional is simple: we evaluate a condition, and if it’s true, we proceed with the true branch of the statement; if it’s false, we continue with the false branch.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)$[0b;`true;`false]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)$[1b;`true;`false]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The condition we evaluate is a basic comparison: we check whether the length of the <code>x</code> parameter of <code>fby</code> matches the length of the <code>y</code> parameter of <code>fby</code>. Let’s take a moment to examine the <code>fby</code> statement on its own, outside of the Q-SQL <code>where clause</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)(avg;trade`price) fby trade`sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">52.54071 52.54071 52.54071 52.54071 54.16467 54.16467 47.0074 54.16467 47.0074 40.50052 40.50052 40.50052 40.50052 54.16467 47.0074 54.16467 47.0074 40.50052 47.0074 54.16467</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can generalise the above code using the parameters <code>x</code> and <code>y</code>, resulting in the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x fby y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>where <code>x</code> is a list with the first element being an aggregation function and the second element being a list (when used in a <code>where clause</code>, this would typically refer to a column by its name). Meanwhile, <code>y</code> is a list of values to group by (similarly, in a <code>where clause</code>, this would refer to a column).</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)show x:(avg;trade`price)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">avg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">88.31223 18.9679 28.81915 74.06357 55.38304 50.61626 14.55868 38.43624 25.1761 33.85685 44.10267 43.60838 72.47827 53.51104 34.38456 78.02194 86.62585 8.456454 74.29183 49.01948</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)show y:trade`sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`AAPL`AAPL`AAPL`AAPL`MSFT`MSFT`GOOG`MSFT`GOOG`IBM`IBM`IBM`IBM`MSFT`GOOG`MSFT`GOOG`IBM`GOOG`MSFT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Therefore, we basically compare the length of our price list with the length of our symbol list. If they match, we proceed with the execution of the <code>fby</code> function. If they don&#x27;t, a <code>length</code> error is thrown.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)k)(#x 1)=#y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// above k code translated to q code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)count[x 1]=count y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>There are two ways to test <code>k</code> code in a <code>q</code> console. You can either enter a single backslash <code>\</code> to switch to the <code>k</code> interpreter or prepend your code with <code>k)</code> to run it directly as <code>k</code> code.</p></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// For reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)fby</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k){$[(#x 1)=#y;@[(#y)#x[0]0#x 1;g;:;x[0]&#x27;x[1]g:.=y];&#x27;`length]}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, we encounter the <a href="https://www.defconq.tech/docs/concepts/amend" target="_blank" rel="noopener noreferrer">Amend At <code>@</code></a> operator, one of the most powerful tools in KDB/Q. If you&#x27;re not fully familiar with it, I highly recommend revisiting its functionality in my previous <a href="https://www.defconq.tech/docs/concepts/amend" target="_blank" rel="noopener noreferrer">blog post</a>. <code>Amend At @</code> is heavily overloaded, and in this case, we&#x27;re looking at the version that takes four parameters and uses the binary function <a href="https://code.kx.com/q/ref/assign/" target="_blank" rel="noopener noreferrer"><code>assign :</code></a> to modify values in place. One key detail to remember is that KDB/Q&#x27;s <a href="https://www.defconq.tech/blog/The%20Magnificent%20Seven%20-%20Mastering%20KDB/Q%20Concepts%20for%20Data%20Excellence#left-of-right-and-no-operator-precedence" target="_blank" rel="noopener noreferrer">left-to-right</a> evaluation applies even within the <code>Amend At @</code> operator, meaning the expressions inside the square brackets are evaluated from right to left. So, let&#x27;s follow this flow step by step.</p>
<p>First, we have <code>.=y</code> which perfectly illustrates the power of KDB/Q—just three simple characters accomplish so much. Translating the <code>k</code> code into <code>q</code>, this becomes <code>value group y</code>, which is a bit more verbose than its <code>k</code> counterpart. Let&#x27;s break it down further, starting from the right. We first <a href="https://code.kx.com/q/ref/group/" target="_blank" rel="noopener noreferrer"><code>group</code></a> the values of <code>y</code> (our list of symbols) into a dictionary, mapping each unique symbol to its corresponding indices. Since we only care about the indices, we use the <a href="https://code.kx.com/q/ref/value/" target="_blank" rel="noopener noreferrer"><code>value</code></a> operator to extract the dictionary&#x27;s values and assign them to the variable <code>g</code>. These indices will then be used in the <code>Amend At @</code> operator.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)k)=y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 0 1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 4 5 7 13 15 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 6 8 14 16 18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 9 10 11 12 17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)k).=y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 5 7 13 15 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 8 14 16 18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 10 11 12 17</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, above <code>k</code> code can easily be translated into <code>q</code> code.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)group y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 0 1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 4 5 7 13 15 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 6 8 14 16 18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 9 10 11 12 17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)value group y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 5 7 13 15 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 8 14 16 18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 10 11 12 17</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We then use the indices stored in <code>g</code> to access the corresponding elements in our list of prices. Remember, the parameter <code>x</code> is a tuble <code>x:(avg;trade</code>price)`, where the first element is an aggregation function and the second element is the list (in this case, the list of prices).</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)k)x[1]g:.=y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">88.31223 18.9679 28.81915 74.06357</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55.38304 50.61626 38.43624 53.51104 78.02194 49.01948</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">14.55868 25.1761 34.38456 86.62585 74.29183</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">33.85685 44.10267 43.60838 72.47827 8.456454</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this case, there is no difference between the <code>k</code> code and the corresponding <code>q</code> code - indexing follows the exact same syntax in both languages.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)x[1]g:value group y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">88.31223 18.9679 28.81915 74.06357</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55.38304 50.61626 38.43624 53.51104 78.02194 49.01948</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">14.55868 25.1761 34.38456 86.62585 74.29183</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">33.85685 44.10267 43.60838 72.47827 8.456454</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The code snippet above demonstrates another important lesson in KDB/Q: when indexing with a nested list, such as the indexes stored in <code>g</code>, the resulting list will conform to the structure of the index list. In other words, the shape of the result matches the shape of the index list. This concept is also emphasized in <a href="https://code.kx.com/q4m3/3_Lists/" target="_blank" rel="noopener noreferrer"><em>Q for Mortals, Chapter 3 - Lists</em></a> under section <a href="https://code.kx.com/q4m3/3_Lists/#393-indexing-with-nested-lists" target="_blank" rel="noopener noreferrer">3.9.3 Indexing with Nested Lists</a></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 5 7 13 15 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 8 14 16 18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 10 11 12 17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)x[1]g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">88.31223 18.9679 28.81915 74.06357</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55.38304 50.61626 38.43624 53.51104 78.02194 49.01948</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">14.55868 25.1761 34.38456 86.62585 74.29183</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">33.85685 44.10267 43.60838 72.47827 8.456454</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)count each g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 6 5 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)count each x[1]g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 6 5 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)type g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)type x[1]g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We then apply the aggregation function stored in <code>x[0]</code>, which is the first element of our tuple, to the elements retrieved by indexing into the list. Since our indexes form a nested list, we need to use an iterator to apply the function to each sublist within our list of prices, as it’s structured as a list of lists. In this case, we are leveraging the <a href="https://code.kx.com/q/ref/maps/#each" target="_blank" rel="noopener noreferrer"><strong>each</strong> <code>&#x27;</code></a>  operator.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)k)x[0]&#x27;x[1]g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">52.54071 54.16467 47.0074 40.50052</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// converting to q code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)x[0] each x[1]g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">52.54071 54.16467 47.0074 40.50052</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)x[0]@&#x27;x[1]g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">52.54071 54.16467 47.0074 40.50052</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see from the code above, <code>k</code> and <code>q</code> are nearly identical. The only small difference is the fact that you need to use the keyword <a href="https://code.kx.com/q/ref/maps/#each" target="_blank" rel="noopener noreferrer"><code>each</code></a>, since our aggregate function is a unary operator. If you prefer using the <code>each</code> glyph, you can apply some syntactic sugar by combining the <a href="https://code.kx.com/q/ref/overloads/#at" target="_blank" rel="noopener noreferrer"><code>@</code></a> operator with the <code>&#x27;</code> symbol.</p>
<p>Since our aggregation function is <a href="https://code.kx.com/q/ref/avg/#avg" target="_blank" rel="noopener noreferrer"><code>avg</code></a>, we are computing the average for each sublist, and return the result as a list. Below code illustrates this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)avg each x[1] g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">52.54071 54.16467 47.0074 40.50052</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// for reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)x[1] g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">88.31223 18.9679 28.81915 74.06357</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55.38304 50.61626 38.43624 53.51104 78.02194 49.01948</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">14.55868 25.1761 34.38456 86.62585 74.29183</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">33.85685 44.10267 43.60838 72.47827 8.456454</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// You could manually compute each average</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)avg (x[1] g) 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">52.54071</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)avg (x[1] g) 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">54.16467</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)avg (x[1] g) 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">47.0074</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)avg (x[1] g) 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">40.50052</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Alright, so far so good. Now that we understand the final expression in the <code>Amend At @</code> operator (the fourth parameter), the remaining task is simply to use these values as the right operand in the function defined by the third parameter, which is <code>assign :</code> in our case. As the left operand for <code>assign :</code>, we use the elements at index <code>g</code>, specified in the second parameter of the <code>Amend At @</code> operator. Does it sound complicated? Let&#x27;s break it down. If you&#x27;d like a refresher on the <code>Amend At @</code> operator, you can check out my blog post <a href="https://www.defconq.tech/docs/concepts/amend" target="_blank" rel="noopener noreferrer">here</a>. As a quick reminder, here&#x27;s the syntax for using Amend At with a binary function:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@[d; i; v; vy]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>where</p>
<ul>
<li><code>d</code> is an atom, list, or a dictionary (value); or a handle to a list, dictionary or datafile</li>
<li><code>i</code> indexes where d is to be amended</li>
<li><code>v</code> is a binary function</li>
<li><code>vy</code> is the right domain of <code>v</code>, the right parameter</li>
</ul>
<p>It feels quite theoretical, doesn&#x27;t it? Let&#x27;s bring it to life with a practical example applied to our use case. To simplify things a bit, we know that our list of prices contains 20 elements, so we can simulate this using a list of natural numbers from 0 to 19.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Our prices ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)x 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">88.31223 18.9679 28.81915 74.06357 55.38304 50.61626 14.55868 38.43624 25.1761 33.85685 44.10267 43.60838 72.47827 53.51104 34.38456 78.02194 86.62585 8.456454 74.29183 49.01948</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ... contain 20 elements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)count x 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// the indexes we calculated in the last part of the Amend At @ operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 5 7 13 15 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 8 14 16 18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 10 11 12 17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// we raze them</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)raze g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3 4 5 7 13 15 19 6 8 14 16 18 9 10 11 12 17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// and sort them in ascending order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)asc raze g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`s#0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Which corresponds to the natural numbers from 0 to 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)til 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)til[20]~asc raze g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can index into the list of natural numbers using the indexes stored in the variable <code>g</code>. Since <code>g</code> is a nested list containing four sublists, we need four values as the right argument to the assign function when using <code>Amend At @</code> with those indexes. The elements at the indexes of the first sublist will take the first value, those in the second sublist will take the second value, and so on. Let&#x27;s walk through this step by step.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Index into our list of natural numbers from 0 to 19 using the indexes stored in variable g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)til[20] g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 5 7 13 15 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 8 14 16 18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 10 11 12 17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// this can be rewritten using Applt At @</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)@[til 20;g]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 5 7 13 15 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 8 14 16 18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 10 11 12 17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Verify that above code is actually the same</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)@[til 20;g]~til[20] g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Now, let&#x27;s use Apply At to assign the values 1,2,3,4 to the elemtns at index g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)@[til 20;g;:;1 2 3 4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 1 1 1 2 2 3 2 3 4 4 4 4 2 3 2 3 4 3 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// We index into the list using g to highlight what happened</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)@[til 20;g;:;1 2 3 4] g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 1 1 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 2 2 2 2 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 3 3 3 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 4 4 4 4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As shown in the previous example, we replaced all values at the indexes of the first sublist with the value 1, all elements of the second sublist with the value 2, and so on, using the assignment operator. Breaking it down step by step, the process would look like this:</p>
<p>First, we replace all elements at the indexes of the first sublist with the value 1. To better illustrate the behavior, we use the variable <code>g</code> to group the elements by sublists again.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)@[til 20;g[0];:;1] g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 1 1 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 5 7 13 15 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 8 14 16 18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 10 11 12 17</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, we replace all elements at the indexes of the second sublist with the value 2.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)@[til 20;g[1];:;2] g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 2 2 2 2 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 8 14 16 18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 10 11 12 17</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then we replace all elements at the indexes of the third sublist with the value 3.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)@[til 20;g[2];:;3] g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 5 7 13 15 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 3 3 3 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 10 11 12 17</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, we replace all elements at the indexes of the fourth sublist with the value 4.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)@[til 20;g[3];:;4] g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 5 7 13 15 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 8 14 16 18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 4 4 4 4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Excellent! Now, the final step is to understand what&#x27;s happening in the first expression of the <code>Amend At @</code> operator. Let&#x27;s take a closer look at its role and what it accomplishes.</p>
<p>Remember, <code>x[0]</code> was our aggregation function, <code>x[1]</code> the list of prices and <code>y</code> the list of symbols, as well as the function <code>count</code> being defined as <code>#</code> in <code>k</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)k)x 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">88.31223 18.9679 28.81915 74.06357 55.38304 50.61626 14.55868 38.43624 25.1761 33.85685 44.10267 43.60838 72.47827 53.51104 34.38456 78.02194 86.62585 8.456454 74.29183 49.01948</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)x 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">avg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`AAPL`AAPL`AAPL`AAPL`MSFT`MSFT`GOOG`MSFT`GOOG`IBM`IBM`IBM`IBM`MSFT`GOOG`MSFT`GOOG`IBM`GOOG`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)count </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>What this expression does is first take 0 elements from our list of prices, resulting in an empty list. Then, it applies the aggregation function, which is average <code>avg</code> in our case, to this empty list, returning the corresponding null value for the data type of the list. Next, it retrieves the length of our second parameter, <code>y</code> (the list of symbols in this case), and produces a list with the same number of null elements as there are elements in <code>y</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)k)(#y)#x[0]0#x 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Translating above into <code>q</code> results in the following code</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)(count y)#x[0]0#x 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n 0n</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To be completely honest, I&#x27;m not entirely sure why this step is necessary. Amending the initial price list with the new values should achieve the same result. However, I&#x27;m certain there must be a valid reason for it that I&#x27;m not seeing yet. Believe it or not, there are still plenty of KDB/Q concepts I haven&#x27;t fully grasped either. Just like you, I&#x27;m constantly learning and discovering new things every day.</p>
<p>This concludes our little exploration of the magic behind <code>fby</code> and the world of <code>k</code> code. As I mentioned earlier, I strongly advise against using <code>k</code> n a production environment. However, gaining insight into what&#x27;s happening behind the scenes can enhance your understanding of KDB/Q and make you a better developer.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fby-beyond-the-where-clause"><code>fby</code> beyond the <code>where clause</code><a href="#fby-beyond-the-where-clause" class="hash-link" aria-label="Direct link to fby-beyond-the-where-clause" title="Direct link to fby-beyond-the-where-clause">​</a></h2>
<p>Now that we’ve uncovered the magic behind <code>fby</code>, et’s take it a step further. If you thought that fby could only be used in the <code>where clause</code> of a Q-SQL query, think again. Its power extends far beyond that! In fact, <code>fby</code> can also be used within the <code>column phrase</code> of a Q-SQL query. Drawing inspiration from a solution provided by <a href="https://www.linkedin.com/in/attila-vrabecz-b948a52/" target="_blank" rel="noopener noreferrer">Attila Vrabecz</a>  to one of the <a href="https://www.linkedin.com/pulse/weekly-quest-14-smoothing-curve-habla-computing-xanxf/?trackingId=r1iQTrlaPQcJR6VUAwc37Q%3D%3D" target="_blank" rel="noopener noreferrer">coding challenges</a> set by my friends at <a href="https://www.linkedin.com/company/habla-computing/posts/?feedView=all" target="_blank" rel="noopener noreferrer">Habla Computing</a> in Madrid, we’re going to explore how to leverage the <code>fby</code> operator in the <code>column phrase</code>. Let&#x27;s first have a look at the challenge and its setup:</p>
<p>The challenge is as follows (full details can be found <a href="https://www.linkedin.com/pulse/weekly-quest-14-smoothing-curve-habla-computing-xanxf/?trackingId=r1iQTrlaPQcJR6VUAwc37Q%3D%3D" target="_blank" rel="noopener noreferrer">here</a>):
<em><strong>To face this task we will receive a table with price observations for multiple assets over time, the goal is to compute the midpoint between the previous and current Price for each asset.</strong></em></p>
<p><strong>Input</strong>: Prices Table: with columns for asset, time and prices.</p>
<p><strong>Output</strong>: Table: with the column prices updated with the midpoint values, except for the first row of each asset.</p>
<p><strong>Example:</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t:([] asset: `AMZN`GOOG`AMZN`AAPL`AMZN; time: 10:43 12:02 12:38 12:54 15:55; price: 108.244 103.9113 103.8967 102.5633 101.1562)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">asset time  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  10:43 108.244</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG  12:02 103.9113</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  12:38 106.0703</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL  12:54 102.5633</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  15:55 102.5265</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When I first reviewed the challenge, it was clear that the solution involved calculating a simple rolling window average with a range of 2. Here&#x27;s the solution I came up with:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)update 2 mavg price by asset from t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">asset time  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  10:43 108.244</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG  12:02 103.9113</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  12:38 106.0703</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL  12:54 102.5633</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  15:55 102.5264</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>However, Attila&#x27;s solution was not only more elegant but also twice as fast as my initial approach or any of the other solutions submitted by others. Let&#x27;s take a look at Attila&#x27;s approach.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// for length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f:{@[x;`price;fby[;x`asset](2 mavg;)@]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// for speed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f:{@[x;`price;fby[;x`asset]({.5*first[x]+&#x27;:x};)@]}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>While Attila leverages the <code>Amend At @</code> operator in conjunction with the <code>fby</code> operator, we can alternatively rewrite this as a pure Q-SQL statement:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// first function rewritten to a Q-SQL statement </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)update price:(2 mavg;price) fby asset from t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">asset time  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  10:43 108.244</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG  12:02 103.9113</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  12:38 106.0703</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL  12:54 102.5633</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  15:55 102.5264</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// first function rewritten to a Q-SQL statement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)update price:({0.5*first[x]+&#x27;:x};price) fby asset from t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">asset time  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  10:43 108.244</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG  12:02 103.9113</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  12:38 106.0703</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL  12:54 102.5633</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  15:55 102.5264</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(update 2 mavg price by asset from t)~update price:(2 mavg;price) fby asset from t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(update 2 mavg price by asset from t)~update price:({0.5*first[x]+&#x27;:x};price) fby asset from t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fby-beyond-q-sql"><code>fby</code> beyond Q-SQL<a href="#fby-beyond-q-sql" class="hash-link" aria-label="Direct link to fby-beyond-q-sql" title="Direct link to fby-beyond-q-sql">​</a></h2>
<p>As shown in the code above, you can use <code>fby</code> outside of a <code>where clause</code>. But what is even more impressive, as demonstrated by Attila&#x27;s code, is the fact that you can use <code>fby</code> without a Q-SQL statement altogether. Let’s break down the code in more detail.</p>
<p>We start with the first function:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)f:{@[x;`price;fby[;x`asset](2 mavg;)@]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)f t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">asset time  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  10:43 108.244</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG  12:02 103.9113</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  12:38 106.0703</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL  12:54 102.5633</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN  15:55 102.5264</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(update 2 mavg price by asset from t)~f t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Attila utilized the ternary version of the <code>Amend At @</code> operator to update the prices in the table by using the <code>fby</code> operator as the function within <code>Amend At @</code>. Since <code>fby</code> is a binary operator, and the ternary version of <code>Amend At @</code> requires a unary function, he addressed this by transforming the binary <code>fby</code> into a unary function through the composition of two projections. First, he created a projection on a list of <code>(2 mavg;)@</code>, and then another on <code>fby[; x`asset]</code>. By composing these projections, he formed a unary function. In KDB/Q, composition follows the mathematical principle: given two functions, <code>f</code> and <code>g</code>, composition operator creates a new function <code>h(x) = (g ∘ f)(x) = g(f(x))</code>, meaning that <code>g</code> is applied after <code>f</code> has been applied to <code>x</code>. You can learn more about composition <a href="https://code.kx.com/q/ref/apply/#composition" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>The second function is quite similar to the first, but with a slight variation. Although it uses more characters, it’s faster. This is due to the optimization where multiplication is used instead of division—multiplying by <code>0.5</code> is quicker than using the <code>avg</code> operator to calculate the average of two numbers. Additionally, we see the use of the <a href="https://code.kx.com/q/ref/maps/#each-prior" target="_blank" rel="noopener noreferrer"><code>each prior &#x27;:</code></a> iterator. This iterator applies a binary function between each item in a list and its preceding item. A good example of its application can be seen in the <code>deltas</code> function.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)deltas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-&#x27;:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The first item in a list, by definition, has no preceding item. When the derived function is applied as a binary function, the left argument serves as the &quot;seed&quot;—the value that precedes the first item. If the derived function is applied as a unary function (as with <code>deltas</code> or <code>+&#x27;:</code>), and the operator has an identity element recognized by q, that element will be used as the seed. In this case, we need to provide the initial left argument, which is <code>first[x]</code>. Beyond that, everything else operates just as it does in the first function.</p>
<p>I hope this blog post has helped you gain a deeper understanding of <code>fby</code> and the mechanics behind it. If you enjoy my content, consider subscribing to my newsletter—it&#x27;s completely free! Subscribe <a href="https://defconq.substack.com/" target="_blank" rel="noopener noreferrer">here</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/concepts/qsql"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">QSQL - Querying Your Data</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/concepts/functionalSelect"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Embracing Terseness: Functional Forms and Parse Trees</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#syntax" class="table-of-contents__link toc-highlight">Syntax</a></li><li><a href="#fby-in-the-where-clause-powerful-filtering" class="table-of-contents__link toc-highlight"><code>fby</code> in the <code>where clause</code>: Powerful filtering</a></li><li><a href="#the-magic-of-fby-exposed" class="table-of-contents__link toc-highlight">The Magic of <code>fby</code> exposed</a></li><li><a href="#fby-beyond-the-where-clause" class="table-of-contents__link toc-highlight"><code>fby</code> beyond the <code>where clause</code></a></li><li><a href="#fby-beyond-q-sql" class="table-of-contents__link toc-highlight"><code>fby</code> beyond Q-SQL</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Learn</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/defconq/" target="_blank" rel="noopener noreferrer" class="footer__link-item">DefconQ Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/alexanderunterrainer/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Alexander Unterrainer Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://defconq.myspreadshop.co.uk" target="_blank" rel="noopener noreferrer" class="footer__link-item">DefconQ Swag<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://www.youtube.com/@DefconQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube Channel<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/DefconQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 DefconQ Ltd. This website is maintained by Alexander Unterrainer. Disclaimer: All content shared on this website reflect solely his personal thoughts and opinions, and is not representative of any past, current, or future employers or affiliations.</div></div></div></footer></div>
</body>
</html>