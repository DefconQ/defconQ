<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts/qsql" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">QSQL - Querying Your Data | DefconQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://DefconQ.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://DefconQ.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://DefconQ.github.io/docs/concepts/qsql"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="QSQL - Querying Your Data | DefconQ"><meta data-rh="true" name="description" content="In our latest blog post, we&#x27;ve covered a lot about Dictionaries and Tables and explored how to store large volumes of data. Now, it&#x27;s time to take the next step and dive into how we can access this data. How do we query it, filter for what we need, and manipulate the information to gain valuable insights? Just like other databases, KDB/Q comes with its own built-in querying language: Q-SQL. Contrary to popular belief, I find Q-SQL easier to use than traditional SQL, and it&#x27;s significantly more performant. Thanks to KDB/Q&#x27;s column-oriented database structure, which stores data as collections of lists rather than rows and keeps columns in contiguous memory, it&#x27;s perfectly optimized for vectorized operations, delivering near-instant results. In this blog post, we&#x27;ll explore the key concepts of the Q-SQL query language and how you can effectively access your data."><meta data-rh="true" property="og:description" content="In our latest blog post, we&#x27;ve covered a lot about Dictionaries and Tables and explored how to store large volumes of data. Now, it&#x27;s time to take the next step and dive into how we can access this data. How do we query it, filter for what we need, and manipulate the information to gain valuable insights? Just like other databases, KDB/Q comes with its own built-in querying language: Q-SQL. Contrary to popular belief, I find Q-SQL easier to use than traditional SQL, and it&#x27;s significantly more performant. Thanks to KDB/Q&#x27;s column-oriented database structure, which stores data as collections of lists rather than rows and keeps columns in contiguous memory, it&#x27;s perfectly optimized for vectorized operations, delivering near-instant results. In this blog post, we&#x27;ll explore the key concepts of the Q-SQL query language and how you can effectively access your data."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://DefconQ.github.io/docs/concepts/qsql"><link data-rh="true" rel="alternate" href="https://DefconQ.github.io/docs/concepts/qsql" hreflang="en"><link data-rh="true" rel="alternate" href="https://DefconQ.github.io/docs/concepts/qsql" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://R6JV2N50EX-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="DefconQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="DefconQ Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E9ED09HNE3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-E9ED09HNE3",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="DefconQ" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.5860f28a.css">
<script src="/assets/js/runtime~main.eec8b97a.js" defer="defer"></script>
<script src="/assets/js/main.829d8a28.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#74e8a3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Stay up to date with the latest blogs posts - subscribe to my free Substack newsletter now <a href="https://defconq.substack.com">Free Substack Newsletter</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="DefconQ Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="150" width="50"><img src="/img/logoLight.svg" alt="DefconQ Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="150" width="50"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Learn</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/about/about">About</a><a class="navbar__item navbar__link" href="/testimonials/testimonials">Testimonials</a><a class="navbar__item navbar__link" href="/happyHour/happyHour">Happy Hour</a><a class="navbar__item navbar__link" href="/cv/cv">CV</a><a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://defconq.myspreadshop.co.uk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Swag<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/DefconQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-study-roadmap">KDB/Q Study Roadmap</a><button aria-label="Expand sidebar category &#x27;KDB/Q Study Roadmap&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-language">KDB/Q Language</a><button aria-label="Expand sidebar category &#x27;KDB/Q Language&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdb-architecture">KDB Architecture</a><button aria-label="Expand sidebar category &#x27;KDB Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/important-concepts">Important Concepts</a><button aria-label="Collapse sidebar category &#x27;Important Concepts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/attributes">Attributes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/memoryManagement">Memory Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/garbageCollection">Garbage Collection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/amend">Amend, Amend At: The Swiss Army knife among KDB/Q operators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/dictionariesTables">Dictionaries and Tables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/concepts/qsql">QSQL - Querying Your Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/fby">Mastering the Art of Filtering: An In-Depth Look at fby in KDB/Q</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/functionalSelect">Embracing Terseness: Functional Forms and Parse Trees</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/joins">Joins: Connecting the Dots for Data Clarity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/iterators">Iterators: Navigating Vectors Without the Need for Loops</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/ipc">Fundamentals of Interprocess Communication (IPC)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/ipcNextLevel">Beyond the Fundamentals: Next Level Interprocess Communications</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/tutorials">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/productivity-tools">Productivity Tools</a><button aria-label="Expand sidebar category &#x27;Productivity Tools&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/important-concepts"><span itemprop="name">Important Concepts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">QSQL - Querying Your Data</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>QSQL - Querying Your Data</h1>
<p>In our latest blog post, we&#x27;ve covered a lot about <a href="https://www.defconq.tech/docs/concepts/dictionariesTables" target="_blank" rel="noopener noreferrer">Dictionaries and Tables</a> and explored how to store large volumes of data. Now, it&#x27;s time to take the next step and dive into how we can access this data. How do we query it, filter for what we need, and manipulate the information to gain valuable insights? Just like other databases, KDB/Q comes with its own built-in querying language: <strong>Q-SQL</strong>. Contrary to popular belief, I find Q-SQL easier to use than traditional SQL, and it&#x27;s significantly more performant. Thanks to KDB/Q&#x27;s column-oriented database structure, which stores data as collections of lists rather than rows and keeps columns in contiguous memory, it&#x27;s perfectly optimized for vectorized operations, delivering near-instant results. In this blog post, we&#x27;ll explore the key concepts of the Q-SQL query language and how you can effectively access your data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-select-statement">The <a href="https://code.kx.com/q4m3/9_Queries_q-sql/#93-the-select-template" target="_blank" rel="noopener noreferrer"><code>select</code></a> Statement<a href="#the-select-statement" class="hash-link" aria-label="Direct link to the-select-statement" title="Direct link to the-select-statement">​</a></h2>
<p>The most common way to query your data is through the <code>select</code> statement, which can range from simple, basic queries to more advanced and powerful data retrieval. In the following section, we’ll discuss the syntax of the select statement and explore various methods for selecting data. Let’s get started!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="syntax">Syntax<a href="#syntax" class="hash-link" aria-label="Direct link to Syntax" title="Direct link to Syntax">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Q-SQL Select Statement Syntax" src="/assets/images/selectStatement-3eeb6fad448d510eabf30b878ffeef7b.png" width="1210" height="480" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> select &lt;columns phrase&gt; &lt;by phrase&gt; from T&lt;exp&gt; &lt;where phrase&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong><code>column(s) phrase</code>:</strong> This specifies the columns you want to select. You can use the column phrase to rename or aggregate columns.</li>
<li><strong><code>by phrase</code>:</strong> To group your data by specific column(s), you can use the <strong><code>by</code></strong> phrase to organize the results accordingly.</li>
<li><strong><code>T&lt;exp&gt;</code>:</strong> You can either select data directly from a specific table or use an expression as the data source for your select statement</li>
<li><strong><code>where phrase</code>:</strong> The where clause allows you to filter your dataset, narrowing it down to a smaller subset before making your (final) selection.</li>
</ul>
<p>It’s crucial to remember the order in which the individual clauses of a <code>select</code> statement are evaluated, particularly when optimizing queries for maximum efficiency. The evaluation order is as follows:</p>
<ol>
<li><strong>Texp</strong>: The first clause to be evaluated is the <strong><code>from T&lt;exp&gt;</code></strong> expression, which defines the data source. If this is a straightforward table, no evaluation is necessary, making it almost instantaneous. However, as previously mentioned, <code>T&lt;exp&gt;</code> can be any KDB/Q expression that returns a table.</li>
<li>The next step is the evaluation of the <strong>where phrase</strong>. This filters your data, starting with the leftmost condition and progressively narrowing down the dataset for subsequent conditions. You can significantly improve performance by prioritizing the most restrictive condition first. We’ll dive into this deeper later.</li>
<li>The <strong>by clause</strong> is evaluated next, grouping your data based on specific columns.</li>
<li>Lastly, the <strong>column phrase</strong> is executed, selecting the desired columns. You can also rename columns, perform calculations, or apply aggregations during this step.</li>
</ol>
<p>Let&#x27;s look at the individual phrases in more detail:</p>
<p>In order to demonstrate the various forms, we’ll create a simple <code>trade</code> table as an example.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)show trade:([] sym:20?`AAPL`GOOG`IBM`MSFT;price:20?100.; quantity:20?1000;exchange:20?`LSE`NASDAQ`CBOE`NYSE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 62.03014 296      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108 890      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  8.724017 407      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096 108      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  72.78528 652      LSE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>To keep this article concise, I will abbreviate table outputs where appropriate and where the full data isn&#x27;t crucial for understanding. Complete tables will be provided whenever necessary to maintain clarity and context.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="selecting-columns-the-columns-phrase">Selecting Columns: The column(s) phrase<a href="#selecting-columns-the-columns-phrase" class="hash-link" aria-label="Direct link to Selecting Columns: The column(s) phrase" title="Direct link to Selecting Columns: The column(s) phrase">​</a></h3>
<p>Let’s begin with a simple and straightforward query: selecting all columns from a table without any filters. If you’re familiar with SQL, this is the equivalent of the classic &quot;Hello World&quot; example for SQL, where you would write <code>SELECT * FROM trade</code> (<a href="https://www.w3schools.com/sql/sql_select.asp" target="_blank" rel="noopener noreferrer">SQL SELECT reference</a>) to return all columns using the <code>*</code> wildcard. But as <em><strong>KDB/Q developers, we prefer our code to be concise and terse</strong></em>. So, instead of the unnecessary <code>*</code>, we just write <code>select from trade</code>. Moreover, we don’t worry about capitalising our code either. Let’s try it out!</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Can we make it even more concise? Absolutely! Since a table is stored in a variable, we can just type <code>trade</code> in the KDB/Q console to return the entire table. But be careful:</p>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>Do <strong>NOT</strong> try this with a large table in a production environment! (Actually you shouldn&#x27;t have access to a production environment at all)</p></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Let&#x27;s make sure that the results actually match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)trade~select from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That was easy! Now, let’s take it up a notch. If we want to select only a few specific columns from our table, we can do this by simply listing the columns we’re interested in, separated by commas.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select sym,price from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That wasn&#x27;t too difficult either. Now, let&#x27;s try performing some calculations on our data. For example, if we want to calculate the nominal value for each row by multiplying the price column with the quantity column, here&#x27;s how we can do it.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select sym,price*quantity from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 3525.159</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 30541.73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  2616.029</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  331.3141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that KDB/Q will name the resulting column based on the first column it encounters in the calculation (in this case, price). You can rename the resulting column, as shown below. However, this is not an assignment— the original table remains unaltered. KDB/Q returns a copy of the data with the modifications applied.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select sym,nominal:price*quantity from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  nominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 3525.159</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 30541.73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  2616.029</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  331.3141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can choose to assign this result to a new variable or leave it as is, but the original table will stay unchanged.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)tradeNew:select sym,nominal:price*quantity from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)tradeNew</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  nominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 3525.159</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 30541.73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  2616.029</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  331.3141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>But that&#x27;s not all—Q-SQL offers far more capabilities, even at a basic level. Below are a few examples with brief explanations. While covering its full potential is beyond the scope of this article, you can explore more in-depth details in <a href="https://code.kx.com/q4m3/9_Queries_q-sql/" target="_blank" rel="noopener noreferrer"><em>Q for Mortals, Chapter 9: Queries-Q-SQL</em></a>. Here, I’ll focus on what I believe are the most important concepts.</p>
<p>You can select the same column multiple times, and KDB/Q will automatically append a suffix to any duplicate column names. If KDB/Q cannot determine a column name, it will default to using <code>x</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select sym,price,sym,3*price+1 from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    sym1 x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 MSFT 238.0106</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 GOOG 125.9868</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 MSFT 186.2645</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 MSFT 152.2948</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 IBM  125.6263</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>One important point to remember when writing Q-SQL queries is that any time you create, rename, update, or modify a column, the changes will only take effect after the entire Q-SQL statement has been executed. This means you cannot create a new column and immediately reuse it within the same statement. Let me illustrate this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select avgPrice:avg price, avgQty:avg quantity, nominal: avgPrice*avgQty from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;avgQty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [0]  select avgPrice:avg price, avgQty:avg quantity, nominal: avgPrice*avgQty from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                         ^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see from the error above, avgQty doesn&#x27;t exist yet. To achieve this, you have to use a second Q-SQL query like below:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select avgNominal:avgPrice*avgQty from select avgPrice:avg price, avgQty:avg quantity from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">avgNominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">19882.57</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Another useful feature of KDB/Q is the (hidden) virtual index, known as <code>i</code> column, which you can utilize in your Q-SQL queries. Because this index is referenced as <code>i</code>, it&#x27;s best to avoid using <code>i</code> as a column name. You can also incorporate the virtual index in the <code>where</code> clause of your Q-SQL queries (more details on this later). One important thing to note is that the virtual index is not generated when the table is created, but only when it is referenced. Each time you reference it, the index is recreated, which can affect query performance as your dataset grows. The below examples illustrate this in more details.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Create a table called trade1 consisting of the first 5 rows of trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Using the # take operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)show trade1:5#trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Selecting all columns including the virtal column i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select i,sym,price,quantity,exchange from trade1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Creating a subset of trade1 selecting only the last 3 rows using -3#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select i,sym,price,quantity,exchange from -3#trade1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 IBM  40.87545 64       CBOE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As shown in the last two examples above, when we select the virtual column <code>i</code> in the first example, the index ranges from 0 to 4. However, when we use the <code># take</code> operator to select the last three rows of <code>trade1</code> and then select the virtual index again, the index is updated. This demonstrates that the virtual column <code>i</code> is generated each time it is referenced.</p>
<p>Another powerful yet often overlooked feature of the <code>select</code> template is the <code>select [] from table</code> pattern. The expression within the square brackets allows you to select a subset of rows by specifying either a positive or negative number to retrieve the first or last <code>n</code> rows, respectively. You can also provide a start index <code>s</code> and the number <code>n</code> of rows you want to return. Additionally, it&#x27;s possible to sort the results in <strong>ascending or descending</strong> order based on a specific column. And, you can combine these features for even more flexibility. Let&#x27;s explore some examples.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Selecting the first 5 rows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select [5] from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Selecting the last 5 rows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select [-5] from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108 890      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  8.724017 407      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096 108      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  72.78528 652      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Starting at index 2, select 5 rows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select [2 5] i,sym,price,quantity,exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5 AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Select everything from trade in descending order by column sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select [&gt;sym] from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096 108      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  8.724017 407      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  72.78528 652      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108 890      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 62.03014 296      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Select everything from trade in ascending order by column price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select [&gt;price] i,sym,price,quantity,exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x  sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">11 AAPL 93.26316 216      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">18 MSFT 86.71096 108      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0  MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">19 IBM  72.78528 652      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7  GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10 AAPL 62.03014 296      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2  MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3  MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5  AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1  GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4  IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12 AAPL 27.47066 717      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">14 AAPL 25.60658 657      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">15 GOOG 23.10108 890      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8  AAPL 19.46509 850      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">17 MSFT 10.24432 635      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9  IBM  9.059026 241      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">16 IBM  8.724017 407      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">13 GOOG 5.752516 414      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6  IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Select a subset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select [2 5] i,sym,price,quantity,exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5 AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Combine subset selection with ordering</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select [2 5;&gt;price] i,sym,price,quantity,exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x  sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0  MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">19 IBM  72.78528 652      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7  GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10 AAPL 62.03014 296      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2  MSFT 61.08817 898      CBOE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>One important observation to note is when we combine selecting a subset of rows with sorting in descending order by price. The table is first sorted by price in descending order, but the virtual index <code>i</code> remains as if the table were still in its original order. Then, the subset is drawn, starting at position <code>s</code> and selecting <code>n</code> rows, without affecting the virtual index.</p>
<p>Attentive readers may have noticed that you can achieve the same result from the <code>select [5] from trade</code> pattern by using the <code># take</code> operator like <code>5#trade</code>. You might wonder why you should use the longer syntax when KDB/Q emphasizes brevity, and we&#x27;ve been advocating for concise code. This comes down to one of KDB/Q&#x27;s core concepts: code is interpreted right to left. (You can read more about key KDB/Q concepts in my blog post <a href="https://www.defconq.tech/blog/The%20Magnificent%20Seven%20-%20Mastering%20KDB/Q%20Concepts%20for%20Data%20Excellence" target="_blank" rel="noopener noreferrer">here</a>). Since KDB/Q interprets code right to left, <code>5#trade</code> first evaluates the entire <code>trade</code> table before selecting the first 5 rows. In contrast, <code>select [5] from trade</code> is optimized internally to directly take the first 5 rows without evaluating the entire table. This difference can significantly impact performance and memory usage, especially for large datasets. Therefore, it is recommended to use <code>select [n] from table</code> in production code rather than <code>5#table</code> for efficiency.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)(5#trade)~select [5] from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="nested-columns-handle-with-care">Nested Columns: Handle with Care<a href="#nested-columns-handle-with-care" class="hash-link" aria-label="Direct link to Nested Columns: Handle with Care" title="Direct link to Nested Columns: Handle with Care">​</a></h4>
<p>The final behavior I&#x27;d like to explain is how to work with nested columns. A nested column is one where each cell essentially contains a list of lists. KDB/Q tables are very powerful, allowing you to store nearly anything within them—but that&#x27;s a topic for another time. For now, let&#x27;s explore a table where two columns are nested, meaning they hold a list of lists. In our example, we&#x27;re examining a quote table that contains the first three levels of an order book, with three bid and three ask prices for each symbol and row.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)show quote:([] sym:`AAPL`MSFT`FB`GOOG; bid:(130+3?1.0;50+3?1.0;300+3?1.0;200+3?1.0); ask:(131+3?1.0;51+3?1.0;301+3?1.0;201+3?1.0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  bid                        ask</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 130.5632 130.0602 130.7008 131.012  131.6942 131.1428</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 50.87678 50.76479 50.85959 51.50566 51.97591 51.00381</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FB   300.8109 300.4545 300.8047 301.0912 301.5939 301.3439</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 200.6956 200.8063 200.1153 201.2325 201.3502 201.1478</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, let’s say we want to calculate the average bid and ask price for each symbol. A naive approach might be to simply apply the average <code>avg</code> operator to the bid and ask columns. However, it&#x27;s important to remember that each cell in these columns is a list, so we can&#x27;t directly apply the operator to them. Instead, we need to use an iterator to handle each cell individually. Here&#x27;s an example of how to do that:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Not using an iterator throws an error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select sym,bid,ask,avgBid:avg bid,avgAsk:avg ask from quote</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [0]  select sym,bid,ask,avgBid:avg bid,avgAsk:avg ask from quote</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select sym,bid,ask, avgBid:avg each bid,avgAsk:avg each ask from quote</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  bid                        ask                        avgBid   avgAsk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 130.5632 130.0602 130.7008 131.012  131.6942 131.1428 130.4414 131.283</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 50.87678 50.76479 50.85959 51.50566 51.97591 51.00381 50.83372 51.49513</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FB   300.8109 300.4545 300.8047 301.0912 301.5939 301.3439 300.69   301.343</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 200.6956 200.8063 200.1153 201.2325 201.3502 201.1478 200.5391 201.2435</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s look at this in more detail. First, we start by examining the <code>bid</code> column independently:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)quote`bid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">130.5632 130.0602 130.7008</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">50.87678 50.76479 50.85959</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">300.8109 300.4545 300.8047</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s go one step further, and use the <code>0N!</code> operator to inspect the column in even greater detail:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)0N!quote`bid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(130.5632 130.0602 130.7008;50.87678 50.76479 50.85959;300.8109 300.4545 300...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">130.5632 130.0602 130.7008</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">50.87678 50.76479 50.85959</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">300.8109 300.4545 300.8047</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">200.6956 200.8063 200.1153</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As shown above, the <code>bid</code> column is a nested list. Due to the <a href="https://www.defconq.tech/blog/The%20Magnificent%20Seven%20-%20Mastering%20KDB/Q%20Concepts%20for%20Data%20Excellence#kdbq-is-atomic" target="_blank" rel="noopener noreferrer">atomic nature</a> of KDB/Q operators, the <code>avg</code> operator will apply element-wise to each item within the lists, rather than to each sublist as a whole. Let’s look at an example to demonstrate this behavior.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)avg 0N!(1 2 3;4 5 6;8 9 10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(1 2 3;4 5 6;8 9 10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4.333333 5.333333 6.333333</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(avg 1 4 8;avg 2 5 9;avg 3 6 10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4.333333 5.333333 6.333333</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In order to achieve the desired result, we have to leverage the behavior of the <code>each</code> iterator.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)avg each (1 2 3;4 5 6;8 9 10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 5 9f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Understanding this concept is essential, as nested columns are quite common, particularly when you start grouping tables. If you&#x27;re unsure about any part of this explanation, I encourage you to review the section again and feel free to reach out to me directly for further clarification.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="filtering-your-data-mastering-the-where-clause">Filtering Your Data: Mastering the Where Clause<a href="#filtering-your-data-mastering-the-where-clause" class="hash-link" aria-label="Direct link to Filtering Your Data: Mastering the Where Clause" title="Direct link to Filtering Your Data: Mastering the Where Clause">​</a></h3>
<p>When working with KDB/Q, you&#x27;re typically handling large datasets, often containing millions or even billions of records. However, it’s rare that you’ll need to analyze an entire table. The <code>where clause</code> enables you to filter your data into more manageable subsets. In this section, we&#x27;ll explore the powerful functionality and behavior of the <code>where clause</code>.</p>
<p>Let&#x27;s start with a simple example. Assume you would like to retrieve all the records for the stock Google from our <code>trade</code> table. You can do this simply by using the below query:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where sym=`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108 890      NASDAQ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="multiple-where-clauses">Multiple Where Clauses<a href="#multiple-where-clauses" class="hash-link" aria-label="Direct link to Multiple Where Clauses" title="Direct link to Multiple Where Clauses">​</a></h4>
<p>Obviously you&#x27;re not limited to using just one <code>where clause</code> in a Q-SQL query; you can include as many as needed, with each being an individual KDB/Q expression. Although KDB/Q code is generally evaluated from right to left (<a href="https://www.defconq.tech/blog/The%20Magnificent%20Seven%20-%20Mastering%20KDB/Q%20Concepts%20for%20Data%20Excellence#left-of-right-and-no-operator-precedence" target="_blank" rel="noopener noreferrer">left-of-right</a>), Q-SQL <code>where clauses</code> are executed from the left most, to the right most. Each clause successively narrows down the data, passing the filtered subset to the next. This is one of the reasons Q-SQL queries are so efficient and powerful. Given this, it&#x27;s often best to place the most restrictive <code>where clause</code> first to optimize performance. Let’s look at an example: Suppose we have an order table with data for eight different stocks, including the order price and whether it was a buy or sell. Our table contains 100 million records, and we want to filter for all the buy orders for Google.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Set n to 100 million</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)n:100000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create the order table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)order:([] sym:n?`AAPL`GOOG`MSFT`FB`CSCO`C`GS`AMZN; price:n?100.0; side:n?`buy`sell)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)count order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">100000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Estimate the size of the order table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)1e-6*-22!order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1662.5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>First, we use a where clause to filter for all buy orders and then, subsequently we filter for all Google orders. Let&#x27;s have a look at the performance of this query</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts select from order where side=`buy,sym=`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">377 1140851408</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)1e-6*1140851408</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1140.851</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, this takes just under 400 milliseconds to return and uses 1.14GB of memory.</p>
<p>On the other hand, if we first filter for all Google orders and then apply a second filter for buy orders, the performance of our query improves by approximately 30% in terms of execution time while using four times less memory compared to the initial query.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts select from order where sym=`GOOG,side=`buy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">265 285213392</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)1e-6*285213392</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">285.2134</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The example above clearly demonstrates the importance of placing the most restrictive <code>where clause</code> first, followed by progressively less restrictive ones. If you&#x27;ve worked with KDB/Q for a while, you&#x27;ve likely encountered a situation where either you or a less experienced user accidentally queried the Historical Database (HDB) without filtering by date first. This can lead to blocking the HDB and potentially crashing the process as it tries to load all the data into memory (unless certain safety flags are enabled, which is a topic for another post). Since the HDB typically holds years or even decades of market data, partitioned by date, failing to use a date filter first in your Q-SQL query will cause KDB/Q to attempt to load the entire dataset, overwhelming memory and crashing the KDB/Q process.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-virtual-column-i-in-a-where-clause">The virtual column <code>i</code> in a <code>where clause</code><a href="#the-virtual-column-i-in-a-where-clause" class="hash-link" aria-label="Direct link to the-virtual-column-i-in-a-where-clause" title="Direct link to the-virtual-column-i-in-a-where-clause">​</a></h4>
<p>We&#x27;ve already seen how the virtual column <code>i</code> can be used in your column selection, but there&#x27;s even more you can do with it. You can also leverage it within your <code>where clause</code>. A quick example will highlight this functionality.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where i=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price   quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731 177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where i within 3 9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where i in 5 6 7 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="leveraging-the-flexibility-of-kdbq-writing-powerful-q-sql-queries">Leveraging the Flexibility of KDB/Q: Writing Powerful Q-SQL Queries<a href="#leveraging-the-flexibility-of-kdbq-writing-powerful-q-sql-queries" class="hash-link" aria-label="Direct link to Leveraging the Flexibility of KDB/Q: Writing Powerful Q-SQL Queries" title="Direct link to Leveraging the Flexibility of KDB/Q: Writing Powerful Q-SQL Queries">​</a></h4>
<p>I&#x27;ve mentioned it before, and I can&#x27;t emphasize enough how powerful and flexible KDB/Q is for coding. You can accomplish a lot with minimal code in a highly elegant manner. This is especially clear when writing more complex Q-SQL queries. By leveraging the flexibility of KDB/Q, we can create concise yet effective code.</p>
<p>Consider this scenario: Our trade table contains trade data for various stocks across multiple exchanges. One of your business users, a quant, is interested in trades for Google (GOOG), Apple (AAPL), and Microsoft (MSFT). Specifically, they want trades for Apple on the NASDAQ (National Association of Securities Dealers Automatic Quotation System), trades for Google on the NYSE (New York Stock Exchange), and trades for Microsoft on both the NASDAQ and CBOE (Chicago Board Options Exchange). The table below lists the various exchanges where these stocks are traded. How can we create a query to return the desired outcome?</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select count i by sym,exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  exchange| x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------| -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL CBOE    | 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL LSE     | 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL NASDAQ  | 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL NYSE    | 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG CBOE    | 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG LSE     | 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG NASDAQ  | 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG NYSE    | 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  CBOE    | 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  LSE     | 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  NASDAQ  | 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT CBOE    | 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT LSE     | 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT NASDAQ  | 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, the stocks we are focusing on are traded on multiple exchanges, some of which are not relevant to our needs. To start, let&#x27;s filter the data to include only the stocks we&#x27;re interested in.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where sym in `AAPL`GOOG`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE      3525.159</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE      30541.73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE     25807.09</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE     16545.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 62.03014 296      LSE      18360.92</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE     20144.84</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ   19696.47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE     2381.541</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE     16823.52</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108 890      NASDAQ   20559.96</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ   6505.145</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096 108      CBOE     9364.784</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is a good start, but now we need to narrow it down to include only the exchanges that interest us. Let&#x27;s give that a try.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where sym in `AAPL`GOOG`MSFT,exchange in `NASDAQ`CBOE`NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE     25807.09</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE     16545.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE     20144.84</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ   19696.47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE     2381.541</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE     16823.52</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108 890      NASDAQ   20559.96</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ   6505.145</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096 108      CBOE     9364.784</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That&#x27;s not quite what we want, is it? While we have all the trades for the stocks we&#x27;re interested in, we&#x27;re also seeing trades for Apple on the NYSE and CBOE, which we want to exclude. Perhaps rearranging the where clauses might help?</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where exchange in `NASDAQ`CBOE`NYSE, sym in `AAPL`GOOG`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE     25807.09</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE     16545.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE     20144.84</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ   19696.47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE     2381.541</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE     16823.52</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108 890      NASDAQ   20559.96</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ   6505.145</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096 108      CBOE     9364.784</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>No, that didn&#x27;t work either. Alright, let&#x27;s construct a query for each individual stock along with the exchanges we&#x27;re interested in and then combine them.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)(select from trade where sym=`AAPL, exchange=`NASDAQ),(select from trade where sym=`GOOG,exchange=`NYSE),select from trade where sym=`MSFT,exchange in `NASDAQ`CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ   19696.47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE     25807.09</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ   6505.145</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096 108      CBOE     9364.784</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>In the code above, we&#x27;ve joined three tables into a single table. We&#x27;ll discuss joins in much greater detail in a future post</p></div></div>
<p>The code above gives us the desired result, showing all trades for Apple on the NASDAQ, all Google trades on the NYSE, and all Microsoft trades on both the NASDAQ and CBOE. However, this required quite a bit of typing. Surely, there must be a more concise way to achieve this. Let’s take a moment to consider what we’re actually interested in. The table below summarizes the stocks and exchanges we&#x27;re focusing on.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)([] sym:`AAPL`GOOG`MSFT`MSFT;exchange:`NASDAQ`NYSE`NASDAQ`CBOE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT CBOE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Wouldn&#x27;t it be fantastic if we could utilize this information to filter our table? Well, KDB/Q always comes through! We can definitely achieve that! Let me demonstrate how.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where ([] sym;exchange) in ([] sym:`AAPL`GOOG`MSFT`MSFT;exchange:`NASDAQ`NYSE`NASDAQ`CBOE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE     25807.09</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ   19696.47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ   6505.145</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096 108      CBOE     9364.784</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can probably already see that the result is exactly what we are looking for and matches the result of our previous query. However, the order of the table differs slightly from our previous result. So, let&#x27;s sort both tables by the symbol and then compare the results to ensure they contain the same information.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)(`sym xasc select from trade where ([] sym;exchange) in ([] sym:`AAPL`GOOG`MSFT`MSFT;exchange:`NASDAQ`NYSE`NASDAQ`CBOE))~(`sym xasc select from trade where sym=`AAPL, exchange=`NASDAQ),(select from trade where sym=`GOOG,exchange=`NYSE),select from trade where sym=`MSFT,exchange in `NASDAQ`CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Et voila! There we have it! We&#x27;ve confirmed that the results match perfectly, and we&#x27;ve now learned how to write terse yet powerful queries.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="demystifying-the-magic-of-where-clauses">Demystifying the Magic of Where Clauses<a href="#demystifying-the-magic-of-where-clauses" class="hash-link" aria-label="Direct link to Demystifying the Magic of Where Clauses" title="Direct link to Demystifying the Magic of Where Clauses">​</a></h4>
<p>We’ve explored some basic where clause expressions and gained a solid understanding of how to use them. Now, let’s dive deeper into what actually happens under the hood when you apply a where clause in your Q-SQL query. Each where clause in your Q-SQL expression is evaluated to produce a boolean vector (or boolean-equivalent types, like an integer 0 representing false) that matches the row count of the table. From a intuitive perspective you would expect that each boolean vector from the where clauses is combined using an <strong>AND</strong> operation, and the final vector is applied to filter your data. However, as we learned in the previous section on multiple where clauses, only the records passing the current where clause are tested in the next subphrase. The result is a progressively narrower subset of rows for each subsequent clause.</p>
<p>Let&#x27;s look at this behaviour in action using our <code>trade</code> table:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// For reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 62.03014 296      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108 890      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  8.724017 407      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096 108      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  72.78528 652      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create count[trade] random boolean values --&gt; 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)show ind:count[trade]?01b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">01000111010011011101b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Use our boolean vector to filter the trade table. Returning all rows where the boolean vector is 1b true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where ind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108 890      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  8.724017 407      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  72.78528 652      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// You can also select the whole table using 1b. This works because KDB/Q applies atomic extension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where 1b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 62.03014 296      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108 890      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  8.724017 407      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096 108      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  72.78528 652      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Or select an empty table using 0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where 0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym price quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That was fun, right? As you&#x27;ve seen, we can use a boolean vector to filter our data effectively. Thanks to the atomic nature of KDB/Q operators and atomic expansion, you can even pass a single <code>true</code> value (<code>1b</code>) to return the entire table or a <code>false</code> value (<code>0b</code>) to get an empty table. But let&#x27;s take it up a notch and dive deeper into how the <code>where clause</code> really works.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)ind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">01000111010011011101b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)where ind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 5 6 7 9 12 13 15 16 17 19</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, the <code>where</code> operator returns the index of all <code>true (1b)</code> values.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>There&#x27;s actually more to this, but that, my friends, is a topic for another post. You can subscribe to my newsletter <a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer">here</a> to stay updated and receive my blog posts directly in your inbox.</p></div></div>
<p>Now, back to the <code>where</code> operator. Let&#x27;s try using the indexes it returns to index into our <code>trade</code> table—it works like a charm.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)trade where ind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108 890      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  8.724017 407      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  72.78528 652      LSE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>But what if we use numerical indexes directly in our Q-SQL statement? That should work, right? Given the left-to-right nature of KDB/Q, the indexing into the table should filter the data, and then we can select from it. Let’s try it...</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade 1 5 6 7 9 12 13 15 16 17 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108 890      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  8.724017 407      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  72.78528 652      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(trade where ind)~select from trade 1 5 6 7 9 12 13 15 16 17 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It worked—awesome! However, there’s one caveat when using this behavior in a Q-SQL <code>where</code> clause. The boolean vector must be the same length as the table&#x27;s row count, otherwise, you’ll encounter a length error. Take a look at the example below.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where 010b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [0]  select from trade where 010b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="grouping-data-the-by-clause">Grouping Data: The <code>by</code> clause<a href="#grouping-data-the-by-clause" class="hash-link" aria-label="Direct link to grouping-data-the-by-clause" title="Direct link to grouping-data-the-by-clause">​</a></h3>
<p>When dealing with large tables, it&#x27;s common to store data for multiple instruments or IDs; I have never encountered a table containing data for just one specific identifier. Therefore, it&#x27;s usually impractical to run aggregation functions like minimum <code>min</code>, maximum <code>max</code>, or average <code>avg</code> on the entire table (unless, of course, you&#x27;re calculating something like the average height of a population, but let&#x27;s set that aside for now). For example, calculating the minimum, maximum, and average trade price for the entire <code>trade</code> table wouldn&#x27;t make much sense, would it?</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select minimum:min price,maximum: max price,average: avg price from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">minimum  maximum  average</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1.392076 93.26316 41.65634</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The query above is quite pointless if we&#x27;re interested in individual stocks. It makes far more sense to calculate the minimum, maximum, and average trade price for each specific stock. This is where the <code>by</code> clause comes in handy. By specifying the column we want to group by, we can calculate these metrics for each stock accordingly.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select minimum:min price,maximum: max price,average: avg price by sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym | minimum  maximum  average</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----| --------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 19.46509 93.26316 45.46812</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 5.752516 71.48779 35.33425</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 1.392076 72.78528 26.56717</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 10.24432 86.71096 57.22905</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now this is much more meaningful. Of course, you can include multiple columns in the <code>by</code> clause for more detailed grouping.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select minimum:min price,maximum: max price,average: avg price by sym,exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  exchange| minimum  maximum  average</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------| --------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL CBOE    | 19.46509 25.60658 22.53583</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL LSE     | 62.03014 62.03014 62.03014</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL NASDAQ  | 27.47066 44.9731  36.22188</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL NYSE    | 93.26316 93.26316 93.26316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG CBOE    | 5.752516 5.752516 5.752516</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG LSE     | 40.99561 40.99561 40.99561</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG NASDAQ  | 23.10108 23.10108 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG NYSE    | 71.48779 71.48779 71.48779</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  CBOE    | 1.392076 40.87545 21.13376</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  LSE     | 8.724017 72.78528 40.75465</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  NASDAQ  | 9.059026 9.059026 9.059026</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT CBOE    | 61.08817 86.71096 73.89957</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT LSE     | 78.33686 78.33686 78.33686</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT NASDAQ  | 10.24432 49.76492 30.00462</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="by-clause-demystified">By clause demystified<a href="#by-clause-demystified" class="hash-link" aria-label="Direct link to By clause demystified" title="Direct link to By clause demystified">​</a></h4>
<p>But how does the <code>by</code> clause actually work? Let’s break it down. When you use the <code>by</code> clause, KDB/Q groups the underlying data based on the specified column, creating a keyed table (if you&#x27;re unfamiliar with keyed tables, you can learn more about them <a href="https://www.defconq.tech/docs/concepts/dictionariesTables#keyed-tables-vs-tables" target="_blank" rel="noopener noreferrer">here</a>). The column you specified in the <code>by</code> clause becomes the key, and all the values for the other columns are stored as nested columns. To illustrate this, we can use the <a href="https://code.kx.com/q/ref/xgroup/" target="_blank" rel="noopener noreferrer"><code>xgroup</code></a> operator: given a table <code>trade</code>, the <code>xgroup</code> operator will group the data by the designated column.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)`sym xgroup trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym | price                                                quantity                exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----| --------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 78.33686 61.08817 49.76492 10.24432 86.71096         45 898 935 635 108      `LSE`CBOE`NASDAQ`NASDAQ`CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 40.99561 71.48779 5.752516 23.10108                  745 361 414 890         `LSE`NYSE`CBOE`NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 40.87545 1.392076 9.059026 8.724017 72.78528         64 238 241 407 652      `CBOE`CBOE`NASDAQ`LSE`LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 44.9731 19.46509 62.03014 93.26316 27.47066 25.60658 177 850 296 216 717 657 `NASDAQ`CBOE`LSE`NYSE`NASDAQ`CBOE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, each column is now a nested column. To perform meaningful analysis, we can apply an aggregation operator.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select minimum:min price,maximum: max price,average: avg price by sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym | minimum  maximum  average</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----| --------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 19.46509 93.26316 45.46812</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 5.752516 71.48779 35.33425</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 1.392076 72.78528 26.56717</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 10.24432 86.71096 57.22905</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As previously mentioned, there&#x27;s nothing preventing you from using multiple columns to group your data. Additionally, you can use any KDB/Q expression in the <code>by</code> clause. For example, if you&#x27;re interested in how many records there are for Apple stock, an intuitive approach would be to filter all records where the <code>sym</code> column matches the Apple ticker and then count the results, like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select count i by sym from trade where sym=`AAPL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym | x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----| -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>However, this method only provides the count for Apple stock. If you want to know the count for all other stocks as well, you would need to run an additional, separate query. Using the <code>by</code> clause, though, you can achieve everything in one step.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select n:count i by isAAPL:sym=`AAPL from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">isAAPL| n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------| --</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0     | 14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1     | 6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-retrieve-the-last-element-for-a-specific-identifier">How to Retrieve the Last Element for a Specific Identifier<a href="#how-to-retrieve-the-last-element-for-a-specific-identifier" class="hash-link" aria-label="Direct link to How to Retrieve the Last Element for a Specific Identifier" title="Direct link to How to Retrieve the Last Element for a Specific Identifier">​</a></h4>
<p>Another highly useful feature of the <code>by</code> clause is the ability to retrieve the last record for a specific identifier. For example, if you&#x27;re looking to obtain the most recent record for a particular stock, a more verbose method might look like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select last price,last quantity,last exchange by sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym | price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----| --------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 25.60658 657      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 23.10108 890      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 72.78528 652      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 86.71096 108      CBOE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This approach works well if you&#x27;re dealing with a small table containing just a few columns. But what if you have dozens or even hundreds of columns, as is often the case? Typing out each column manually would be inefficient. Instead, you can leverage the <code>by</code> clause without specifying any columns. By leaving the column selection blank and using the <code>by</code> clause, KDB/Q will automatically return the last record for each identifier specified in the <code>by</code> clause.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select by sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym | price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----| --------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 25.60658 657      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 23.10108 890      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 72.78528 652      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 86.71096 108      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(select last price,last quantity,last exchange by sym from trade)~select by sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-update-statement">The <a href="https://code.kx.com/q4m3/9_Queries_q-sql/#95-the-update-template" target="_blank" rel="noopener noreferrer"><code>update</code></a> statement<a href="#the-update-statement" class="hash-link" aria-label="Direct link to the-update-statement" title="Direct link to the-update-statement">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="syntax-1">Syntax<a href="#syntax-1" class="hash-link" aria-label="Direct link to Syntax" title="Direct link to Syntax">​</a></h3>
<p>Now that we understand how to select and filter our data, let’s explore how to update it. You can modify your data using the <code>update</code> template. The <code>update</code> template follows the same syntax as the <code>select</code> template, except that you use the <code>update</code> keyword in place of the <code>select</code> keyword.</p>
<p><img decoding="async" loading="lazy" alt="Q-SQL Update Statement Syntax" src="/assets/images/updateStatement-4a66e5939675682fb16d9fc172b7123d.png" width="1210" height="480" class="img_ev3q"></p>
<p>The key difference between a <code>select</code> statement and an <code>update</code> statement is that the columns specified in the update are modified rather than just selected. If you update an existing column, the table returned will reflect the changes in that column. If you update a column that doesn&#x27;t yet exist, a new column will be added to the end of the column list. <strong>One important note</strong>: the original table remains unchanged when using the <code>update</code> statement—what you get is a copy with the modifications. To apply changes directly to the original table, you need to reference the table by name. Let’s look at some examples.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// For reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Updating the price to price times 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)update price*2 from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 156.6737 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 81.99122 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 122.1763 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 99.52983 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  81.75089 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 89.94621 177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  2.784152 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 142.9756 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Update the price to price+10 for all Apple stocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)update price+10 from trade where sym=`AAPL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 54.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 29.46509 850      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 72.03014 296      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 103.2632 216      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 37.47066 717      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Adding a new column nominal:price*quantity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)update nominal:price*quantity from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE      3525.159</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE      30541.73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE     2616.029</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE     331.3141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE     25807.09</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE     16545.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Inspecting the trade table --&gt; Updates haven&#x27;t been persisted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Updating the trade table in place --&gt; Using update by name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)update nominal:price*quantity from `trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE      3525.159</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE      30541.73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE     2616.029</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE     331.3141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE     25807.09</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As shown in the examples above, when we update the <code>trade</code> table, we receive a modified copy of the original table, but the changes are not persisted. This is because the table is updated by value, not by name. To ensure the changes are saved, we need to update the table by name, as demonstrated in the final example.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="conformability-matters-update-modifications-are-vector-operations">Conformability Matters: Update Modifications Are Vector Operations<a href="#conformability-matters-update-modifications-are-vector-operations" class="hash-link" aria-label="Direct link to Conformability Matters: Update Modifications Are Vector Operations" title="Direct link to Conformability Matters: Update Modifications Are Vector Operations">​</a></h4>
<p>There is one final point we have to cover about the <code>update</code> statement before moving on to the next topic. Actions in the <code>update</code> statement are vector operations applied to the entire column. This means the <strong>length and type</strong> of the values you are updating matters.</p>
<p>Let’s dive into this in more detail. Suppose we want to add a <code>name</code> column to our trade table that contains the company names. For now, let’s assume we only know the name of the stock with the ticker <code>MSFT</code> and want to update just those records.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)update name:&quot;Microsoft&quot; from trade where sym=`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [0]  update name:&quot;Microsoft&quot; from trade where sym=`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    ^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Surprisingly, this doesn’t work. But should it really be a surprise after learning that <code>update</code> operations are vector-based? Remember, &quot;Microsoft&quot; is a character vector, and its length doesn’t match the length of our <code>trade</code> table.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)count &quot;Microsoft&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)count trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">20</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Alright, let’s adjust our code to ensure we have the same number of &quot;Microsoft&quot; entries as the number of rows we intend to update.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)update name:count[i]#&quot;Microsoft&quot; from trade where sym=`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal  name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE      3525.159 M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE      30541.73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18 i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2  c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE     2616.029</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE     331.3141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE     25807.09</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE     16545.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ   2183.225</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 62.03014 296      LSE      18360.92</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE     20144.84</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ   19696.47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE     2381.541</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE     16823.52</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Wait a minute, what’s going on? Remember that &quot;Microsoft&quot; is a string, which is technically a character-vector. So, when we use the <code>take</code> operator, it treats the string &quot;Microsoft&quot; as a vector, no surprise here..</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Additional illustration of how strings work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)update name:count[trade]#&quot;Microsoft&quot; from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal  name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE      3525.159 M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE      30541.73 i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18 c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2  r</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE     2616.029 o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239 s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE     331.3141 o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE     25807.09 f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE     16545.33 t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ   2183.225 M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 62.03014 296      LSE      18360.92 i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE     20144.84 c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ   19696.47 r</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE     2381.541 o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE     16823.52 s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)count[trade]#&quot;Microsoft&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;MicrosoftMicrosoftMi&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ok, so what’s the solution? Let’s create a singleton list containing the character vector &quot;Microsoft&quot; and allow KDB/Q’s atomic extension to work its magic.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)update name:enlist &quot;Microsoft&quot; from trade where sym=`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [0]  update name:enlist &quot;Microsoft&quot; from trade where sym=`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           ^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This still doesn’t work. It seems atomic extension doesn’t apply to lists, which isn’t surprising—after all, it’s called &quot;atomic&quot; extension for a reason. So let’s try one more approach: we’ll create a list of lists, where we repeat the <code>enlist &quot;microsoft&quot;</code> as many times as needed for all our <code>MSFT</code> symbols.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)update name:sum[trade[`sym]=`MSFT]#enlist &quot;Microsoft&quot; from trade where sym=`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal  name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE      3525.159 &quot;Microsoft&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE      30541.73 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18 &quot;Microsoft&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2  &quot;Microsoft&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE     2616.029 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE     331.3141 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE     25807.09 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE     16545.33 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ   2183.225 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 62.03014 296      LSE      18360.92 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE     20144.84 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ   19696.47 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE     2381.541 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE     16823.52 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, this worked! However, the query isn&#x27;t particularly clean, concise, or as terse as we would like in KDB/Q. So, let&#x27;s rewrite it in a more efficient and elegant way. Given what we know about the execution order of Q-SQL queries, we know that after the table expression <code>T&lt;exp&gt;</code> is evaluated, the <code>where clause</code> is processed, filtering the data so that only a subset is used in further operations. We can leverage this by simply using <code>count[i]</code> to determine how many times we need to take <code>enlist &quot;Microsoft&quot;</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)update name:count[i]#enlist &quot;Microsoft&quot; from trade where sym=`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal  name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE      3525.159 &quot;Microsoft&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE      30541.73 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18 &quot;Microsoft&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2  &quot;Microsoft&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE     2616.029 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE     331.3141 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE     25807.09 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE     16545.33 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ   2183.225 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 62.03014 296      LSE      18360.92 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE     20144.84 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ   19696.47 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE     2381.541 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE     16823.52 ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p><strong>Bonus tip</strong>: When working with small tables, using <code>count[i]</code> is perfectly fine. However, for large tables, it&#x27;s more efficient to use an already existing column to get the record count. Why? The virtual column <code>i</code> is created each time it&#x27;s referenced, which can decrease query performance. So, when dealing with large datasets, particularly in the Historical Database (HDB), always opt for an existing column.</p><p><strong>Extra bonus tip</strong>: Using <code>count</code> on an existing column in the HDB is especially fast because the column file headers store the length of each column, speeding up the process.</p></div></div>
<p>One final note: Besides ensuring length conformability, the data type of the updated records (when the column already exists) must match the type of the existing column. This may seem obvious, but it&#x27;s important to emphasize</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)update price:`error from trade where sym=`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [0]  update price:`error from trade where sym=`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)update price:`error from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price quantity exchange nominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT error 45       LSE      3525.159</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG error 745      LSE      30541.73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT error 898      CBOE     54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT error 935      NASDAQ   46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  error 64       CBOE     2616.029</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL error 177      NASDAQ   7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  error 238      CBOE     331.3141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG error 361      NYSE     25807.09</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you attempt to partially update a column with data that doesn&#x27;t match the column&#x27;s existing data type, you&#x27;ll encounter a <code>type</code> error. However, updating the entire column with a new data type will work without issue.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-delete-statement">The <a href="https://code.kx.com/q4m3/9_Queries_q-sql/#96-the-delete-template" target="_blank" rel="noopener noreferrer"><code>delete</code></a> Statement<a href="#the-delete-statement" class="hash-link" aria-label="Direct link to the-delete-statement" title="Direct link to the-delete-statement">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="syntax-2">Syntax<a href="#syntax-2" class="hash-link" aria-label="Direct link to Syntax" title="Direct link to Syntax">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Q-SQL Delete Statement Syntax" src="/assets/images/deleteStatement-d970fb629b0747e68876dff9390819ea.png" width="1210" height="460" class="img_ev3q"></p>
<p>Deleting from a table is quite simple—you can either delete entire columns or entire rows, but not individual cells. The reason for this becomes clear when you think about it. If you were to delete a specific cell, the table structure would be compromised. Should the result be a list of non-conforming dictionaries? Or should the empty cells be filled with null values? Since there&#x27;s no clear answer, deleting individual cells isn&#x27;t allowed.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// For reference </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE      3525.159</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE      30541.73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE     2616.029</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE     331.3141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE     25807.09</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE     16545.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ   2183.225</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 62.03014 296      LSE      18360.92</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE     20144.84</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ   19696.47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE     2381.541</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE     16823.52</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// We can delete a column</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)delete nominal from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 62.03014 296      LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// We can delete rows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)delete from trade where sym=`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE      3525.159</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE     2616.029</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE     331.3141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE     16545.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ   2183.225</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 62.03014 296      LSE      18360.92</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE     20144.84</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ   19696.47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE     16823.52</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  8.724017 407      LSE      3550.675</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 10.24432 635      NASDAQ   6505.145</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096 108      CBOE     9364.784</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  72.78528 652      LSE      47456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// But we can&#x27;t delete individual cells</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)delete nominal from trade where sym=`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;nyi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [0]  delete nominal from trade where sym=`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           ^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The image below should illustrate why it&#x27;s not possible to delete an individual cell.</p>
<p><img decoding="async" loading="lazy" alt="Q-SQL Delete Cells Statement Syntax" src="/assets/images/deleteCells-6318039c4672237c14046f882f6f5692.png" width="211" height="151" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-exec-statement">The <a href="https://code.kx.com/q4m3/9_Queries_q-sql/#94-the-exec-template" target="_blank" rel="noopener noreferrer"><code>exec</code></a> Statement<a href="#the-exec-statement" class="hash-link" aria-label="Direct link to the-exec-statement" title="Direct link to the-exec-statement">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="syntax-3">Syntax<a href="#syntax-3" class="hash-link" aria-label="Direct link to Syntax" title="Direct link to Syntax">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Q-SQL Exec Statement Syntax" src="/assets/images/execStatement-a5781116cb968c489d720e134e24dcec.png" width="1210" height="480" class="img_ev3q"></p>
<p>When I first started learning Q-SQL and querying data, I primarily used the <code>exec</code> statement to extract a single column as a list from a table. Over time, I realized how powerful the <code>exec</code> statement truly is. After reading <a href="https://www.linkedin.com/in/nickpsaris/" target="_blank" rel="noopener noreferrer">Nick Psaris&#x27;</a> <a href="https://amzn.to/40a01Hv" target="_blank" rel="noopener noreferrer">Q Tips</a> I discovered that <code>exec</code> is actually the general form of selecting data, while <code>select</code> is just a special form of <code>exec</code> that always returns a table. In contrast, <code>exec</code> can return a wide range of outputs: an atom, a list, a dictionary, or even a table.</p>
<p>Let’s begin with a few simple examples to understand the full potential of the <code>exec</code> statement, and then progressively work our way towards more advanced use cases.</p>
<p>We can retrieve a single atom from a table</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)exec min price from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1.392076</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or we can retrieve a list</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)exec sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`MSFT`GOOG`MSFT`MSFT`IBM`AAPL`IBM`GOOG`AAPL`IBM`AAPL`AAPL`AAPL`GOOG`AAPL`GOOG`IBM`MSFT`MSFT`IBM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)exec distinct sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`MSFT`GOOG`IBM`AAPL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When using the <code>exec</code> statement to select multiple columns from a table, the result is returned as a dictionary.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)exec sym,price from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  | MSFT     GOOG     MSFT     MSFT     IBM      AAPL    IBM      GOOG     AAPL     IBM      AAPL     AAPL     AAPL     GOOG     AAPL     GOOG     IBM      MSFT     MSFT     IBM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">price| 78.33686 40.99561 61.08817 49.76492 40.87545 44.9731 1.392076 71.48779 19.46509 9.059026 62.03014 93.26316 27.47066 5.752516 25.60658 23.10108 8.724017 10.24432 86.71096 72.78528</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This feature also works for a single column when combined with an assignment.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)exec price:price from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">price| 78.33686 40.99561 61.08817 49.76492 40.87545 44.9731 1.392076 71.48779 19.46509 9.059026 62.03014 93.26316 27.47066 5.752516 25.60658 23.10108 8.724017 10.24432 86.71096 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)exec px:price from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">px| 78.33686 40.99561 61.08817 49.76492 40.87545 44.9731 1.392076 71.48779 19.46509 9.059026 62.03014 93.26316 27.47066 5.752516 25.60658 23.10108 8.724017 10.24432 86.71096 72.78528</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-magic-of-exec">The Magic of <code>exec</code><a href="#the-magic-of-exec" class="hash-link" aria-label="Direct link to the-magic-of-exec" title="Direct link to the-magic-of-exec">​</a></h4>
<p>By now, you might have started to understand how the <code>select</code> statement is simply a specialized form of the more general <code>exec</code> statement. If not, here&#x27;s a quick reminder: a table is essentially a flipped column dictionary. If you haven&#x27;t internalized this concept yet, write it down on a post-it and stick it everywhere you can until it becomes second nature. You can also revisit my blog post for a refresher <a href="https://www.defconq.tech/docs/concepts/dictionariesTables#tables" target="_blank" rel="noopener noreferrer">here</a></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Selecting multiple columns from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)exec sym,price,quantity,exchange,nominal from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym     | MSFT     GOOG     MSFT     MSFT     IBM      AAPL     IBM      GOOG     AAPL     IBM      AAPL     AAPL     AAPL     GOOG     AAPL     GOOG     IBM      MSFT     MSFT     IBM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">price   | 78.33686 40.99561 61.08817 49.76492 40.87545 44.9731  1.392076 71.48779 19.46509 9.059026 62.03014 93.26316 27.47066 5.752516 25.60658 23.10108 8.724017 10.24432 86.71096 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quantity| 45       745      898      935      64       177      238      361      850      241      296      216      717      414      657      890      407      635      108      652</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exchange| LSE      LSE      CBOE     NASDAQ   CBOE     NASDAQ   CBOE     NYSE     CBOE     NASDAQ   LSE      NYSE     NASDAQ   CBOE     CBOE     NASDAQ   LSE      NASDAQ   CBOE     LSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nominal | 3525.159 30541.73 54857.18 46530.2  2616.029 7960.239 331.3141 25807.09 16545.33 2183.225 18360.92 20144.84 19696.47 2381.541 16823.52 20559.96 3550.675 6505.145 9364.784 47456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Selecting several columns from trade using exec and then flipping the result returns a table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)flip exec sym,price,quantity,exchange,nominal from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price    quantity exchange nominal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686 45       LSE      3525.159</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 40.99561 745      LSE      30541.73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 61.08817 898      CBOE     54857.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 49.76492 935      NASDAQ   46530.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  40.87545 64       CBOE     2616.029</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 44.9731  177      NASDAQ   7960.239</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  1.392076 238      CBOE     331.3141</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779 361      NYSE     25807.09</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 19.46509 850      CBOE     16545.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  9.059026 241      NASDAQ   2183.225</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 62.03014 296      LSE      18360.92</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 93.26316 216      NYSE     20144.84</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 27.47066 717      NASDAQ   19696.47</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 5.752516 414      CBOE     2381.541</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658 657      CBOE     16823.52</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)trade~flip exec sym,price,quantity,exchange,nominal from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Selecting several columns from <code>trade</code> using <code>exec</code> and then flipping the result returns a table.</p></div></div>
<p>The key difference between a <code>select</code> statement and an <code>exec</code> statement lies in their flexibility. White the <code>select</code> statement always has to return a rectangular result (i.e. a table) the <code>exec</code> statement is far more versatile, allowing the result to have any shape.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select sym,distinct exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [0]  select sym,distinct exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)exec sym,distinct exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym     | `MSFT`GOOG`MSFT`MSFT`IBM`AAPL`IBM`GOOG`AAPL`IBM`AAPL`AAPL`AAPL`GOOG`AAPL`GOOG`IBM`MSFT`MSFT`IBM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exchange| `LSE`CBOE`NASDAQ`NYSE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Just like with the <code>select</code> statement, you cal also use the <code>by</code> clause within an <code>exec</code> statement.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)exec sym by exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CBOE  | `MSFT`IBM`IBM`AAPL`GOOG`AAPL`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LSE   | `MSFT`GOOG`AAPL`IBM`IBM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NASDAQ| `MSFT`AAPL`IBM`AAPL`GOOG`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NYSE  | `GOOG`AAPL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)exec distinct sym by exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CBOE  | `MSFT`IBM`AAPL`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LSE   | `MSFT`GOOG`AAPL`IBM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NASDAQ| `MSFT`AAPL`IBM`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NYSE  | `GOOG`AAPL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// See how the result is a dictionary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)0N!exec min price by sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`s#`AAPL`GOOG`IBM`MSFT!19.46509 5.752516 1.392076 10.24432</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 19.46509</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 5.752516</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 1.392076</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 10.24432</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The result is a dictionary. But what if we want a table instead of a dictionary? Can we make that happen? Let&#x27;s give it a try.</p>
<p>First, let&#x27;s give the name used in the <code>by</code> clause a name.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Giving the column in the by clause a name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)exec sym by exchange:exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exchange|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------| ---------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CBOE    | `MSFT`IBM`IBM`AAPL`GOOG`AAPL`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LSE     | `MSFT`GOOG`AAPL`IBM`IBM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NASDAQ  | `MSFT`AAPL`IBM`AAPL`GOOG`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NYSE    | `GOOG`AAPL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Inspecting the output using 0N!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)0N!exec sym by exchange:exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(`s#+(,`exchange)!,`s#`CBOE`LSE`NASDAQ`NYSE)!(`MSFT`IBM`IBM`AAPL`GOOG`AAPL`MSFT;`MSFT`GOOG`AAPL`IBM`IBM;`MSFT`AAPL`IBM`AAPL`GOOG`MSFT;`GOOG`AAPL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exchange|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------| ---------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CBOE    | `MSFT`IBM`IBM`AAPL`GOOG`AAPL`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LSE     | `MSFT`GOOG`AAPL`IBM`IBM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NASDAQ  | `MSFT`AAPL`IBM`AAPL`GOOG`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NYSE    | `GOOG`AAPL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As we can see from the result, when we inspect it using the <code>0N!</code> operator, the output is a dictionary where the key is a dictionary, and the value is a list of lists. Although it appears similar to a table, it is, in fact, not a table.</p>
<p>Next, let&#x27;s try naming the selected column rather than the column used in the <code>by</code> clause.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)exec sym:distinct sym by exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      | sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----  | -------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CBOE  | `MSFT`IBM`AAPL`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LSE   | `MSFT`GOOG`AAPL`IBM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NASDAQ| `MSFT`AAPL`IBM`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NYSE  | `GOOG`AAPL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)0N!exec sym:distinct sym by exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`s#`CBOE`LSE`NASDAQ`NYSE!+(,`sym)!,(`MSFT`IBM`AAPL`GOOG;`MSFT`GOOG`AAPL`IBM;`MSFT`AAPL`IBM`GOOG;`GOOG`AAPL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      | sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----  | -------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CBOE  | `MSFT`IBM`AAPL`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LSE   | `MSFT`GOOG`AAPL`IBM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NASDAQ| `MSFT`AAPL`IBM`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NYSE  | `GOOG`AAPL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The result appears similar to the previous one, but now the output is a dictionary where the key is a list and the value is another dictionary. Still, it&#x27;s not a table. Let&#x27;s give it one last try by naming both the selected column and the column used in the <code>by</code> clause</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)exec sym:distinct sym by exchange:exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exchange| sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------| -------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CBOE    | `MSFT`IBM`AAPL`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LSE     | `MSFT`GOOG`AAPL`IBM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NASDAQ  | `MSFT`AAPL`IBM`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NYSE    | `GOOG`AAPL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)0N!exec sym:distinct sym by exchange:exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(`s#+(,`exchange)!,`s#`CBOE`LSE`NASDAQ`NYSE)!+(,`sym)!,(`MSFT`IBM`AAPL`GOOG;`MSFT`GOOG`AAPL`IBM;`MSFT`AAPL`IBM`GOOG;`GOOG`AAPL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exchange| sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------| -------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CBOE    | `MSFT`IBM`AAPL`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LSE     | `MSFT`GOOG`AAPL`IBM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NASDAQ  | `MSFT`AAPL`IBM`GOOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NYSE    | `GOOG`AAPL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, now the result not only looks like a table but is, in fact, a keyed table. Remember, a keyed table is a dictionary where both the key and the value are dictionaries. As shown in the first line of the output, using <code>0N!</code> confirms that this is indeed the case.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="crafting-elegant-queries-with-exec-simplify-your-q-sql">Crafting Elegant Queries with exec: Simplify Your Q-SQL<a href="#crafting-elegant-queries-with-exec-simplify-your-q-sql" class="hash-link" aria-label="Direct link to Crafting Elegant Queries with exec: Simplify Your Q-SQL" title="Direct link to Crafting Elegant Queries with exec: Simplify Your Q-SQL">​</a></h4>
<p>Writing Q-SQL queries can occasionally feel verbose and cumbersome, but that&#x27;s where the <code>exec</code> statement really shines over a <code>select</code> statement.  In the following example, we&#x27;ll calculate the open, high, low, and close prices for each symbol, and then sequentially for each symbol and exchange. These metrics are commonly used in candlestick charts, a key tool for technical analysis. While it’s not too difficult to achieve this with a <code>select</code> statement, the <code>exec</code> statement offers a far more elegant and traditionally KDB/Q-style approach.</p>
<p>First, let&#x27;s look at the <code>select</code> statement</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Create a candlestick chart for every symbol using a select statement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select open:first price,high:max price,low:min price,close:last price by sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym | open     high     low      close</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----| -----------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 44.9731  93.26316 19.46509 25.60658</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 40.99561 71.48779 5.752516 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 40.87545 72.78528 1.392076 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 78.33686 86.71096 10.24432 86.71096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create a candlestick chart for every symbol and exchange using a select statement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select open:first price,high:max price,low:min price,close:last price by sym,exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  exchange| open     high     low      close</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------| -----------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL CBOE    | 19.46509 25.60658 19.46509 25.60658</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL LSE     | 62.03014 62.03014 62.03014 62.03014</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL NASDAQ  | 44.9731  44.9731  27.47066 27.47066</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL NYSE    | 93.26316 93.26316 93.26316 93.26316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG CBOE    | 5.752516 5.752516 5.752516 5.752516</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG LSE     | 40.99561 40.99561 40.99561 40.99561</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG NASDAQ  | 23.10108 23.10108 23.10108 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG NYSE    | 71.48779 71.48779 71.48779 71.48779</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  CBOE    | 40.87545 40.87545 1.392076 1.392076</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  LSE     | 8.724017 72.78528 8.724017 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  NASDAQ  | 9.059026 9.059026 9.059026 9.059026</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT CBOE    | 61.08817 86.71096 61.08817 86.71096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT LSE     | 78.33686 78.33686 78.33686 78.33686</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT NASDAQ  | 49.76492 49.76492 10.24432 10.24432</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, this is quite a bit of typing. Next, let&#x27;s take a look at the corresponding <code>exec</code> statement.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Create a candlestick chart for every symbol using an exec statement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)exec `open`high`low`close!(first;max;min;last)@\:price by sym:sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym | open     high     low      close</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----| -----------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 44.9731  93.26316 19.46509 25.60658</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 40.99561 71.48779 5.752516 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 40.87545 72.78528 1.392076 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 78.33686 86.71096 10.24432 86.71096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create a candlestick chart for every symbol and exchange using an exec statement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)exec `open`high`low`close!(first;max;min;last)@\:price by sym,exchange from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  exchange| open     high     low      close</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------| -----------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL CBOE    | 19.46509 25.60658 19.46509 25.60658</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL LSE     | 62.03014 62.03014 62.03014 62.03014</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL NASDAQ  | 44.9731  44.9731  27.47066 27.47066</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL NYSE    | 93.26316 93.26316 93.26316 93.26316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG CBOE    | 5.752516 5.752516 5.752516 5.752516</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG LSE     | 40.99561 40.99561 40.99561 40.99561</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG NASDAQ  | 23.10108 23.10108 23.10108 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG NYSE    | 71.48779 71.48779 71.48779 71.48779</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  CBOE    | 40.87545 40.87545 1.392076 1.392076</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  LSE     | 8.724017 72.78528 8.724017 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM  NASDAQ  | 9.059026 9.059026 9.059026 9.059026</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT CBOE    | 61.08817 86.71096 61.08817 86.71096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT LSE     | 78.33686 78.33686 78.33686 78.33686</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT NASDAQ  | 49.76492 49.76492 10.24432 10.24432</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is much more elegant, isn’t it? The reason the <code>exec</code> statement works so well is that for each symbol (or symbol and exchange in the second example), KDB/Q creates a dictionary with conforming keys, which is then transformed into a table. As we&#x27;ve learned, a list of conforming dictionaries forms a table (if you need a refresher on tables, dictionaries, and column dictionaries, please refer to my blog post <a href="https://www.defconq.tech/docs/concepts/dictionariesTables" target="_blank" rel="noopener noreferrer">here</a>). You can see the underlying structure when we inspect the result in more detail.</p>
<p>When we examine the individual records generated by the <code>by</code> clause in the <code>exec</code> statement, we can observe that it&#x27;s a list of conforming dictionaries.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)exec 0N!`open`high`low`close!(first;max;min;last)@\:price by sym:sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`open`high`low`close!78.33686 86.71096 10.24432 86.71096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`open`high`low`close!40.99561 71.48779 5.752516 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`open`high`low`close!40.87545 72.78528 1.392076 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`open`high`low`close!44.9731 93.26316 19.46509 25.60658</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym | open     high     low      close</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----| -----------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 44.9731  93.26316 19.46509 25.60658</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 40.99561 71.48779 5.752516 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 40.87545 72.78528 1.392076 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 78.33686 86.71096 10.24432 86.71096</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This list of conforming dictionaries is subsequently transformed into a table.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)0N!exec `open`high`low`close!(first;max;min;last)@\:price by sym:sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(`s#+(,`sym)!,`s#`AAPL`GOOG`IBM`MSFT)!+`open`high`low`close!(44.9731 40.99561 40.87545 78.33686;93.26316 71.48779 72.78528 86.71096;19.46509 5.752516 1.392076 10.24432;25.60658 23.10108 72.78528 86.71096)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym | open     high     low      close</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----| -----------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 44.9731  93.26316 19.46509 25.60658</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 40.99561 71.48779 5.752516 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 40.87545 72.78528 1.392076 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 78.33686 86.71096 10.24432 86.71096</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If we try to accomplish the same with a <code>select</code> statement, we’ll end up disappointed. At first glance, the result may seem acceptable, but upon closer inspection, it&#x27;s clear that it&#x27;s not what we intended. The candlestick metrics we calculated have been grouped into a single column, making it inconvenient for any further processing.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select (first;max;min;last)@\:price by sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym | price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----| -----------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 44.9731  93.26316 19.46509 25.60658</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 40.99561 71.48779 5.752516 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 40.87545 72.78528 1.392076 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 78.33686 86.71096 10.24432 86.71096</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using <code>0N!</code> to inspect the result highlights this issue even more.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)0N!select (first;max;min;last)@\:price by sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(`s#+(,`sym)!,`s#`AAPL`GOOG`IBM`MSFT)!+(,`price)!,(44.9731 93.26316 19.46509 25.60658;40.99561 71.48779 5.752516 23.10108;40.87545 72.78528 1.392076 72.78528;78.33686 86.71096 10.24432 86.71096)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym | price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----| -----------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 44.9731  93.26316 19.46509 25.60658</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 40.99561 71.48779 5.752516 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IBM | 40.87545 72.78528 1.392076 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 78.33686 86.71096 10.24432 86.71096</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>There is one downside to our elegant code: we trade speed for conciseness. Since we are iterating through the price column for every function in our exec statement, this approach is slower than the select statement, which avoids iteration. In fact, the select statement is approximately 30% faster than the exec statement. If performance is critical, you may need to resort to a more verbose select statement. However, if performance isn&#x27;t your primary concern, aim for the more elegant solution by using the exec statement.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts:10000 exec `open`high`low`close!(first;max;min;last)@\:price by sym:sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">66 11392</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts:10000 select open:first price,high:max price,low:min price,close:last price by sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">42 3008</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>In conclusion, we&#x27;ve explored the unique power and flexibility of Q-SQL, especially through its efficient handling of large datasets. We have learned about <code>select</code>, <code>update</code>, <code>delete</code> and the flexible exec statements, and the use of nested queries. Unlike standard SQL, Q-SQL allows for more elegant, concise code while leveraging vectorized operations to enhance performance. These features make it a powerful tool for complex data analysis. I hope this deep dive helps you on your journey with KDB/Q!</p>
<p>Happy coding, and don&#x27;t hesitate to reach out if you need any guidance. Make sure to subscribe to my newsletter <a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer">here</a> to stay updated!</p>
<p><strong>Resources</strong>:</p>
<ol>
<li><a href="https://code.kx.com/q4m3/9_Queries_q-sql/" target="_blank" rel="noopener noreferrer">Q for Mortals, Chapter 9: Queries: q-sql</a></li>
<li><a href="https://amzn.to/40a01Hv" target="_blank" rel="noopener noreferrer">Q Tips: Fast, Scalable and Maintainable Kdb+ by Nick Psaris</a></li>
</ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/concepts/dictionariesTables"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Dictionaries and Tables</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/concepts/fby"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mastering the Art of Filtering: An In-Depth Look at fby in KDB/Q</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-select-statement" class="table-of-contents__link toc-highlight">The <code>select</code> Statement</a><ul><li><a href="#syntax" class="table-of-contents__link toc-highlight">Syntax</a></li><li><a href="#selecting-columns-the-columns-phrase" class="table-of-contents__link toc-highlight">Selecting Columns: The column(s) phrase</a><ul><li><a href="#nested-columns-handle-with-care" class="table-of-contents__link toc-highlight">Nested Columns: Handle with Care</a></li></ul></li><li><a href="#filtering-your-data-mastering-the-where-clause" class="table-of-contents__link toc-highlight">Filtering Your Data: Mastering the Where Clause</a><ul><li><a href="#multiple-where-clauses" class="table-of-contents__link toc-highlight">Multiple Where Clauses</a></li><li><a href="#the-virtual-column-i-in-a-where-clause" class="table-of-contents__link toc-highlight">The virtual column <code>i</code> in a <code>where clause</code></a></li><li><a href="#leveraging-the-flexibility-of-kdbq-writing-powerful-q-sql-queries" class="table-of-contents__link toc-highlight">Leveraging the Flexibility of KDB/Q: Writing Powerful Q-SQL Queries</a></li><li><a href="#demystifying-the-magic-of-where-clauses" class="table-of-contents__link toc-highlight">Demystifying the Magic of Where Clauses</a></li></ul></li><li><a href="#grouping-data-the-by-clause" class="table-of-contents__link toc-highlight">Grouping Data: The <code>by</code> clause</a><ul><li><a href="#by-clause-demystified" class="table-of-contents__link toc-highlight">By clause demystified</a></li><li><a href="#how-to-retrieve-the-last-element-for-a-specific-identifier" class="table-of-contents__link toc-highlight">How to Retrieve the Last Element for a Specific Identifier</a></li></ul></li></ul></li><li><a href="#the-update-statement" class="table-of-contents__link toc-highlight">The <code>update</code> statement</a><ul><li><a href="#syntax-1" class="table-of-contents__link toc-highlight">Syntax</a><ul><li><a href="#conformability-matters-update-modifications-are-vector-operations" class="table-of-contents__link toc-highlight">Conformability Matters: Update Modifications Are Vector Operations</a></li></ul></li></ul></li><li><a href="#the-delete-statement" class="table-of-contents__link toc-highlight">The <code>delete</code> Statement</a><ul><li><a href="#syntax-2" class="table-of-contents__link toc-highlight">Syntax</a></li></ul></li><li><a href="#the-exec-statement" class="table-of-contents__link toc-highlight">The <code>exec</code> Statement</a><ul><li><a href="#syntax-3" class="table-of-contents__link toc-highlight">Syntax</a><ul><li><a href="#the-magic-of-exec" class="table-of-contents__link toc-highlight">The Magic of <code>exec</code></a></li><li><a href="#crafting-elegant-queries-with-exec-simplify-your-q-sql" class="table-of-contents__link toc-highlight">Crafting Elegant Queries with exec: Simplify Your Q-SQL</a></li></ul></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Learn</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/defconq/" target="_blank" rel="noopener noreferrer" class="footer__link-item">DefconQ Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/alexanderunterrainer/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Alexander Unterrainer Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://defconq.myspreadshop.co.uk" target="_blank" rel="noopener noreferrer" class="footer__link-item">DefconQ Swag<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://www.youtube.com/@DefconQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube Channel<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/DefconQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 DefconQ Ltd. This website is maintained by Alexander Unterrainer. Disclaimer: All content shared on this website reflect solely his personal thoughts and opinions, and is not representative of any past, current, or future employers or affiliations.</div></div></div></footer></div>
</body>
</html>