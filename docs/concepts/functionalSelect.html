<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts/functionalSelect" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Embracing Terseness: Functional Forms and Parse Trees | DefconQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://DefconQ.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://DefconQ.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://DefconQ.github.io/docs/concepts/functionalSelect"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Embracing Terseness: Functional Forms and Parse Trees | DefconQ"><meta data-rh="true" name="description" content="Over the past few weeks, we&#x27;ve explored a lot about querying data, starting with Q-SQL and progressing to the powerful capabilities of the fby operator. Now, there are only two topics left to dive into: the functional form of Q-SQL statements and parse trees. The functional form offers a more concise way of writing Q-SQL, and it ties closely to the concept of parse trees, which we will also cover. After that, we&#x27;ll move on to joins, which will be explored in an upcoming blog post."><meta data-rh="true" property="og:description" content="Over the past few weeks, we&#x27;ve explored a lot about querying data, starting with Q-SQL and progressing to the powerful capabilities of the fby operator. Now, there are only two topics left to dive into: the functional form of Q-SQL statements and parse trees. The functional form offers a more concise way of writing Q-SQL, and it ties closely to the concept of parse trees, which we will also cover. After that, we&#x27;ll move on to joins, which will be explored in an upcoming blog post."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://DefconQ.github.io/docs/concepts/functionalSelect"><link data-rh="true" rel="alternate" href="https://DefconQ.github.io/docs/concepts/functionalSelect" hreflang="en"><link data-rh="true" rel="alternate" href="https://DefconQ.github.io/docs/concepts/functionalSelect" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://R6JV2N50EX-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="DefconQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="DefconQ Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E9ED09HNE3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-E9ED09HNE3",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="DefconQ" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.5860f28a.css">
<script src="/assets/js/runtime~main.94be83a5.js" defer="defer"></script>
<script src="/assets/js/main.d8c246ca.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#74e8a3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Stay up to date with the latest blogs posts - subscribe to my free Substack newsletter now <a href="https://defconq.substack.com">Free Substack Newsletter</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="DefconQ Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="150" width="50"><img src="/img/logoLight.svg" alt="DefconQ Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="150" width="50"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Learn</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/about/about">About</a><a class="navbar__item navbar__link" href="/testimonials/testimonials">Testimonials</a><a class="navbar__item navbar__link" href="/cv/cv">CV</a><a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://defconq.myspreadshop.co.uk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Swag<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/DefconQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-study-roadmap">KDB/Q Study Roadmap</a><button aria-label="Expand sidebar category &#x27;KDB/Q Study Roadmap&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-language">KDB/Q Language</a><button aria-label="Expand sidebar category &#x27;KDB/Q Language&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdb-architecture">KDB Architecture</a><button aria-label="Expand sidebar category &#x27;KDB Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/important-concepts">Important Concepts</a><button aria-label="Collapse sidebar category &#x27;Important Concepts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/attributes">Attributes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/memoryManagement">Memory Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/garbageCollection">Garbage Collection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/amend">Amend, Amend At: The Swiss Army knife among KDB/Q operators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/dictionariesTables">Dictionaries and Tables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/qsql">QSQL - Querying Your Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/fby">Mastering the Art of Filtering: An In-Depth Look at fby in KDB/Q</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/concepts/functionalSelect">Embracing Terseness: Functional Forms and Parse Trees</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/joins">Joins: Connecting the Dots for Data Clarity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/iterators">Iterators: Navigating Vectors Without the Need for Loops</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/ipc">Fundamentals of Interprocess Communication (IPC)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/ipcNextLevel">Beyond the Fundamentals: Next Level Interprocess Communications</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/tutorials">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/productivity-tools">Productivity Tools</a><button aria-label="Expand sidebar category &#x27;Productivity Tools&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/important-concepts"><span itemprop="name">Important Concepts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Embracing Terseness: Functional Forms and Parse Trees</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Embracing Terseness: Functional Forms and Parse Trees</h1>
<p>Over the past few weeks, we&#x27;ve explored a lot about querying data, starting with Q-SQL and progressing to the powerful capabilities of the <code>fby</code> operator. Now, there are only two topics left to dive into: the functional form of Q-SQL statements and parse trees. The functional form offers a more concise way of writing Q-SQL, and it ties closely to the concept of parse trees, which we will also cover. After that, we&#x27;ll move on to <strong>joins</strong>, which will be explored in an upcoming blog post.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-functional-form-matters">Why Functional Form Matters<a href="#why-functional-form-matters" class="hash-link" aria-label="Direct link to Why Functional Form Matters" title="Direct link to Why Functional Form Matters">​</a></h2>
<p>Understanding and applying the functional form of Q-SQL statements in KDB/Q is essential. The functional form offers numerous advantages over traditional Q-SQL, including the flexibility to dynamically select columns and build <code>where clauses</code>. Mastery of the functional form and the ability to translate Q-SQL statements into it is a crucial skill for any KDB/Q programmer. Consider a simple example where we need an API that allows a user to dynamically choose data from a table. We’ll develop two APIs: one using conventional Q-SQL and one with the equivalent functional form. This example will clearly demonstrate why knowing the functional form of a Q-SQL query is so valuable.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// First, let&#x27;s create a trade table we can select from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)show trade:([] sym:100?`AAPL`FB`MSFT`GOOG; price:100?100.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FB   40.99561</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FB   61.08817</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FB   49.76492</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 40.87545</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 44.9731</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 1.392076</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 19.46509</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 9.059026</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FB   62.03014</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 93.26316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FB   27.47066</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FB   5.752516</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 25.60658</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Let&#x27;s have a quick look at our data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select count i by sym from trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym | x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----| --</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL| 29</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FB  | 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG| 21</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT| 30</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>First, we would like to write a simple API that allows the user to select data for specific symbols. In simple Q-SQL, the query is straightforward: <code>select from trader where sym in `GOOG`MSFT</code>. But how can we make this dynamic, allowing symbols to be passed in at runtime? Here’s a useful trick: we construct a string with our Q-SQL query, then use the <code>value</code> operator to evaluate it. Let’s give it a try!</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select from trade where sym in `GOOG`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 40.87545</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 44.9731</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 19.46509</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 9.059026</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 93.26316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 16.27662</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 81.77547</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 41.2317</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 38.67353</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 72.6781</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)value &quot;select from trade where sym in `GOOG`MSFT&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 40.87545</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 44.9731</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 19.46509</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 9.059026</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 93.26316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 16.27662</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 81.77547</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 41.2317</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 38.67353</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 72.6781</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(select from trade where sym in `GOOG`MSFT)~value &quot;select from trade where sym in `GOOG`MSFT&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Since we know that evaluating the string version of our Q-SQL query produces the same result as running the query directly, we can now dynamically build this string. Let’s go through the process step by step.</p>
<p>The first part of our Q-SQL query is pretty straightforward, all we have to do is to build the where clause. Let&#x27;s first store the symbols we are interested in, in a variable called col.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)show col:`GOOG`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`GOOG`MSFT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, we have to build the string &quot;<code>GOOG</code>MSFT&quot; from this variable. Let&#x27;s try to use the <a href="https://code.kx.com/q/ref/string/" target="_blank" rel="noopener noreferrer"><code>string</code></a>  keyword to achieve this.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)string col</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;GOOG&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;MSFT&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That doesn&#x27;t look quite right, does it?!? Since the <code>string</code> operator is atomic in KDB/Q, it applies individually to each element of the list, creating multiple separate strings instead of a single, cohesive one. Additionally, the backticks are missing, which can lead to a type error because the <code>sym</code> column is of type <code>symbol</code>, not <code>string</code>. To resolve this, we’ll use another powerful tool in KDB/Q: the <a href="https://code.kx.com/q/ref/sv/" target="_blank" rel="noopener noreferrer"><code>sv</code></a> (<strong>s</strong>calar from <strong>v</strong>ector) operator.. Let&#x27;s have a look how this works.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x sv y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Given a list of strings <code>y</code>, and a char atom <code>x</code>, <code>sv</code> returns the list of strings <code>y</code> as a single string, separated by <code>x</code>. Since we need a leading backtick at the beginning of our string, we’ll prepend an empty symbol (a backtick) to the original list. This will produce the desired result.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)&quot;`&quot; sv string `GOOG`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;GOOG`MSFT&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)&quot;`&quot; sv string ``GOOG`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;`GOOG`MSFT&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, all that is left to do, is to concatenate the where clause we just created, with the initial part of our Q-SQL query and apply the value keyword to it. Let&#x27;s do that.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)value &quot;select from trade where sym in&quot;,&quot;`&quot; sv string ``GOOG`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 40.87545</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 44.9731</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 19.46509</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 9.059026</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 93.26316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 16.27662</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 81.77547</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 41.2317</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 38.67353</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 72.6781</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(select from trade where sym in `GOOG`MSFT)~value &quot;select from trade where sym in&quot;,&quot;`&quot; sv string ``GOOG`MSFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That worked like a charm. We can now reuse this piece of code to create our API.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">f:{[col] </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  query:&quot;select from trade where sym in &quot;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  query:query,&quot;`&quot; sv string `,col; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s test our API and call it with our symbols</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)f[`GOOG`MSFT]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 40.87545</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 44.9731</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 19.46509</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 9.059026</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 93.26316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 16.27662</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 81.77547</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 41.2317</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 38.67353</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 72.6781</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(select from trade where sym in `GOOG`MSFT)~f[`GOOG`MSFT]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Although our API functions as expected, we had to write quite a bit of code for a simple query. Imagine building something more complex — adding a <code>by</code> clause or some aggregation. This would require even more code and string concatenation, which is not only inefficient but also prone to errors. A more efficient and reliable approach is to use the functional form of the Q-SQL query. The equivalent functional form of our Q-SQL example is <code>?[`trade;enlist (in;`sym;enlist `GOOG`MSFT);0b;()]</code>. We&#x27;ll explore how to construct the functional form later; for now, trust that this is the correct functional form.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)?[`trade;enlist (in;`sym;enlist `GOOG`MSFT);0b;()]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 40.87545</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 44.9731</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 19.46509</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 9.059026</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 93.26316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 16.27662</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 81.77547</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 41.2317</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 38.67353</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 72.6781</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(select from trade where sym in `GOOG`MSFT)~?[`trade;enlist (in;`sym;enlist `GOOG`MSFT);0b;()]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The functional form of a Q-SQL query simplifies API creation significantly, reducing this example to a single line of code.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">f:{[col] </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ?[`trade;enlist (in;`sym;enlist col);0b;()]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That was so much easier, wasn&#x27;t it?!? Let&#x27;s make sure our API returns the correct result</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)f[`GOOG`MSFT]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 40.87545</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 44.9731</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 19.46509</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 9.059026</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 93.26316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 16.27662</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 81.77547</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 41.2317</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 38.67353</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 72.6781</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(select from trade where sym in `GOOG`MSFT)~f[`GOOG`MSFT]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The functional form of a Q-SQL query simplifies API creation significantly, reducing this example to a single line of code. The example above clearly demonstrates the importance of the functional form for creating dynamic queries and APIs. Before diving deeper into functional forms, we’ll take a brief detour to explore parse trees, as they are closely related to the functional form.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="parse-trees-the-key-to-dynamic-queries">Parse Trees: The Key to Dynamic Queries<a href="#parse-trees-the-key-to-dynamic-queries" class="hash-link" aria-label="Direct link to Parse Trees: The Key to Dynamic Queries" title="Direct link to Parse Trees: The Key to Dynamic Queries">​</a></h2>
<p>In its most simple form, at its core, a Parse Tree is a list where the first element represents a function, and the subsequent elements are the arguments. Each of these elements can also be parse trees on their own. The below example should illustrate this concept</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// parse tree of &quot;2+2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(+;2;2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The general form of a Parse Tree is</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(function; arg 1; …; arg n)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>where every argument of the list, <code>arg 1;...arg n</code> could be a parse tree itself.</p>
<p><img decoding="async" loading="lazy" alt="Parse Tree Syntax" src="/assets/images/parseTree-4419ee96936581e9d646fa4f52e128e1.png" width="1210" height="480" class="img_ev3q"></p>
<p>In order to evaluate a parse tree, we can use the keyword <code>value</code> as we have seen in the previous section when evaluating the string form of a Q-SQL query.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)value (+;2;2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Another operator that can evaluate parse trees is the <a href="https://code.kx.com/q/ref/eval/#eval" target="_blank" rel="noopener noreferrer"><code>eval</code></a>, operator, as demonstrated below.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)eval (til;5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3 4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="eval-vs-value"><code>eval</code> vs <code>value</code><a href="#eval-vs-value" class="hash-link" aria-label="Direct link to eval-vs-value" title="Direct link to eval-vs-value">​</a></h3>
<p>Although <a href="https://code.kx.com/q/ref/eval/#eval" target="_blank" rel="noopener noreferrer"><code>eval</code></a> and <a href="https://code.kx.com/q/ref/value/" target="_blank" rel="noopener noreferrer"><code>value</code></a> appear to return the same result when evaluating the parse tree above, there is a key difference: <code>eval</code> works on parse trees and evaluates any nested parse trees, while <code>value</code> operates only on literals and does NOT evaluate nested parse trees. The below examples will illustrate these differences</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)value(+;7;3)                  //parse tree, with no nested trees</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)eval(+;7;3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)eval(+;7;(+;2;1))             //parse tree with nested trees</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)value(+;7;(+;2;1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)value(,;`a;`b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`a`b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)eval(,;`a;`b)                 //no variable b defined</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)eval(,;enlist `a;enlist `b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`a`b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>NOTE: Symbols must be enlisted when evaluating a parse tree with <code>eval</code>; otherwise, they will be interpreted as variables.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parse-your-ultimate-helper-tool-for-buidling-parse-trees"><code>parse</code>: Your Ultimate Helper Tool for Buidling Parse Trees<a href="#parse-your-ultimate-helper-tool-for-buidling-parse-trees" class="hash-link" aria-label="Direct link to parse-your-ultimate-helper-tool-for-buidling-parse-trees" title="Direct link to parse-your-ultimate-helper-tool-for-buidling-parse-trees">​</a></h3>
<p>While parse trees may seem complex at first, creating them is actually quite simple, even for beginners. By using the <a href="https://code.kx.com/q/ref/parse/" target="_blank" rel="noopener noreferrer"><code>parse</code></a> keyword, you can easily generate a parse tree from any KDB/Q statement represented as a string. Let&#x27;s give it a try!</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)parse&quot;2+2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)eval parse &quot;2+2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As seen earlier, you can then use the <code>eval</code> operator to evaluate a parse tree.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parse-gotchas">Parse Gotchas<a href="#parse-gotchas" class="hash-link" aria-label="Direct link to Parse Gotchas" title="Direct link to Parse Gotchas">​</a></h3>
<p>There are two main Gotchas to keep in mind with the <code>parse</code> keyword, one of which we’ve already covered. As mentioned, symbols must be enlisted to be used in parse trees. The other important point is that <code>parse</code> displays all items in the parse tree using <code>k</code> syntax.  Once you&#x27;re aware of these two details, the <code>parse</code> operator becomes a powerful and easy-to-use tool for creating parse trees.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)string `hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;hello&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)parse &quot;string `hello&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,`hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)eval (string;enlist `hello)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;hello&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The example above demonstrates the two main gotchas with the <code>parse</code> keyword. All built-in KDB/Q operators are shown in their corresponding underlying <code>k</code> syntax, and symbols must be enlisted.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The <code>k</code> syntax for <code>enlist</code> is <code>,</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)(,) `hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,`hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)k),`hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,`hello</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="functional-forms">Functional Forms<a href="#functional-forms" class="hash-link" aria-label="Direct link to Functional Forms" title="Direct link to Functional Forms">​</a></h2>
<p>In previous sections, we discussed the importance of using the functional form of a Q-SQL query and the reasons for doing so. Now, we&#x27;ll examine the performance differences between the functional form and a pure Q-SQL statement, exploring when each should be used. We’ll also cover the syntax of individual Q-SQL statements - <code>select</code>, <code>exec</code>, <code>update</code> and `delete - and how to construct them.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="performance-functional-form-vs-traditional-q-sql">Performance: Functional Form vs Traditional Q-SQL<a href="#performance-functional-form-vs-traditional-q-sql" class="hash-link" aria-label="Direct link to Performance: Functional Form vs Traditional Q-SQL" title="Direct link to Performance: Functional Form vs Traditional Q-SQL">​</a></h3>
<p>First things first, let&#x27;s address what interests most people: performance. Is there a performance advantage to using the functional form of a Q-SQL query over a standard Q-SQL statement? The short answer is: NO. The slightly longer answer is that while there may be a minimal performance gain when using the functional form, it’s so minor that it’s negligible. KDB/Q actually translates every Q-SQL statement into its functional form behind the scenes before executing it.</p>
<p>To illustrate, if we measure the time it takes to parse a simple Q-SQL statement, we see that even parsing it a million times takes under a second. Only when we reach ten million parses does the time reach eight seconds.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts:100 parse &quot;select from trade&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 912</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts:10000 parse &quot;select from trade&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">20 912</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts:1000000 parse &quot;select from trade&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">822 912</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts:10000000 parse &quot;select from trade&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8156 912</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It&#x27;s highly unlikely that any KDB/Q code will hit ten million Q-SQL queries. Admittedly, I used a very simple query here, and more complex ones might take longer, but it’s reasonable to assume that the time difference for parsing more complex queries remains negligible as well.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="when-should-you-use-the-functional-form">When Should You Use the Functional Form?<a href="#when-should-you-use-the-functional-form" class="hash-link" aria-label="Direct link to When Should You Use the Functional Form?" title="Direct link to When Should You Use the Functional Form?">​</a></h3>
<p>So, when should you use the functional form instead of a traditional Q-SQL statement? The answer is simple: only when absolutely necessary. If you&#x27;re building an API that requires dynamically generated queries, with user-parameterized inputs - go ahead. This is This is an ideal case for the functional form.</p>
<p>But if your reason is just to save a few characters, show off your skills, or impress colleagues - don&#x27;t. Think twice. We&#x27;ve just discovered that there&#x27;s virtually no (or minimal) performance benefit to functional queries over traditional Q-SQL. So why make the code harder to read for others (or even yourself later on)? The functional form of a Q-SQL query is generally more challenging to read and understand. And we all know developers don&#x27;t always comment code as thoroughly as they should. So, unless there’s a compelling reason to use the functional form over a traditional Q-SQL statement, stick with the straightforward approach.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-syntax">The Syntax<a href="#the-syntax" class="hash-link" aria-label="Direct link to The Syntax" title="Direct link to The Syntax">​</a></h3>
<p>Every Q-SQL statement has its corresponding functional form. The general syntax of the functional forms is</p>
<p><img decoding="async" loading="lazy" alt="Functional Form Syntax" src="/assets/images/functionalForm-e1327a7dfa6b7841dba0ecfba97a1a94.png" width="1120" height="380" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">?[t;c;b;a]              /select or exec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">![t;c;b;a]              /update and delete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?[t;i;p]                /simple exec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?[t;c;b;a;n]            /select up to n records</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?[t;c;b;a;n;(g;cn)]     /select up to n records sorted by g on cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>where</p>
<ul>
<li><code>t</code> is a table, or the name of a table as a symbol atom.</li>
<li><code>c</code> is the <code>where clause</code>, a list of constrains represented as a list of parse trees. As in a traditional Q-SQL statement, the selection is performed in the order of the items in c, from left to right: only rows selected by one constraint are evaluated by the next.</li>
<li><code>b</code> is the <code>by phrase</code>. The <code>by phrase</code> can have the following forms<!-- -->
<ul>
<li>the general empty list (), indicating that the functional form is of an exec rather than a select statement</li>
<li>a boolean atom: <code>0b</code> for no grouping, <code>1b</code> for distinct rows</li>
<li>a symbol atom or a list naming table column(s)</li>
<li>a dictionary of group-by specifications</li>
</ul>
</li>
<li><code>a</code> is the <code>select phrase</code> and can take one of the following forms<!-- -->
<ul>
<li>the general empty list ()</li>
<li>a symbol atom: the name of a table column</li>
<li>a parse tree: Each item of its range is an evaluation list consisting of a function and its argument(s)</li>
<li>a dictionary of select specifications (aggregations)</li>
</ul>
</li>
<li><code>i</code> is a list of indexes</li>
<li><code>p</code> is a parse tree</li>
<li><code>n</code> is a non-negative integer or infinity, indicating the maximum number of records to be returned</li>
<li><code>g</code> is a unary grade function</li>
</ul>
<p>A comprehensive discussion of each functional form is beyond the scope of this blog post, as <a href="https://code.kx.com/home/" target="_blank" rel="noopener noreferrer">KX</a> has already covered this in detail on their website here: <a href="https://code.kx.com/q/basics/funsql/" target="_blank" rel="noopener noreferrer">Functional qSQL</a>. That said, I’ll show you how you can easily transform any Q-SQL query into its equivalent functional form.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parse-your-go-to-tool-for-building-functional-forms"><code>parse</code>: Your Go-To Tool for Building Functional Forms<a href="#parse-your-go-to-tool-for-building-functional-forms" class="hash-link" aria-label="Direct link to parse-your-go-to-tool-for-building-functional-forms" title="Direct link to parse-your-go-to-tool-for-building-functional-forms">​</a></h3>
<p>We’ve already explored how the <code>parse</code> keyword can generate a parse tree from any KDB/Q expression. However, one of the most practical uses of <code>parse</code> is for translating Q-SQL queries into their equivalent functional form. Take, for example, the initial Q-SQL query we used in our simple API: <code>select from trade where sym in `GOOG`MSFT</code>. By wrapping this query in quotation marks and applying the <code>parse</code> operator, we can easily obtain the corresponding functional form.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)parse &quot;select from trade where sym in `GOOG`MSFT&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,,(in;`sym;,`GOOG`MSFT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It&#x27;s that simple. If we now evaluate our parse tree using <code>eval</code> we get the same result as with our traditional Q-SQL query. This can easily be verified.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)eval parse &quot;select from trade where sym in `GOOG`MSFT&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 40.87545</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 44.9731</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 19.46509</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 9.059026</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 93.26316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 16.27662</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 81.77547</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 41.2317</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 38.67353</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 72.6781</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(select from trade where sym in `GOOG`MSFT)~eval parse &quot;select from trade where sym in `GOOG`MSFT&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you&#x27;re new to parse trees and functional forms, the functional form generated by the <code>parse</code> keyword might look a bit unfamiliar — it is, after all, returned in <code>k</code> code. Additionally, there are two main nuances to be aware of. Let’s break these down for clarity.</p>
<p><img decoding="async" loading="lazy" alt="Functional Form Parse Tree Syntax" src="/assets/images/functionalFormParseTree-b519ad9e0ec2838bd44b922798365879.png" width="1120" height="380" class="img_ev3q"></p>
<p>The first thing to notice is that the <code>where clause</code> in the functional form has an extra comma at the start, which we should ignore. As <a href="https://code.kx.com/q4m3/9_Queries_q-sql/#912-functional-forms" target="_blank" rel="noopener noreferrer"><strong>KX</strong></a> explains: &quot;The constraint portion of the result of <code>parse</code> applied to a string containing a q-sql query template generally has an extra level of <code>enlist</code> that should be removed for the corresponding functional form. In the console, this extra enlist shows up in <code>k</code> form as a double comma <code>, , </code>.</p>
<p>The second comma has a simple explanation: The <code>where clause</code> constraint is represented as a <strong>list</strong> of constraints in the parse tree format. Since our example has only one constraint (a single <code>where clause</code>), we need to create a list of constraints by using <code>enlist</code> on the result.</p>
<p>Considering the above, our where clause can be rewritten as</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enlist (in;`sym;,`GOOG`MSFT)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The second observation we make, is that in a parse tree, a variable is represented by a symbol that holds its name. So, when representing a symbol or list of symbols, you must use <code>enlist</code> before that expression. In <code>k</code>, <code>enlist</code> is the unary form of the comma operator. If you omit this step, KDB/Q will attempt to interpret <code>GOOG</code> and <code>MSFT</code> as column names in the <code>trade</code> table instead of as variables. Therefore, we need to rewrite the <code>where clause</code> as follows.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enlist (in;`sym;enlist `GOOG`MSFT)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Applying these changes to our initial result from parse we obtain the following functional form for our simple Q-SQL query</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)?[`trade;enlist (in;`sym;enlist `GOOG`MSFT);0b;()]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 78.33686</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 40.87545</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 44.9731</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 71.48779</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 19.46509</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 9.059026</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 93.26316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 23.10108</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 86.71096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 72.78528</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 16.27662</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 81.77547</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 41.2317</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 38.67353</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 72.6781</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(select from trade where sym in `GOOG`MSFT)~?[`trade;enlist (in;`sym;enlist `GOOG`MSFT);0b;()]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using <code>parse</code> for more complex Q-SQL queries may seem a bit challenging at first, but you can break it down step-by-step. Just keep in mind:</p>
<ul>
<li>The <code>parse</code> output will be displayed as <code>k</code> code</li>
<li>The <code>where clause</code> includes an extra commma at the beginning</li>
<li>Symbols must be enlisted to be recognised as variables</li>
</ul>
<p>Let&#x27;s look at ta more complex example</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)select sym,price from trade where price=(max;price) fby sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 95.98964</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FB   98.77844</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 91.49882</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 97.97281</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)parse &quot;select sym,price from trade where price=(max;price) fby sym&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,,(=;`price;(k){$[(#x 1)=#y;@[(#y)#x[0]0#x 1;g;:;x[0]&#x27;x[1]g:.=y];&#x27;`length]};(enlist;max;`price);`sym))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`sym`price!`sym`price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If you would like to learn more about the <code>fby</code> operator, read my previous blog post <a href="https://www.defconq.tech/docs/concepts/fby" target="_blank" rel="noopener noreferrer">Mastering the Art of Filtering: An In-Depth Look at fby in KDB/Q</a></p></div></div>
<p>This may look like quite a bit of gibberish at first glance. Following the low-hanging-fruit principle, let’s start with the straightforward parts of the functional form. The table, <code>by clause</code>, and <code>select clause</code> can be directly copied into our functional form. The only thing left to decipher is the <code>where clause</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">?[`trade; To-Do; 0b; `sym`price!`sym`price]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When looking at the <code>where clause</code>, it’s important to remember that it’s represented as a parse tree or list of parse trees, displayed in <code>k</code> code. By parsing the <code>where clause</code> independently, we can simplify our task significantly.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)parse &quot;price=(max;price) fby sym&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(k){$[(#x 1)=#y;@[(#y)#x[0]0#x 1;g;:;x[0]&#x27;x[1]g:.=y];&#x27;`length]};(enlist;max;`price);`sym)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This can be translated into the following parse tree</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(=;`price; (k){$[(#x 1)=#y;@[(#y)#x[0]0#x 1;g;:;x[0]&#x27;x[1]g:.=y];&#x27;`length]};(enlist;max;`price);`sym))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>From our Q-SQL query, we know that our <code>where clause</code> includes a <code>fby</code>. So let&#x27;s examine the <code>k</code> code representation of the <code>fby</code> to understand it better.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)fby</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k){$[(#x 1)=#y;@[(#y)#x[0]0#x 1;g;:;x[0]&#x27;x[1]g:.=y];&#x27;`length]}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This aligns with some of the &quot;gibberish&quot; we saw when parsing the <code>where clause</code> independently. Now we can simply convert the <code>k</code> code into <code>q</code> code to make it more readable.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(=;`price;(fby;(enlist;max;`price)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Combining everything above we obtain the following functional form for our complex Q-SQL query</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)?[`trade;enlist (=;`price;(fby;(enlist;max;`price);`sym));0b;`sym`price!`sym`price]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym  price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL 95.98964</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FB   98.77844</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG 91.49882</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT 97.97281</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Verifying that the results actually matches</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)(select sym,price from trade where price=(max;price) fby sym)~?[`trade;enlist (=;`price;(fby;(enlist;max;`price);`sym));0b;`sym`price!`sym`price]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="three-key-gotchas-when-using-parse-for-functional-forms">Three Key Gotchas When Using <code>parse</code> for Functional Forms<a href="#three-key-gotchas-when-using-parse-for-functional-forms" class="hash-link" aria-label="Direct link to three-key-gotchas-when-using-parse-for-functional-forms" title="Direct link to three-key-gotchas-when-using-parse-for-functional-forms">​</a></h4>
<p>As we have seen, there are a few subtle gotchas when using the <code>parse</code> operator with Q-SQL queries. To help you remember these, let&#x27;s review them one more time.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="the-parse-output-will-be-displayed-as-k-code">The <code>parse</code> output will be displayed as <code>k</code> code<a href="#the-parse-output-will-be-displayed-as-k-code" class="hash-link" aria-label="Direct link to the-parse-output-will-be-displayed-as-k-code" title="Direct link to the-parse-output-will-be-displayed-as-k-code">​</a></h5>
<p>As we&#x27;ve observed, the output of the <code>parse</code> operator is actual <code>k</code> code. This applies not only to common <code>q</code> operators but also to <code>q</code> keywords, which can be implemented in <code>k</code> behind the scenes. This can make interpreting the parsed query output a bit more challenging. However, you can simplify this by comparing the parsed output directly with your original Q-SQL query to identify any <code>q</code> keywords that have been translated into their <code>k</code> equivalent.</p>
<p>For example</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)parse &quot;select first price from trade&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(,`price)!,(*:;`price)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Examining the <code>select phrase</code> of the above Q-SQL query and seeing that we selected <code>first price</code>, we do realise that the corresponding <code>k</code> operator for the <code>first</code> <code>q</code> operator is `*:. Let&#x27;s confirm this</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)first 1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)k)*1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(*:)1 2 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="the-where-clause-includes-an-extra-commma-at-the-beginning">The <code>where clause</code> includes an extra commma at the beginning<a href="#the-where-clause-includes-an-extra-commma-at-the-beginning" class="hash-link" aria-label="Direct link to the-where-clause-includes-an-extra-commma-at-the-beginning" title="Direct link to the-where-clause-includes-an-extra-commma-at-the-beginning">​</a></h5>
<p>Another nuance we&#x27;ve encountered is that the parsed <code>where clause</code> includes an extra comma at the beginning. This occurs because <code>parse</code> applied to a Q-SQL query template often introduces an additional level of <code>enlist</code> that needs to be removed for the functional form. In the console, the parse tree displays the <code>k</code> form of enlist (<code>,</code>) as <code>,,</code>. This is easily corrected by simply removing the extra comma and using <code>enlist</code> where necessary.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)parse &quot;select from trade where sym=`GOOG&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,,(=;`sym;,`GOOG)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(select from trade where sym=`GOOG)~?[`trade;enlist (=;`sym;enlist `GOOG);0b;()]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="symbols-must-be-enlisted-to-be-recognised-as-variables">Symbols must be enlisted to be recognised as variables<a href="#symbols-must-be-enlisted-to-be-recognised-as-variables" class="hash-link" aria-label="Direct link to Symbols must be enlisted to be recognised as variables" title="Direct link to Symbols must be enlisted to be recognised as variables">​</a></h5>
<p>In a parse tree, a variable is represented by a symbol containing its name. Therefore, to represent a single symbol or a list of symbols, you need to use <code>enlist</code> on that expression. In <code>k</code>, <code>enlist</code> is the unary form of the comma operator, which can be a bit confusing initially but becomes intuitive with practice.</p>
<p>This concept is especially clear when you try to parse a simple symbol. You&#x27;ll see that the <code>parse</code> operator adds <code>enlist</code> to differentiate between a variable name and an actual symbol.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)parse &quot;`google&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,`google</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="escaping-strings-essential-when-using-parse">Escaping Strings: Essential When Using <code>parse</code><a href="#escaping-strings-essential-when-using-parse" class="hash-link" aria-label="Direct link to escaping-strings-essential-when-using-parse" title="Direct link to escaping-strings-essential-when-using-parse">​</a></h5>
<p>The final gotcha to be aware of is that when parsing a string, you need to escape any quotation marks around it. This is necessary because the input to the parse operator is itself a string. Let’s look at an example to clarify this.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)parse &quot;select from trade where sym like &quot;*GO*&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;GO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [0]  parse &quot;select from trade where sym like &quot;*GO*&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                 ^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, omitting the escaped quotation marks when parsing a string results in an error. To parse a string, we need to use the escape character <code>\</code> to properly escape the quotation marks.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)parse &quot;select from trade where sym like \&quot;*GO*\&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,,(like;`sym;&quot;*GO*&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="abc-your-memory-hack-for-functional-form-mastery">ABC: Your Memory Hack for Functional Form Mastery<a href="#abc-your-memory-hack-for-functional-form-mastery" class="hash-link" aria-label="Direct link to ABC: Your Memory Hack for Functional Form Mastery" title="Direct link to ABC: Your Memory Hack for Functional Form Mastery">​</a></h3>
<p>I&#x27;ve conducted numerous (mock) interviews, and a common challenge for KDB/Q developers has been recalling the functional form syntax of a Q-SQL query. This is understandable, especially for junior developers or those who don’t use functional forms frequently and often rely on the <code>parse</code> keyword to generate them. I once faced this challenge myself, which led me to create a memory hack that can help anyone remember the syntax effortlessly. Just think of &quot;ABC&quot; in reverse: &quot;CBA.&quot; Here’s how it works: the syntax for the functional form is <code>? [t; c; b; a]</code>, where <code>t</code> stands for <strong>t</strong>able, followed by &quot;CBA&quot; in reverse order. <strong>C</strong> represents the where <strong>c</strong>lause, <strong>B</strong> stands for the <strong>b</strong>y clause, and <strong>A</strong> is the select or <strong>a</strong>ggregation clause (remember <strong>A</strong> for <strong>a</strong>ggregation if that helps!).</p>
<p><img decoding="async" loading="lazy" alt="Functional Form ABC Syntax" src="/assets/images/functionalFormABC-d11160de0cb5eb0e294f229e8f7237bf.png" width="1120" height="380" class="img_ev3q"></p>
<p><strong>And that&#x27;s it—another topic complete! Happy coding, and feel free to reach out with any questions.</strong></p>
<p><strong>Resources</strong>:</p>
<ul>
<li><a href="https://code.kx.com/q/basics/parsetrees/" target="_blank" rel="noopener noreferrer">Parse trees</a></li>
<li><a href="https://code.kx.com/q4m3/9_Queries_q-sql/#912-functional-forms" target="_blank" rel="noopener noreferrer">Q for Mortals, Chapter 9: Queries Q-SQL, 9.12 Functional Forms</a></li>
<li><a href="https://code.kx.com/q/basics/funsql/" target="_blank" rel="noopener noreferrer">Functional qSQL</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/concepts/fby"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Mastering the Art of Filtering: An In-Depth Look at fby in KDB/Q</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/concepts/joins"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Joins: Connecting the Dots for Data Clarity</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-functional-form-matters" class="table-of-contents__link toc-highlight">Why Functional Form Matters</a></li><li><a href="#parse-trees-the-key-to-dynamic-queries" class="table-of-contents__link toc-highlight">Parse Trees: The Key to Dynamic Queries</a><ul><li><a href="#eval-vs-value" class="table-of-contents__link toc-highlight"><code>eval</code> vs <code>value</code></a></li><li><a href="#parse-your-ultimate-helper-tool-for-buidling-parse-trees" class="table-of-contents__link toc-highlight"><code>parse</code>: Your Ultimate Helper Tool for Buidling Parse Trees</a></li><li><a href="#parse-gotchas" class="table-of-contents__link toc-highlight">Parse Gotchas</a></li></ul></li><li><a href="#functional-forms" class="table-of-contents__link toc-highlight">Functional Forms</a><ul><li><a href="#performance-functional-form-vs-traditional-q-sql" class="table-of-contents__link toc-highlight">Performance: Functional Form vs Traditional Q-SQL</a></li><li><a href="#when-should-you-use-the-functional-form" class="table-of-contents__link toc-highlight">When Should You Use the Functional Form?</a></li><li><a href="#the-syntax" class="table-of-contents__link toc-highlight">The Syntax</a></li><li><a href="#parse-your-go-to-tool-for-building-functional-forms" class="table-of-contents__link toc-highlight"><code>parse</code>: Your Go-To Tool for Building Functional Forms</a><ul><li><a href="#three-key-gotchas-when-using-parse-for-functional-forms" class="table-of-contents__link toc-highlight">Three Key Gotchas When Using <code>parse</code> for Functional Forms</a><ul><li><a href="#the-parse-output-will-be-displayed-as-k-code" class="table-of-contents__link toc-highlight">The <code>parse</code> output will be displayed as <code>k</code> code</a></li><li><a href="#the-where-clause-includes-an-extra-commma-at-the-beginning" class="table-of-contents__link toc-highlight">The <code>where clause</code> includes an extra commma at the beginning</a></li><li><a href="#symbols-must-be-enlisted-to-be-recognised-as-variables" class="table-of-contents__link toc-highlight">Symbols must be enlisted to be recognised as variables</a></li><li><a href="#escaping-strings-essential-when-using-parse" class="table-of-contents__link toc-highlight">Escaping Strings: Essential When Using <code>parse</code></a></li></ul></li></ul></li><li><a href="#abc-your-memory-hack-for-functional-form-mastery" class="table-of-contents__link toc-highlight">ABC: Your Memory Hack for Functional Form Mastery</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Learn</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/defconq/" target="_blank" rel="noopener noreferrer" class="footer__link-item">DefconQ Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/alexanderunterrainer/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Alexander Unterrainer Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://defconq.myspreadshop.co.uk" target="_blank" rel="noopener noreferrer" class="footer__link-item">DefconQ Swag<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://www.youtube.com/@DefconQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube Channel<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/DefconQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 DefconQ Ltd. This website is maintained by Alexander Unterrainer. Disclaimer: All content shared on this website reflect solely his personal thoughts and opinions, and is not representative of any past, current, or future employers or affiliations.</div></div></div></footer></div>
</body>
</html>