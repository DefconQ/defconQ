<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/researchHDB" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Back to the Future: Building Your Research HDB for Stock Market Insights | DefconQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://DefconQ.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://DefconQ.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://DefconQ.github.io/docs/tutorials/researchHDB"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Back to the Future: Building Your Research HDB for Stock Market Insights | DefconQ"><meta data-rh="true" name="description" content="In our last post, we explored how to build a real-time stock market data feed, but as any good quant knows, historical data is often the crystal ball we look into when trying to forecast future trends, or at least, give it our best shot."><meta data-rh="true" property="og:description" content="In our last post, we explored how to build a real-time stock market data feed, but as any good quant knows, historical data is often the crystal ball we look into when trying to forecast future trends, or at least, give it our best shot."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://DefconQ.github.io/docs/tutorials/researchHDB"><link data-rh="true" rel="alternate" href="https://DefconQ.github.io/docs/tutorials/researchHDB" hreflang="en"><link data-rh="true" rel="alternate" href="https://DefconQ.github.io/docs/tutorials/researchHDB" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://R6JV2N50EX-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="DefconQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="DefconQ Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E9ED09HNE3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-E9ED09HNE3",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="DefconQ" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.5860f28a.css">
<script src="/assets/js/runtime~main.833aceea.js" defer="defer"></script>
<script src="/assets/js/main.f16ed165.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#74e8a3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Stay up to date with the latest blogs posts - subscribe to my free Substack newsletter now <a href="https://defconq.substack.com">Free Substack Newsletter</a> or follow me on <a href="https://medium.com/@defconq">Medium</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="DefconQ Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="150" width="50"><img src="/img/logoLight.svg" alt="DefconQ Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="150" width="50"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Learn</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/about/about">About</a><a class="navbar__item navbar__link" href="/testimonials/testimonials">Testimonials</a><a class="navbar__item navbar__link" href="/happyHour/happyHour">Happy Hour</a><a class="navbar__item navbar__link" href="/cv/cv">CV</a><a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Substack Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://medium.com/@defconq" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://defconq.myspreadshop.co.uk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Swag<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/DefconQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-study-roadmap">KDB/Q Study Roadmap</a><button aria-label="Expand sidebar category &#x27;KDB/Q Study Roadmap&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-language">KDB/Q Language</a><button aria-label="Expand sidebar category &#x27;KDB/Q Language&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-architecture">KDB/Q Architecture</a><button aria-label="Expand sidebar category &#x27;KDB/Q Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/important-concepts">Important Concepts</a><button aria-label="Expand sidebar category &#x27;Important Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/design-patterns-for-kdbq-systems">Design Patterns for KDB/Q Systems</a><button aria-label="Expand sidebar category &#x27;Design Patterns for KDB/Q Systems&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/tutorials">Tutorials</a><button aria-label="Collapse sidebar category &#x27;Tutorials&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/tick">KDB Tick Explained: A Walkthrough [PART 1]</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/tick2">KDB Tick Explained: A Walkthrough [PART 2]</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/realTimeStocks">A Real Time Stock Market Feed</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorials/researchHDB">Back to the Future: Building Your Research HDB for Stock Market Insights</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/realTimeStocksUpdate">Streaming Smarter: Real-Time Market Data with Kola, Python, and Databento</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/productivity-tools">Productivity Tools</a><button aria-label="Expand sidebar category &#x27;Productivity Tools&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/tutorials"><span itemprop="name">Tutorials</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Back to the Future: Building Your Research HDB for Stock Market Insights</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Back to the Future: Building Your Research HDB for Stock Market Insights</h1>
<p>In our last post, we explored how to build a <a href="https://www.defconq.tech/docs/tutorials/realTimeStocks" target="_blank" rel="noopener noreferrer">real-time stock market data feed</a>, but as any good quant knows, historical data is often the crystal ball we look into when trying to forecast future trends, or at least, give it our best shot.</p>
<p>In this tutorial, you&#x27;ll learn how to build your very own <strong>historical stock market database</strong> for research and analysis, completely FREE of charge. Using <strong>Python</strong> and the <a href="https://github.com/ranaroussi/yfinance" target="_blank" rel="noopener noreferrer"><strong><code>yfinance</code></strong></a> library, we’ll fetch historical stock data from Yahoo Finance and save it to a CSV file. From there, we’ll load the data into <strong>KDB/Q</strong> and create a fully functional <strong>Research HDB</strong>.</p>
<p>Think it’ll take tons of code? Think again! It’s way simpler than you’d expect.</p>
<p>While this setup has been simplified for educational purposes, it can be easily adapted to resemble a more production-ready environment.</p>
<p><img decoding="async" loading="lazy" alt="Back to the Future" src="/assets/images/backToTheFuture-5c80c6922bdea78e4dcfde7553ef1d6f.jpg" width="976" height="549" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="who-is-this-tutorial-for">Who is this tutorial for?<a href="#who-is-this-tutorial-for" class="hash-link" aria-label="Direct link to Who is this tutorial for?" title="Direct link to Who is this tutorial for?">​</a></h2>
<p>This tutorial is for anyone keen to build a historical stock market database. Whether you&#x27;re a quant or researcher looking to analyze historical market data, or a KDB/Q developer curious about the technical implementation, there&#x27;s something valuable here for everyone.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<p>This tutorial is by far the easiest one I’ve put together, no deep KDB/Q knowledge required, making it perfect even for q-bies (beginner KDB/Q developers) to follow along. That said, if you&#x27;re curious to dive deeper into KDB/Q or explore a typical tick setup, I’ve included some helpful resources at the end of the post. A basic understanding of Python can be handy, but not necessary given that our trustworthy friend Claude is back lending us a hand with the Python code.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-in-it-for-you-skills-youll-master-in-this-tutorial">What’s in It for You: Skills You’ll Master in This Tutorial<a href="#whats-in-it-for-you-skills-youll-master-in-this-tutorial" class="hash-link" aria-label="Direct link to What’s in It for You: Skills You’ll Master in This Tutorial" title="Direct link to What’s in It for You: Skills You’ll Master in This Tutorial">​</a></h2>
<p>While this tutorial is relatively straightforward, it’s packed with valuable insights. You’ll learn how to read data from CSV files and persist it to disk using the full power of KDB/Q. We’ll explore how to benchmark performance using timer functions and discuss strategies to optimise your code for speed. You’ll also get an introduction to parallel processing with multi-threading and KDB/Q’s built-in parallel operators. On top of that, we’ll dive into the <a href="https://code.kx.com/q/ref/dotq/" target="_blank" rel="noopener noreferrer"><code>.Q</code></a> namespace and its handy helper functions for data persistence, and then take it a step further by examining one of those functions under the hood, exploring its <code>K</code> implementation, and building our own optimised version.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="under-the-hood-the-minimalist-tech-stack-powering-it-all">Under the Hood: The Minimalist Tech Stack Powering It All<a href="#under-the-hood-the-minimalist-tech-stack-powering-it-all" class="hash-link" aria-label="Direct link to Under the Hood: The Minimalist Tech Stack Powering It All" title="Direct link to Under the Hood: The Minimalist Tech Stack Powering It All">​</a></h2>
<p>The tech stack for this tutorial is even more minimal than in our previous one. Since we’re not streaming data directly from Python to KDB/Q, we can drop the <a href="https://github.com/exxeleron/qPython/tree/master" target="_blank" rel="noopener noreferrer"><code>qpython</code></a> library altogether. All we need is Python with the <a href="https://github.com/ranaroussi/yfinance" target="_blank" rel="noopener noreferrer"><strong><code>yfinance</code></strong></a> library to fetch historical stock data from Yahoo Finance, and, of course, our go-to language for time series and big data analysis: <strong>KDB/Q</strong>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-setup">The Setup<a href="#the-setup" class="hash-link" aria-label="Direct link to The Setup" title="Direct link to The Setup">​</a></h2>
<p><img decoding="async" loading="lazy" alt="KDB/Q Stock Research Historical Database" src="/assets/images/researchHDB-8f86cfa2c76c567983e91ee9148603cf.png" width="741" height="511" class="img_ev3q"></p>
<p>The architecture of our application is built around three key components:</p>
<ul>
<li><strong>Python Data Downloader</strong>: Using the <a href="https://github.com/ranaroussi/yfinance" target="_blank" rel="noopener noreferrer"><code>yfinance</code></a> library, we’ll fetch historical stock market data and save it as CSV files.</li>
<li><strong>KDB/Q Data Loader &amp; Persister</strong>: This component reads the CSV data into memory, processes it, and writes it to disk as part of a Historical Database (HDB).</li>
<li><strong>Historical Research Database (HDB)</strong>: Finally, we configure a KDB/Q HDB to point to the persisted data on disk for analysis and querying.</li>
</ul>
<p>In the following section, we’ll dive into each of these components in more detail.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="python-data-downloader">Python Data Downloader<a href="#python-data-downloader" class="hash-link" aria-label="Direct link to Python Data Downloader" title="Direct link to Python Data Downloader">​</a></h3>
<p>Just like in our previous tutorial, the Python Data Downloader is the most code-heavy component, clocking in at just over 130 lines. It reads a list of tickers from a CSV file and fetches historical stock data from Yahoo Finance based on either a specified date range and interval or a predefined period and interval. The downloaded data is then saved in a designated folder, with one CSV file per stock.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="kdbq-data-loader--persister">KDB/Q Data Loader &amp; Persister<a href="#kdbq-data-loader--persister" class="hash-link" aria-label="Direct link to KDB/Q Data Loader &amp; Persister" title="Direct link to KDB/Q Data Loader &amp; Persister">​</a></h3>
<p>Now let’s turn our attention to the KDB/Q data loader and persister. In its simplest form, the entire script is under 20 lines of code, and we could trim it even further by eliminating some whitespace. But before we run it all at once, it’s worth checking how each function performs individually. To do this, we use the <a href="https://code.kx.com/q/basics/syscmds/#ts-time-and-space" target="_blank" rel="noopener noreferrer"><code>\ts</code></a> system command, which measures both time and memory usage for a given operation.</p>
<p>Before we dive into optimization, let’s quickly review the setup we created for our data loader.</p>
<p>First, we define an empty table schema that matches the structure of the final data we plan to load and persist. This will act as a container for all the data we process. Then, we specify the column names expected in the raw CSV files. Since we’ll be enriching the data before writing it to disk, the schema of the CSV files differs from the schema of the final output. Lastly, we create a variable to store a list of all the filenames we want to process.</p>
<p>You can find the complete source code for this project [here], but for now, we’ll walk through it step by step.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data:([] date:`date$(); sym:`symbol$(); feedHandlerTime: `timestamp$(); open: `float$(); high: `float$(); low: `float$(); close: `float$(); volume: `long$(); dividends: `float$(); stockSplit: `float$());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">colsToLoad:`date`open`high`low`close`volume`dividends`stockSplit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">files:key `:.;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="data-load">Data Load<a href="#data-load" class="hash-link" aria-label="Direct link to Data Load" title="Direct link to Data Load">​</a></h4>
<p>Before loading any data, whether it&#x27;s stock prices or something else, it&#x27;s always a good idea o take a quick peek first. One easy way to do this is by using the Unix <a href="https://man7.org/linux/man-pages/man1/head.1.html" target="_blank" rel="noopener noreferrer"><code>head</code></a> command, which displays the first 10 lines of a file. This gives us a clear view of the structure, allowing us to understand the column headers, data types, and how we should shape our table schema in KDB/Q.</p>
<p>As we inspect the content, one key detail jumps out: the dataset doesn’t include the ticker symbol. A quick look at the filename reveals why, the symbol is encoded in the file name itself (<code>VOW3.DE_20250520_213458.csv</code>) and was likely omitted from the file content to avoid redundancy. That means we’ll need to extract the symbol from the filename and append it to each record.</p>
<p>Additionally, we&#x27;ll enhance our dataset further by:</p>
<ul>
<li>Adding a <code>feedHandlerTime</code> column to simulate the time the feed processed the data</li>
<li>Converting the <code>date</code> column from a <code>timestamp</code> to a <code>date</code> type</li>
</ul>
<p>These small enhancements will make our data much cleaner and more useful for analysis.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alexanderunterrainer@Mac:~/repos/financeData/stock_data|⇒  head VOW3.DE_20250520_213458.csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date,Open,High,Low,Close,Volume,Dividends,Stock Splits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1998-07-22 00:00:00+02:00,21.488154257121344,22.136574506271078,21.488154257121344,21.980979919433594,56336,0.0,0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1998-07-23 00:00:00+02:00,22.22316856885747,22.396011942250293,21.01258087158203,21.01258087158203,95571,0.0,0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1998-07-24 00:00:00+02:00,20.75315016493062,21.185430035478102,20.37262180820672,20.925994873046875,154423,0.0,0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1998-07-27 00:00:00+02:00,20.925992035048456,21.099174218262796,20.234277095880632,20.32086753845215,62875,0.0,0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1998-07-28 00:00:00+02:00,20.14802370431103,20.908741550046198,19.680904936904067,19.836498260498047,116194,0.0,0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1998-07-29 00:00:00+02:00,19.853748790764257,20.753147350373524,19.5425608586415,20.32086753845215,95068,0.0,0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1998-07-30 00:00:00+02:00,20.40712156543796,21.012583592704,20.40712156543796,20.701396942138672,51306,0.0,0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1998-07-31 00:00:00+02:00,21.012583592704,21.012583592704,19.11028206085388,20.701396942138672,145369,0.0,0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1998-08-03 00:00:00+02:00,18.850849105456504,18.980397941705075,18.764257350178806,18.95469093322754,74948,0.0,0.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Our final data loading function therefore becomes:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">loadData:{[file]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        s:`$first &quot;_&quot; vs string file;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        `data insert `date`sym`feedHandlerTime xcols update `date$date,sym:s,feedHandlerTime:date from 1_flip colsToLoad!(&quot;PFFFFJFF&quot;;csv) 0: hsym file;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="save-data">Save Data<a href="#save-data" class="hash-link" aria-label="Direct link to Save Data" title="Direct link to Save Data">​</a></h4>
<p>Next, we persist our data to disk using <a href="https://code.kx.com/q/ref/dotq/#dpft-save-table" target="_blank" rel="noopener noreferrer"><code>.Q.pdft</code></a>, KDB/Q’s built-in function for saving data to a partitioned Historical Database (HDB). Don’t worry if you&#x27;re not familiar with the different HDB types, we’ll explore those in a separate post. For now, our focus is on building a research-ready database.</p>
<p>To keep the code clean and easily extensible, we define a helper function to handle saving data for a single date. This approach makes it easy to optimize our code for performance later on. The function is then called by our main <code>saveData</code> routine, which loops through all unique dates in our dataset. Best of all, this can be accomplished in just a few lines of code. Let’s take a look.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">saveOneDate:{[hdbDir;t;d]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        `stocks set select from t where date=d;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .Q.dpft[hdbDir;d;`sym;`stocks];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        delete stocks from `.;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">saveData:{[]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        d:exec distinct date from data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        saveOneDate[`$&quot;:/Users/alexanderunterrainer/repos/financeData/hdb/&quot;;data;] each d;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-tests">Performance Tests<a href="#performance-tests" class="hash-link" aria-label="Direct link to Performance Tests" title="Direct link to Performance Tests">​</a></h4>
<p>Now, let’s evaluate how our functions perform, leveraging the system command <code>\ts</code> mentioned earlier. This will return the execution time in milliseconds as well as how much memory was used in bytes.</p>
<p>First we load all our data:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts loadData each files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">53 11109488</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)count data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">75824</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)10#data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">date       sym    feedHandlerTime               open     high     low      close    volume   dividends stockSplit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06 7203.T 1999.05.06D00:00:00.000000000 396.8345 410.4792 392.2863 410.4792 15575000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.07 7203.T 1999.05.07D00:00:00.000000000 408.2051 409.3421 392.2862 395.6974 15165000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.10 7203.T 1999.05.10D00:00:00.000000000 395.6975 400.2458 392.2863 394.5605 6305000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.11 7203.T 1999.05.11D00:00:00.000000000 397.9717 400.2458 391.1493 391.1493 8430000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.12 7203.T 1999.05.12D00:00:00.000000000 391.1492 397.9716 391.1492 397.9716 12980000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.13 7203.T 1999.05.13D00:00:00.000000000 393.4233 393.4233 385.4639 388.8751 7165000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.14 7203.T 1999.05.14D00:00:00.000000000 390.0121 390.0121 383.1897 384.3268 11475000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.17 7203.T 1999.05.17D00:00:00.000000000 378.6415 379.7786 371.8192 372.9562 10900000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.18 7203.T 1999.05.18D00:00:00.000000000 375.2304 387.7381 371.8192 385.464  13680000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.19 7203.T 1999.05.19D00:00:00.000000000 374.0932 376.3673 358.1743 369.545  19680000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select count i by sym from data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym    | x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------| -----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7203.T | 6511</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9988.HK| 1345</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL   | 11200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN   | 7048</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG   | 5222</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">META   | 3270</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT   | 9874</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QQQ    | 6591</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SPY    | 8133</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TSLA   | 3747</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VOW3.DE| 6865</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VTI    | 6018</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, we save the data:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts saveData[]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">13312 4396288</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>While the data loading step is impressively fast, just 53 milliseconds, the save-to-disk step takes significantly longer at 13.5 seconds, and that’s only for 12 stocks. Clearly, there’s room for optimization. Let’s see how we can speed things up.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-tuning-part-1">Performance Tuning Part 1<a href="#performance-tuning-part-1" class="hash-link" aria-label="Direct link to Performance Tuning Part 1" title="Direct link to Performance Tuning Part 1">​</a></h4>
<p>The first optimization we’ll explore is a clever technique I picked up from <a href="https://www.linkedin.com/in/nickpsaris/" target="_blank" rel="noopener noreferrer">Nick Psaris&#x27;</a> excellent book <a href="https://amzn.to/4dAg1Hh" target="_blank" rel="noopener noreferrer"><em><strong>Q-Tips: Fast, Scalable and Maintainable KDB+</strong></em></a>, a personal favorite of mine. In his book, Nick demonstrates how to accelerate an <a href="https://www.defconq.tech/docs/concepts/joins#as-of-joins" target="_blank" rel="noopener noreferrer"><code>as-of join</code></a> by converting one of the tables into a dictionary, where each key is a date and the corresponding value is a table containing only the data for that date. Let’s apply this concept to the <code>stocks</code> data we just loaded into memory to see it in action.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If you need a refresher of KDB/Q joins, read my dedicated blog post <a href="https://www.defconq.tech/docs/concepts/joins" target="_blank" rel="noopener noreferrer">here</a></p></div></div>
<p>First, let’s take a quick glance at our dataset to understand its current structure.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">date       sym    feedHandlerTime               open     high     low      close    volume   dividends stockSplit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06 7203.T 1999.05.06D00:00:00.000000000 396.8345 410.4792 392.2863 410.4792 15575000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.07 7203.T 1999.05.07D00:00:00.000000000 408.2051 409.3421 392.2862 395.6974 15165000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.10 7203.T 1999.05.10D00:00:00.000000000 395.6975 400.2458 392.2863 394.5605 6305000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.11 7203.T 1999.05.11D00:00:00.000000000 397.9717 400.2458 391.1493 391.1493 8430000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.12 7203.T 1999.05.12D00:00:00.000000000 391.1492 397.9716 391.1492 397.9716 12980000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.13 7203.T 1999.05.13D00:00:00.000000000 393.4233 393.4233 385.4639 388.8751 7165000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.14 7203.T 1999.05.14D00:00:00.000000000 390.0121 390.0121 383.1897 384.3268 11475000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.17 7203.T 1999.05.17D00:00:00.000000000 378.6415 379.7786 371.8192 372.9562 10900000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.18 7203.T 1999.05.18D00:00:00.000000000 375.2304 387.7381 371.8192 385.464  13680000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.19 7203.T 1999.05.19D00:00:00.000000000 374.0932 376.3673 358.1743 369.545  19680000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.20 7203.T 1999.05.20D00:00:00.000000000 374.0932 382.0527 371.8191 377.5044 9375000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.21 7203.T 1999.05.21D00:00:00.000000000 380.9157 383.1898 372.9562 378.6415 11610000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.24 7203.T 1999.05.24D00:00:00.000000000 378.6415 378.6415 366.1339 378.6415 9865000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Since our goal is to organize the data by individual days, we need to identify the row indices corresponding to each unique date. This can be achieved by grouping the <code>date</code> column in our table using the <a href="https://code.kx.com/q/ref/group/" target="_blank" rel="noopener noreferrer"><code>group</code></a> keyword, which gives us exactly what we need: a mapping from dates to row indices.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)group data`date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06| 0 12505 19553 37919 44510 52643 63147</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.07| 1 12506 19554 37920 44511 52644 63148</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.10| 2 12507 19555 37921 44512 52645 63149</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.11| 3 12508 19556 37922 44513 52646 63150</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.12| 4 12509 19557 37923 44514 52647 63151</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.13| 5 12510 19558 37924 44515 52648 63152</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.14| 6 12511 19559 37925 44516 52649 63153</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.17| 7 12512 19560 37926 44517 52650 63154</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.18| 8 12513 19561 37927 44518 52651 63155</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.19| 9 12514 19562 37928 44519 52652 63156</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.20| 10 12515 19563 37929 44520 52653 63157</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>By using this grouped dictionary to index into our original table, we build a structure where each key is a date, and each value is a sub-table containing only the data for that specific date.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)data group data`date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06| +`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit!(1999.05.06 1999.05.06 1999.05.06 1999.05.06 1999.05.06 1999.05.06 1999.05.06;`7203.T`AAPL`AMZN`MSFT`QQQ`SPY`VOW3.DE;1999.05.06D00:00:00.000000000 1999...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.07| +`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit!(1999.05.07 1999.05.07 1999.05.07 1999.05.07 1999.05.07 1999.05.07 1999.05.07;`7203.T`AAPL`AMZN`MSFT`QQQ`SPY`VOW3.DE;1999.05.07D00:00:00.000000000 1999...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.10| +`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit!(1999.05.10 1999.05.10 1999.05.10 1999.05.10 1999.05.10 1999.05.10 1999.05.10;`7203.T`AAPL`AMZN`MSFT`QQQ`SPY`VOW3.DE;1999.05.10D00:00:00.000000000 1999...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.11| +`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit!(1999.05.11 1999.05.11 1999.05.11 1999.05.11 1999.05.11 1999.05.11 1999.05.11;`7203.T`AAPL`AMZN`MSFT`QQQ`SPY`VOW3.DE;1999.05.11D00:00:00.000000000 1999...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.12| +`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit!(1999.05.12 1999.05.12 1999.05.12 1999.05.12 1999.05.12 1999.05.12 1999.05.12;`7203.T`AAPL`AMZN`MSFT`QQQ`SPY`VOW3.DE;1999.05.12D00:00:00.000000000 1999...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.13| +`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit!(1999.05.13 1999.05.13 1999.05.13 1999.05.13 1999.05.13 1999.05.13 1999.05.13;`7203.T`AAPL`AMZN`MSFT`QQQ`SPY`VOW3.DE;1999.05.13D00:00:00.000000000 1999...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.14| +`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit!(1999.05.14 1999.05.14 1999.05.14 1999.05.14 1999.05.14 1999.05.14 1999.05.14;`7203.T`AAPL`AMZN`MSFT`QQQ`SPY`VOW3.DE;1999.05.14D00:00:00.000000000 1999...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.17| +`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit!(1999.05.17 1999.05.17 1999.05.17 1999.05.17 1999.05.17 1999.05.17 1999.05.17;`7203.T`AAPL`AMZN`MSFT`QQQ`SPY`VOW3.DE;1999.05.17D00:00:00.000000000 1999...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.18| +`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit!(1999.05.18 1999.05.18 1999.05.18 1999.05.18 1999.05.18 1999.05.18 1999.05.18;`7203.T`AAPL`AMZN`MSFT`QQQ`SPY`VOW3.DE;1999.05.18D00:00:00.000000000 1999...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.19| +`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit!(1999.05.19 1999.05.19 1999.05.19 1999.05.19 1999.05.19 1999.05.19 1999.05.19;`7203.T`AAPL`AMZN`MSFT`QQQ`SPY`VOW3.DE;1999.05.19D00:00:00.000000000 1999...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>With this dictionary in hand, we can now leverage the <a href="https://www.defconq.tech/docs/concepts/iterators#binary-opplication-of-each" target="_blank" rel="noopener noreferrer">each-both</a> iterator to loop over our dataset and save the data for each day individually. Let’s go ahead and do that.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>You can find a detailed explanation of every iterator in my dedicated blog post: <a href="https://www.defconq.tech/docs/concepts/iterators" target="_blank" rel="noopener noreferrer">Iterators - Navigating Vectors Without the Need for Loops</a>.</p></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts {[hdbDir;d;t] `stocks set t;.Q.dpft[hdbDir;d;`sym;`stocks];delete stocks from `.;}[`$&quot;:/Users/alexanderunterrainer/repos/financeData/hdb/&quot;]&#x27;[key g;value g:data group data`date]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12766 13391008</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts {[hdbDir;d;t] `stocks set t;.Q.dpft[hdbDir;d;`sym;`stocks];delete stocks from `.;}[`$&quot;:/Users/alexanderunterrainer/repos/financeData/hdb/&quot;]&#x27;[key g;value g:data group data`date]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">13449 13391008</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Unfortunately, this approach didn’t yield the performance gains I was hoping for, clocking in at 12.5 seconds, it&#x27;s only marginally faster than our original method. Even after a second run (always a good idea when testing performance), the improvement was negligible. So it’s clear we need a different strategy to optimise our save-down function. A quick win might be to leverage multithreading by using the <a href="https://www.defconq.tech/docs/concepts/iterators#each-parallel" target="_blank" rel="noopener noreferrer"><code>peach</code></a> iterator to save each date in parallel. Let’s give that a try.</p>
<p>To take advantage of multithreading, we need to launch our KDB/Q process with multiple slave threads. This is done using the <code>-s</code> command-line option, followed by the number of slaves you&#x27;d like to start. For our example, we’ll go with eight slaves, a number chosen arbitrarily. After starting the process, we can confirm the number of active slave threads by running the system command <code>\s</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alexanderunterrainer@Mac:~/repos/financeData/stock_data|⇒  qq ../draft.q -s 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KDB+ 4.1 2025.02.18 Copyright (C) 1993-2025 Kx Systems</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m64/ 8(24)core 24576MB alexanderunterrainer mac 192.168.1.177 EXPIRE 2026.03.11 KDB PLUS PERSONAL #5024911</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)\s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8i</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, let’s update our function to use <code>peach</code> (parallel each) in place of the standard <code>each</code>, and then run it to see the performance impact.</p>
<p><strong>Modified saveData function:</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">saveDataP:{[] </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	d:exec distinct date from data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	saveOneDate[`$&quot;:/Users/alexanderunterrainer/repos/financeData/hdb/&quot;;data;] peach d;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Test run:</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts saveDataP[]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;noupdate: `. `stocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [4]  (.q.set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [3]  /Users/alexanderunterrainer/repos/financeData/draft.q:15: saveOneDate:{[hdbDir;t;d]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> `stocks set select from t where date=d;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> .Q.dpft[hdbDir;d;`sym;`stocks];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [1]  saveDataP:{[] d:exec distinct date from data;saveOneDate[`$&quot;:/Users/alexanderunterrainer/repos/financeData/hdb/&quot;;data;] peach d;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To our surprise, this threw an error, but was it really unexpected? Not quite. We just ran into a well-known limitation of multi-threading and <code>peach</code>: you can’t modify a global variable, like <code>stocks</code> in our case, within a parallel execution context. And that makes perfect sense. There’s no way to ensure multiple threads aren’t simultaneously reading from or, worse, writing to the same global variable. Thankfully, this is only a minor setback. All we need to do is refactor our <code>saveOneDate</code> function to avoid relying on global variables. A simple fix.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>We&#x27;ll also need to make a slight adjustment to our <code>saveData</code> function to accommodate the changes.</p></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">saveOneDateP:{[hdbDir;t;d] </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	toSave:delete date from update `p#sym from `sym`feedHandlerTime xasc select from t where date=d;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	(` sv (.Q.par[hdbDir;d;`stocks];`)) set toSave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Since we&#x27;re no longer using the built-in <code>.Q.dpft</code> function, we need to handle a few steps manually. But as you&#x27;ll see, this extra effort is worthwhile, it results in noticeable performance gains. In the first line of our updated function, we perform several steps in one go. Reading from right to left:</p>
<ul>
<li>We begin by selecting only the rows for the specific date we want to save.</li>
<li>We then sort the data first by <code>sym</code> and, within each symbol, by <code>feedHandlerTime</code>.</li>
<li>Next, we apply the <code>parted</code> attribute to the <code>sym</code> column, a step that <code>.Q.dpft</code> previously handled for us.</li>
<li>Finally, we remove the <code>date</code> column, since it will now be represented as a partition directory in our HDB.</li>
</ul>
<p>As the final step, we construct the file path for storing that day&#x27;s data using <code>.Q.par</code>, combining the HDB root directory, table name, and target date. We then save the processed data directly to that path.</p>
<p>Now let’s take a look at the changes we need to apply to the <code>saveData</code> function.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">saveDataP:{[data] </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	data:.Q.en[hdbDir:`$&quot;:/Users/alexanderunterrainer/repos/financeData/hdb/&quot;] data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	d:exec distinct date from data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	saveOneDateP[hdbDir;data;] peach d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Another task we now need to handle manually now that we no longer use <code>.Q.dpft</code> is enumeration, a key concept we&#x27;ll explore in more detail in a future blog post.</p>
<p>To accommodate this, we modify the <code>saveData</code> function so it accepts the dataset to be saved as a parameter. Within the function, we perform the following steps:</p>
<ul>
<li>First, we enumerate the data using the <code>sym</code> file located in the root directory of our HDB.</li>
<li>Next, we retrieve all unique dates from the dataset</li>
<li>And finally, we use <code>peach</code> to invoke our optimized <code>saveOneDateP</code> function for each distinct date in parallel.</li>
</ul>
<p>Next, let&#x27;s put our newly optimized function to the test and compare its performance against the original implementation.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts saveDataP[data]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6056 4195184</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The result speak for itself, we managed to cut the execution time by more than half. That’s a significant improvement, especially considering how minimal the code changes were. Even with the enhancements, the total lines of code remain under twenty.</p>
<p>But is this the best we can do? We owe it to ourselves to at least give it another shot.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="behind-the-magic-the-secret-life-of-qpdft">Behind the Magic: The Secret Life of .Q.pdft<a href="#behind-the-magic-the-secret-life-of-qpdft" class="hash-link" aria-label="Direct link to Behind the Magic: The Secret Life of .Q.pdft" title="Direct link to Behind the Magic: The Secret Life of .Q.pdft">​</a></h4>
<p>For our next round of performance tuning, we’ll dive into the inner workings of <code>.Q.dpft</code> to see if we can repurpose some of its internal logic to our advantage. But before we do so, let&#x27;s first look beyond the dot and understand how <code>.Q.dpft</code> works behind the curtains. As a reminder:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.Q.dpft[d; p; f; t]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>where:</p>
<ul>
<li><code>d</code> is the directory handle for the HDB</li>
<li><code>p</code> is the partition (typically a date)</li>
<li><code>f</code> is the column used for partitioning (must exist in the table since version 4.1t 2021.09.03)</li>
<li><code>t</code> is the name (as a symbol) of the simple table to be saved, where columns are vectors or compound lists.</li>
</ul>
<p>With that structure in mind, let’s explore how <code>.Q.dpft</code> is implemented internally and see what components we can reuse or adapt for even better performance.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q).Q.dpft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k){[d;p;f;t;s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if[` in f,c:!+r:`. . `\:t;&#x27;`domain];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if[~f in c;&#x27;f];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      i:&lt;t f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      r:+enxs[$;d;r;s];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {[d;t;i;u;x]@[d;x;:;u t[x]i]}[d:par[d;p;t];r;i;]&#x27;[(::;`p#)f=c;c];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @[d;`.d;:;f,c@&amp;~f=c];t}[;;;;`sym]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As is often the case, <code>K</code> code tends to be even more concise and cryptic than <code>Q</code>, making it challenging to read, especially for the untrained eye. That said, the core functionality of the <code>.Q.dpft</code> function can be broken down into six key steps:</p>
<ul>
<li><strong>Store the table content</strong> and <strong>Extract column names</strong> from table <code>t</code> and validate that no unexpected columns are present.</li>
<li><strong>Verify</strong> that the column targeted for the parted attribute exists within the table.</li>
<li><strong>Determine index order</strong> using <code>iasc</code> to sort the table appropriately.</li>
<li><strong>Enumerate</strong> the table against the <code>sym</code> file to ensure consistency in symbol representation.</li>
<li><strong>Persist data</strong>, saving each column individually while reordering and applying attributes as needed.</li>
<li><strong>Write the <code>.d</code> file</strong>, which contains the column names in their correct order</li>
</ul>
<p>Now, let’s dive deeper into each of these steps to better understand how we might adopt and adapt this approach.</p>
<p>In the first line, we use an <code>if</code> statement to ensure there are no unexpected columns in the table we want to persist. However, the condition inside that <code>if</code> does quite a bit, so let’s unpack it:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">` in f,c:!+r:`. . `\:t</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As we are well aware by now, we read <code>Q</code> and <code>K</code> from right to left. Starting on the far right:</p>
<ul>
<li><code>`\:t</code> is <code>K</code> code for  the <a href="https://code.kx.com/q/ref/vs/" target="_blank" rel="noopener noreferrer"><code>vs</code> (vector-from-scalar)</a> operator to convert the table name <code>t</code>, a symbol atom, into a single-element list</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)vs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k){x\:y}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)` vs `stock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,`stock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)k)`\:`stock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,`stock</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>`. . `\:t</code> performs a dot-apply to retrieve the actual table value from the general namespace, giving us the contents of the table name stored in <code>t</code>. The result is assigned to variable <code>r</code></li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If you&#x27;d like a refresher or a deep dive into how the powerful apply operator works in KDB/Q, make sure to check out my dedicated blog post: <a href="https://www.defconq.tech/docs/concepts/amend" target="_blank" rel="noopener noreferrer">Amend, Amend At   – The Swiss Army Knife of KDB/Q Operators</a>.</p></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Q code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)`. . ` vs `data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">date       sym    feedHandlerTime               open     high     low      close    volume   dividends stockSplit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06 7203.T 1999.05.06D00:00:00.000000000 396.8345 410.4792 392.2863 410.4792 15575000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.07 7203.T 1999.05.07D00:00:00.000000000 408.2051 409.3421 392.2862 395.6974 15165000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.10 7203.T 1999.05.10D00:00:00.000000000 395.6975 400.2458 392.2863 394.5605 6305000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.11 7203.T 1999.05.11D00:00:00.000000000 397.9717 400.2458 391.1493 391.1493 8430000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.12 7203.T 1999.05.12D00:00:00.000000000 391.1492 397.9716 391.1492 397.9716 12980000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.13 7203.T 1999.05.13D00:00:00.000000000 393.4233 393.4233 385.4639 388.8751 7165000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.14 7203.T 1999.05.14D00:00:00.000000000 390.0121 390.0121 383.1897 384.3268 11475000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// K code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)k)`. . `\:`data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">date       sym    feedHandlerTime               open     high     low      close    volume   dividends stockSplit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06 7203.T 1999.05.06D00:00:00.000000000 396.8345 410.4792 392.2863 410.4792 15575000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.07 7203.T 1999.05.07D00:00:00.000000000 408.2051 409.3421 392.2862 395.6974 15165000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.10 7203.T 1999.05.10D00:00:00.000000000 395.6975 400.2458 392.2863 394.5605 6305000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.11 7203.T 1999.05.11D00:00:00.000000000 397.9717 400.2458 391.1493 391.1493 8430000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.12 7203.T 1999.05.12D00:00:00.000000000 391.1492 397.9716 391.1492 397.9716 12980000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.13 7203.T 1999.05.13D00:00:00.000000000 393.4233 393.4233 385.4639 388.8751 7165000  0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.14 7203.T 1999.05.14D00:00:00.000000000 390.0121 390.0121 383.1897 384.3268 11475000 0         0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The remainder of the line is fairly straightforward. We use the <code>+</code> operator in <code>K</code> (which corresponds to the <a href="https://code.kx.com/q/ref/flip/" target="_blank" rel="noopener noreferrer"><code>flip</code></a> operator in <code>Q</code>) to convert our table into a dictionary, and then apply the <code>!</code> (<code>key</code> in <code>Q</code>) operator to extract the column names, storing them in the variable <code>c</code>. We then concatenate the column name of the column we want to apply the <code>parted</code> attribute to with this list of column names. Finally, we check if the empty symbol <code>`</code> appears in that list, if it does, we throw a <code>domain</code> error; if not, we proceed with the function&#x27;s execution. Not too bad, right? Let&#x27;s back this up with some code examples.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)flip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)flip data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">date           | 1999.05.06                    1999.05.07                    1999.05.10                    1999.05.11                    1999.05.12                    1999.05.13                    1999.05.14                    1999.05.17  ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym            | 7203.T                        7203.T                        7203.T                        7203.T                        7203.T                        7203.T                        7203.T                        7203.T      ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feedHandlerTime| 1999.05.06D00:00:00.000000000 1999.05.07D00:00:00.000000000 1999.05.10D00:00:00.000000000 1999.05.11D00:00:00.000000000 1999.05.12D00:00:00.000000000 1999.05.13D00:00:00.000000000 1999.05.14D00:00:00.000000000 1999.05.17D0..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">open           | 396.8345                      408.2051                      395.6975                      397.9717                      391.1492                      393.4233                      390.0121                      378.6415    ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">high           | 410.4792                      409.3421                      400.2458                      400.2458                      397.9716                      393.4233                      390.0121                      379.7786    ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">low            | 392.2863                      392.2862                      392.2863                      391.1493                      391.1492                      385.4639                      383.1897                      371.8192    ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">close          | 410.4792                      395.6974                      394.5605                      391.1493                      397.9716                      388.8751                      384.3268                      372.9562    ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volume         | 15575000                      15165000                      6305000                       8430000                       12980000                      7165000                       11475000                      10900000    ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dividends      | 0                             0                             0                             0                             0                             0                             0                             0           ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stockSplit     | 0                             0                             0                             0                             0                             0                             0                             0           ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)key flip data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)` in `sym,key flip data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That’s a lot happening in just one line! Don’t worry though, he next few lines are much simpler. In the following line, we just check whether the column we want to apply the <code>parted</code> attribute to is actually present in the table’s column names. If it’s not (<code>~</code> is the <code>K</code> operator for logical <code>not</code>), we raise an error and halt execution.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)not</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)not `sym in `hello`world`test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)not `sym in `hello`world`test`sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, we retrieve the sorted (ascending) indices of the column to which we want to apply the <code>parted</code> attribute. This allows us to reorder all other columns in the same sequence. We start by extracting the target column from the table using its name, then apply the <code>&lt;</code> operator, the <code>K</code> equivalent of <code>Q&#x27;s</code> <code>iasc</code> (You can disregard the initial part of the underlying <code>iasc</code> implementation, it simply checks whether the input is a list rather than a single atomic value.) This operator returns the indices that would sort the list in ascending order. When you use these indices to reindex the original list, the result is a sorted version of that list.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)data`sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`s#`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203.T`7203..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)iasc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k){$[0h&gt;@x;&#x27;`rank;&lt;x]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)iasc 3 4 9 1 2 3 6 7 1 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 8 4 9 0 5 1 6 7 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)l iasc l:3 4 9 1 2 3 6 7 1 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 1 2 2 3 3 4 6 7 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The next line might look a bit cryptic at first glance, but all it&#x27;s doing is enumerating the table against the sym file. How do I know? By examining the underlying <code>K</code> code of the <a href="https://code.kx.com/q/ref/dotq/#en-enumerate-varchar-cols" target="_blank" rel="noopener noreferrer"><code>.Q.en</code></a> function, which is used to enumerate tables, it&#x27;s clear that it closely mirrors the implementation of <code>.Q.enxs</code>. In fact, <code>.Q.en</code> is simply a projection of <code>.Q.enxs</code> with two parameters pre-applied.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q).Q.en</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k){[x;d;t;s]if[(~(::)~d)&amp;#c:&amp;{$[11h=@*x;&amp;/11h=@:&#x27;x;11h=@x]}&#x27;+t;(`/:d,s)??,/(?,/)&#x27;t c];@[t;c;{$[@y;x y;(-1_+\0,#:&#x27;y)_x@,/y]}x s]}[;;;`sym][?]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).Q.enxs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k){[x;d;t;s]if[(~(::)~d)&amp;#c:&amp;{$[11h=@*x;&amp;/11h=@:&#x27;x;11h=@x]}&#x27;+t;(`/:d,s)??,/(?,/)&#x27;t c];@[t;c;{$[@y;x y;(-1_+\0,#:&#x27;y)_x@,/y]}x s]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now comes the line where most of the magic happens. At a high level, the lambda function here takes care of sorting each column based on the ascending indexes we previously calculated, applies the <code>parted</code> attribute when required, and then saves each column to disk. But let’s peel back the layers and break it down step by step to make it more approachable.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{[d;t;i;u;x] @[d;x;:;u t[x]i] }[d:par[d;p;t];r;i;]&#x27;[(::;`p#)f=c;c]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can observe that the lambda function takes five parameters, with three of them already projected onto the function. This implies that the <code>&#x27;</code> operator used afterward is the <a href="https://www.defconq.tech/docs/concepts/iterators#binary-opplication-of-each" target="_blank" rel="noopener noreferrer"><em><strong>each-both</strong></em></a> iterator, meaning the lambda is being applied across the remaining two parameters simultaneously, those defined in the final part of the line.</p>
<p>Recall that <code>c</code> holds all column names and <code>f</code> contains the name of the column we want to apply the <code>parted</code> attribute to. The second parameter of <code>[(::;p#)f=c;c]</code> is straightforward, it’s simply the list of column names.</p>
<p>The first parameter becomes clear when broken down: <code>f=c</code> compares the column <code>f</code> to each element in <code>c</code> (this works thanks to <a href="https://www.defconq.tech/docs/concepts/iterators#implicit-iteration" target="_blank" rel="noopener noreferrer">implicit iteration</a>), producing a boolean list. This boolean mask is then used to index into the list on the left, which consists of two functions, the identity function <code>::</code> and a function which applies the parted attribute <code>`p#</code>.</p>
<p>The result of this indexing is a list of functions, for each column, we either apply the identity (if it&#x27;s not <code>f</code>) or apply the parted attribute (if it is <code>f</code>). These functions can then be mapped to the corresponding columns, as demonstrated in the code that follows.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)show c:`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)show f:`sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)f=c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0100000000b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(::;`p#)f=c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[`p]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">::</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, let’s examine the parameters that are projected onto our lambda function. The variables <code>r</code> and <code>i</code> are fairly straightforward: <code>i</code> holds the list of indices that would sort the <code>sym</code> column in ascending order, these indices are then used to reorder all other columns accordingly. <code>r</code> contains the enumerated version of our dataset, which we generated earlier.</p>
<p>Now let&#x27;s take a closer look at the first parameter, <code>d:par[d;p;t]</code>. Here, <code>d</code> is the root directory of our Historical Database, <code>p</code> is the partition date we’re currently working with, and <code>t</code> is the table name, passed in as a symbol. The <a href="https://code.kx.com/q/ref/dotq/#par-get-expected-partition-location" target="_blank" rel="noopener noreferrer"><code>.Q.par</code></a> function takes these three arguments and constructs a full path by joining them. The resulting connection string is then reassigned to <code>d</code>.</p>
<p>Now that we&#x27;ve covered all the parameters, both those projected onto the lambda and those iterated over using <code>each-both</code>, let’s look at what actually happens inside the lambda itself. Fortunately, it’s quite straightforward. The lambda uses <code>apply-at (@)</code> to store each column in the correct location on disk. Here&#x27;s how it works: we first extract the relevant column from the table using its name <code>t[x]</code>, then reorder its values using the indices stored in <code>i</code> to ensure they align with the sorted <code>sym</code> column. Next, we apply the appropriate transformation from <code>u</code>: either the identity function <code>::</code> (which leaves the column unchanged) or the <code>`p#</code> function (which applies the parted attribute). Finally, we use <code>apply-at</code> to write the processed column to disk.</p>
<p>Not too bad after all, right?</p>
<p>The final line of the <code>.Q.pdft</code> function is simple but essential, it creates the <code>.d</code> file for the current partition. This file lists the column names, with the column to which we applied the parted attribute appearing first. This is achieved with the expression <code>f,c@&amp;~f=c</code>. Here&#x27;s what it does:</p>
<ul>
<li><code>f=c</code> compares the parted column name (<code>f</code>) with all column names in <code>c</code>, returning a boolean mask.</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`sym</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`date`sym`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)f=c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0100000000b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>~</code> (<code>not</code>) inverts the mask, identifying columns <em><strong>other than</strong></em> <code>f</code></li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)not</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)k)~f=c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1011111111b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)not f=c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1011111111b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>&amp;</code> (<code>where</code>) returns the indices of those non-matching columns.</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)where not f=c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 2 3 4 5 6 7 8 9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)k)&amp;~f=c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 2 3 4 5 6 7 8 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>c@&amp;~f=c</code> indexes into the list of column names to retrieve only the non-parted columns.</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)c@where not f=c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`date`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)k)c@&amp;~f=c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`date`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>These are then appended to <code>f</code>, putting the parted column first.</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)f,c@where not f=c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`sym`date`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)k)f,c@&amp;~f=c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`sym`date`feedHandlerTime`open`high`low`close`volume`dividends`stockSplit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, we use another <code>amend-at</code> operation to write this ordered list of column names into the <code>.d</code> file on disk.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="performance-tuning-part-2">Performance Tuning Part 2<a href="#performance-tuning-part-2" class="hash-link" aria-label="Direct link to Performance Tuning Part 2" title="Direct link to Performance Tuning Part 2">​</a></h4>
<p>Now that we understand the inner workings of <code>.Q.pdft</code>, we can borrow some of its techniques to build a more efficient save-down function of our own.</p>
<p>The idea is to take our parallelism one step further, not only will we save each day in parallel, but we’ll also save each <em><strong>column</strong></em> in parallel. This is something <code>.Q.dpft</code> doesn’t do. Since KDB+/Q is a column-oriented database where each column is stored as a separate vector (and thus a separate file), we can safely write columns concurrently without risking file access conflicts.</p>
<p>We’ll implement two variations of this approach:</p>
<ol>
<li><strong>Column-level sorting</strong>:each<!-- --> column is sorted individually right before it&#x27;s written to disk.</li>
<li><strong>Table-level sorting</strong>: we sort the entire table once and then save each column independently.</li>
</ol>
<p>This allows us to compare whether repeatedly sorting individual columns is faster than a single full-table sort followed by column saves. You can find the complete source code in my <a href="https://github.com/DefconQ/defconQ/tree/master/projects/researchHDB" target="_blank" rel="noopener noreferrer">repository</a>. For now, let’s focus on the performance comparison.</p>
<p>Once again, we launch our KDB+/Q process with 8 slave threads and benchmark the performance of our newly optimized functions.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alexanderunterrainer@Mac:~/repos/financeData/stock_data|⇒  qq ../researchHDB.q -s 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KDB+ 4.1 2025.02.18 Copyright (C) 1993-2025 Kx Systems</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m64/ 8(24)core 24576MB alexanderunterrainer mac 192.168.1.177 EXPIRE 2026.03.11 KDB PLUS PERSONAL #5024911</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)loadData each files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)count data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">75824</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts saveDataP1[data]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6647 4196640</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)\ts saveDataP2[data]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7126 14154496</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, our performance tuning unfortunately didn’t yield the improvements we had hoped for. This could be due to a couple of reasons:</p>
<ul>
<li>The table for each date is relatively small, with only 12 different stocks, the overall volume of data might not be large enough to benefit from further parallelization.</li>
<li>Additionally, the table isn’t very wide, containing only a handful of columns. This limits the gains we could achieve from parallel column-wise writes.</li>
</ul>
<p>That said, this section served as a valuable exercise in understanding the inner workings of the <code>.Q.dpft</code> function and exploring some advanced KDB+/Q techniques.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="historical-research-database-hdb">Historical Research Database (HDB)<a href="#historical-research-database-hdb" class="hash-link" aria-label="Direct link to Historical Research Database (HDB)" title="Direct link to Historical Research Database (HDB)">​</a></h4>
<p>The Historical Database (HDB) we set up for this project is as straightforward as it gets. We simply point our KDB+/Q process to the root directory of the HDB and load that path into memory. This action memory-maps all the data in the directory, making it immediately available for querying.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="putting-it-all-together">Putting it all together<a href="#putting-it-all-together" class="hash-link" aria-label="Direct link to Putting it all together" title="Direct link to Putting it all together">​</a></h2>
<p>In this section, I’ll walk you through how to use the code we’ve covered to build your own research HDB.</p>
<p>Start by downloading historical stock data from Yahoo Finance using the provided Python data downloader. Begin executing the script with:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 stock_data_downloader.py --period max</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once the download is complete, confirm the data is there by running the <code>ls</code>command in your terminal: you should see a <code>stock_data</code> directory containing CSV files with the stock data.</p>
<p>Next, <code>cd</code> into the <code>stock_data</code> directory and start a KDB+/Q process.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alexanderunterrainer@Mac:~/repos/defconQ/projects/researchHDB/stock_data|master⚡ ⇒  qq ../researchHdb.q -s 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KDB+ 4.1 2025.02.18 Copyright (C) 1993-2025 Kx Systems</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m64/ 8(24)core 24576MB alexanderunterrainer mac 192.168.1.177 EXPIRE 2026.03.11 KDB PLUS PERSONAL #5024911</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)loadData each files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)count data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">75863</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)saveDataP1[data]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Load the corresponding <code>.q</code> file, then run the <code>loadData</code> function to load the stock data into memory. After that, use the <code>saveData</code> function to write the data to disk (you can choose whichever version of <code>saveData</code> you prefer).</p>
<p>Once the data has been persisted, you’re ready to start your research HDB process, and that’s it! You’re now all set to begin working with your historical stock data.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alexanderunterrainer@Mac:~/repos/financeData|⇒  qq hdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KDB+ 4.1 2025.02.18 Copyright (C) 1993-2025 Kx Systems</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m64/ 8(24)core 24576MB alexanderunterrainer mac 192.168.1.177 EXPIRE 2026.03.11 KDB PLUS PERSONAL #5024911</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)count stocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">75863</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)meta stocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c              | t f a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------| -----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">date           | d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sym            | s   p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feedHandlerTime| p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">open           | f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">high           | f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">low            | f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">close          | f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volume         | j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dividends      | f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stockSplit     | f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="where-we-go-from-here">Where we go from here<a href="#where-we-go-from-here" class="hash-link" aria-label="Direct link to Where we go from here" title="Direct link to Where we go from here">​</a></h2>
<p>This project offers a simple yet powerful way to download historical stock market data for daily end-of-day price, completely free of charge. As you&#x27;ve seen, the code is fairly straightforward. From here, you might consider enhancing the data loading process or developing a research tool around your historical stock market database. You could even go a step further by integrating this with a real-time market data feed, building a query-routing gateway, and gradually creating your own full-featured framework. Whatever direction you choose, the key is to enjoy the process.</p>
<p>Until next time—happy coding!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="resources">Resources<a href="#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h2>
<ul>
<li>yfinance library: <a href="https://github.com/ranaroussi/yfinance" target="_blank" rel="noopener noreferrer">Githup repo</a></li>
<li><a href="https://www.defconq.tech/docs/architecture/plain" target="_blank" rel="noopener noreferrer">The Plain Vanilla Tick Setup</a></li>
<li><a href="https://www.defconq.tech/docs/tutorials/tick" target="_blank" rel="noopener noreferrer">KDB Tick Explained: A Walkthrough</a></li>
<li><a href="https://www.defconq.tech/docs/concepts/attributes" target="_blank" rel="noopener noreferrer">Attributes</a></li>
<li><a href="https://www.defconq.tech/docs/concepts/dictionariesTables" target="_blank" rel="noopener noreferrer">Dictionaries and Tables</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="source-code">Source code<a href="#source-code" class="hash-link" aria-label="Direct link to Source code" title="Direct link to Source code">​</a></h3>
<p><a href="https://github.com/DefconQ/defconQ/tree/master/projects" target="_blank" rel="noopener noreferrer">DefconQ Github Project Repo</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tutorials/realTimeStocks"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">A Real Time Stock Market Feed</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tutorials/realTimeStocksUpdate"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Streaming Smarter: Real-Time Market Data with Kola, Python, and Databento</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#who-is-this-tutorial-for" class="table-of-contents__link toc-highlight">Who is this tutorial for?</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#whats-in-it-for-you-skills-youll-master-in-this-tutorial" class="table-of-contents__link toc-highlight">What’s in It for You: Skills You’ll Master in This Tutorial</a></li><li><a href="#under-the-hood-the-minimalist-tech-stack-powering-it-all" class="table-of-contents__link toc-highlight">Under the Hood: The Minimalist Tech Stack Powering It All</a></li><li><a href="#the-setup" class="table-of-contents__link toc-highlight">The Setup</a><ul><li><a href="#python-data-downloader" class="table-of-contents__link toc-highlight">Python Data Downloader</a></li><li><a href="#kdbq-data-loader--persister" class="table-of-contents__link toc-highlight">KDB/Q Data Loader &amp; Persister</a><ul><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a></li><li><a href="#data-load" class="table-of-contents__link toc-highlight">Data Load</a></li><li><a href="#save-data" class="table-of-contents__link toc-highlight">Save Data</a></li><li><a href="#performance-tests" class="table-of-contents__link toc-highlight">Performance Tests</a></li><li><a href="#performance-tuning-part-1" class="table-of-contents__link toc-highlight">Performance Tuning Part 1</a></li><li><a href="#behind-the-magic-the-secret-life-of-qpdft" class="table-of-contents__link toc-highlight">Behind the Magic: The Secret Life of .Q.pdft</a></li><li><a href="#performance-tuning-part-2" class="table-of-contents__link toc-highlight">Performance Tuning Part 2</a></li><li><a href="#historical-research-database-hdb" class="table-of-contents__link toc-highlight">Historical Research Database (HDB)</a></li></ul></li></ul></li><li><a href="#putting-it-all-together" class="table-of-contents__link toc-highlight">Putting it all together</a></li><li><a href="#where-we-go-from-here" class="table-of-contents__link toc-highlight">Where we go from here</a></li><li><a href="#resources" class="table-of-contents__link toc-highlight">Resources</a><ul><li><a href="#source-code" class="table-of-contents__link toc-highlight">Source code</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Learn</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/defconq/" target="_blank" rel="noopener noreferrer" class="footer__link-item">DefconQ Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/alexanderunterrainer/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Alexander Unterrainer Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://defconq.myspreadshop.co.uk" target="_blank" rel="noopener noreferrer" class="footer__link-item">DefconQ Swag<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://www.youtube.com/@DefconQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube Channel<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Substack Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://medium.com/@defconq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/DefconQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 DefconQ Ltd. This website is maintained by Alexander Unterrainer. Disclaimer: All content shared on this website reflect solely his personal thoughts and opinions, and is not representative of any past, current, or future employers or affiliations.</div></div></div></footer></div>
</body>
</html>