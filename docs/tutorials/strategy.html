<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/strategy" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Pulse Powered Alpha: Building your First Trading Strategy with KDB-X and Pulse | DefconQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://DefconQ.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://DefconQ.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://DefconQ.github.io/docs/tutorials/strategy"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Pulse Powered Alpha: Building your First Trading Strategy with KDB-X and Pulse | DefconQ"><meta data-rh="true" name="description" content="In the previous tutorials, we explored how to build a Tickerplant, pull real-time market data from providers like Yahoo and Databento, and create a research-focused historical database. Now it’s time to bring all these pieces together. In this tutorial, we’ll build our first (simple) trading strategy, visualize it in a dashboard, and even demonstrate how to create a backtesting engine to evaluate its performance."><meta data-rh="true" property="og:description" content="In the previous tutorials, we explored how to build a Tickerplant, pull real-time market data from providers like Yahoo and Databento, and create a research-focused historical database. Now it’s time to bring all these pieces together. In this tutorial, we’ll build our first (simple) trading strategy, visualize it in a dashboard, and even demonstrate how to create a backtesting engine to evaluate its performance."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://DefconQ.github.io/docs/tutorials/strategy"><link data-rh="true" rel="alternate" href="https://DefconQ.github.io/docs/tutorials/strategy" hreflang="en"><link data-rh="true" rel="alternate" href="https://DefconQ.github.io/docs/tutorials/strategy" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://R6JV2N50EX-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="DefconQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="DefconQ Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E9ED09HNE3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-E9ED09HNE3",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="DefconQ" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.5860f28a.css">
<script src="/assets/js/runtime~main.2c8f6e63.js" defer="defer"></script>
<script src="/assets/js/main.afec45fa.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#74e8a3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Stay up to date with the latest blogs posts - subscribe to my free Substack newsletter now <a href="https://defconq.substack.com">Free Substack Newsletter</a> or follow me on <a href="https://medium.com/@defconq">Medium</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="DefconQ Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="150" width="50"><img src="/img/logoLight.svg" alt="DefconQ Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="150" width="50"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Learn</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/about/about">About</a><a class="navbar__item navbar__link" href="/testimonials/testimonials">Testimonials</a><a class="navbar__item navbar__link" href="/happyHour/happyHour">Happy Hour</a><a class="navbar__item navbar__link" href="/cv/cv">CV</a><a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Substack Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://medium.com/@defconq" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://defconq.myspreadshop.co.uk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Swag<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/DefconQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-study-roadmap">KDB/Q Study Roadmap</a><button aria-label="Expand sidebar category &#x27;KDB/Q Study Roadmap&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-language">KDB/Q Language</a><button aria-label="Expand sidebar category &#x27;KDB/Q Language&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-architecture">KDB/Q Architecture</a><button aria-label="Expand sidebar category &#x27;KDB/Q Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/important-concepts">Important Concepts</a><button aria-label="Expand sidebar category &#x27;Important Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/design-patterns-for-kdbq-systems">Design Patterns for KDB/Q Systems</a><button aria-label="Expand sidebar category &#x27;Design Patterns for KDB/Q Systems&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/tutorials">Tutorials</a><button aria-label="Collapse sidebar category &#x27;Tutorials&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/tick">KDB Tick Explained: A Walkthrough [PART 1]</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/tick2">KDB Tick Explained: A Walkthrough [PART 2]</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/realTimeStocks">A Real Time Stock Market Feed</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/researchHDB">Back to the Future: Building Your Research HDB for Stock Market Insights</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/realTimeStocksUpdate">Streaming Smarter: Real-Time Market Data with Kola, Python, and Databento</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorials/strategy">Pulse Powered Alpha: Building your First Trading Strategy with KDB-X and Pulse</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/productivity-tools">Productivity Tools</a><button aria-label="Expand sidebar category &#x27;Productivity Tools&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/tutorials"><span itemprop="name">Tutorials</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Pulse Powered Alpha: Building your First Trading Strategy with KDB-X and Pulse</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Pulse Powered Alpha: Building your First Trading Strategy with KDB-X and Pulse</h1>
<p>In the previous tutorials, we explored how to build a Tickerplant, pull real-time market data from providers like Yahoo and <a href="https://databento.com" target="_blank" rel="noopener noreferrer">Databento</a>, and create a research-focused historical database. Now it’s time to bring all these pieces together. In this tutorial, we’ll build our first (simple) trading strategy, visualize it in a dashboard, and even demonstrate how to create a backtesting engine to evaluate its performance.</p>
<p>Here’s what the final dashboard will look like.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard" src="/assets/images/tradingDashboard-d1d0b201c5177b8955fbea5dfbb1264c.png" width="1917" height="1102" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="before-we-dive-in-gearing-up-for-the-strategy-build">Before We Dive In: Gearing Up for the Strategy Build<a href="#before-we-dive-in-gearing-up-for-the-strategy-build" class="hash-link" aria-label="Direct link to Before We Dive In: Gearing Up for the Strategy Build" title="Direct link to Before We Dive In: Gearing Up for the Strategy Build">​</a></h2>
<p>Since we’ll be reusing parts of the code introduced in earlier tutorials, it’s helpful to familiarise yourself with those foundations, they’re explained in detail and will make this tutorial much easier to follow. Don’t worry, though: all new additions will be fully explained as we go.
To visualise our trading strategy and build the dashboard, you’ll also need to install <strong>Pulse</strong>. Installation instructions are provided below.</p>
<p><strong>Prerequisites:</strong></p>
<ol>
<li>Review the previous tutorials to understand the core building blocks we’ll build on<!-- -->
<ul>
<li><a href="https://www.defconq.tech/docs/tutorials/tick" target="_blank" rel="noopener noreferrer">KDB Tick Explained: A Walkthrough [PART 1]</a></li>
<li><a href="https://www.defconq.tech/docs/tutorials/tick2" target="_blank" rel="noopener noreferrer">KDB Tick Explained: A Walkthrough [PART 2]</a></li>
<li><a href="https://www.defconq.tech/docs/tutorials/researchHDB" target="_blank" rel="noopener noreferrer">Back to the Future: Building Your Research HDB for Stock Market Insights</a></li>
<li><a href="https://www.defconq.tech/docs/architecture/plain" target="_blank" rel="noopener noreferrer">The Plain Vanilla Tick Setup</a></li>
</ul>
</li>
<li>Install Pulse: Follow the instructions <a href="https://www.timestored.com/pulse/" target="_blank" rel="noopener noreferrer">here</a></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="blueprints-before-code-designing-your-trading-engine-the-right-way">Blueprints Before Code: Designing Your Trading Engine the Right Way<a href="#blueprints-before-code-designing-your-trading-engine-the-right-way" class="hash-link" aria-label="Direct link to Blueprints Before Code: Designing Your Trading Engine the Right Way" title="Direct link to Blueprints Before Code: Designing Your Trading Engine the Right Way">​</a></h2>
<p>Before we jump into writing any code, it’s worth pausing to look at the most critical part of building any solid application: <strong>the architecture</strong>. Even a small, <em>simple</em> system benefits enormously from a clean, extensible design. With that mindset, here’s how we’ll structure our trading engine:</p>
<ul>
<li><strong>Data Ingestion:</strong> A dedicated process responsible for feeding market data into our Tickerplant.</li>
<li><strong>Tickerplant:</strong> The heartbeat of every KDB-X application. It streams incoming data to all real-time subscribers and writes each update to a Tickerplant Log file, ensuring the system can recover seamlessly if needed.</li>
<li><strong>Complex Event Processing Engine (CEP):</strong> This component serves as our trading engine, executing the strategy logic and generating signals based on the incoming data.</li>
</ul>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Architecture" src="/assets/images/TradingEngine-05ded0733a907d6e68c32041a76a3598.png" width="651" height="461" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="feeding-the-beast-bringing-data-into-your-trading-engine">Feeding the Beast: Bringing Data Into Your Trading Engine<a href="#feeding-the-beast-bringing-data-into-your-trading-engine" class="hash-link" aria-label="Direct link to Feeding the Beast: Bringing Data Into Your Trading Engine" title="Direct link to Feeding the Beast: Bringing Data Into Your Trading Engine">​</a></h2>
<p>For this tutorial, we’ll use end-of-day files from Yahoo Finance, the same dataset we worked with in an earlier tutorial. You can reuse those files or download fresh ones if you prefer. We&#x27;ll write a function that loads these files into memory and publishes the data to our Tickerplant. And since we also want to build a backtesting engine, we’ll stream the historical data on a timer to simulate a “time-lapse” playback of market history.</p>
<p>Let’s get started.</p>
<p>First, we define the table schema for the data we want to load and gather the filenames of all historical data files into a variable. When following along, remember to update the file path to match the location of your own data. Also make sure that the folder contains only data files, as the <code>key</code> operator will list everything inside that directory.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Define table schema for data we are going to load</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data:([] time:`timestamp$(); sym:`symbol$(); feedHandlerTime: `timestamp$(); open: `float$(); high: `float$(); low: `float$(); close: `float$(); volume: `long$());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// List of files we want to load (Change this path to your file location. Note:folder should only contain your data as everything in the folder will be loaded)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fileList:key `$&quot;:/Users/alexanderunterrainer/repos/defconQ/projects/tradingStrategy/stock_data&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loadData:{[file]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Extract the name of the stock from the file name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name:`$first &quot;_&quot; vs string file;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Load the data for the specific file, update the sym column with the stock name and a feedHandlerTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `data insert update sym:name,`timestamp$`date$time,feedHandlerTime:time from `time`open`high`low`close`volume xcol (&quot;PFFFFJ&quot;;enlist csv) 0:hsym file;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After defining our function, we can run it</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)loadData each fileList;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Before we can start streaming any data, we first need to bring up the Tickerplant. For this tutorial, we’re using an even more stripped-down version of the plain vanilla Tickerplant. If you’d like a detailed, line-by-line explanation of how it works, check out my walkthrough linked <a href="https://www.defconq.tech/docs/tutorials/tick" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>For now, let’s go ahead and start the Tickerplant.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alexanderunterrainer@Mac:~/repos/defconQ/projects/tradingStrategy|master⚡ ⇒  qx tick.q sym . -p 5010</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KDB-X 0.1.1 2025.09.29 Copyright (C) 1993-2025 Kx Systems</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)stocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time sym feedHandlerTime open high low close volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once the Tickerplant is up and running, we can connect to it using <code>hopen</code>, which creates a connection handle between our feed handler and the Tickerplant. From there, we’re able to publish our data. Since we haven’t started any real-time subscribers yet, the Tickerplant will simply write the updates to its log file without broadcasting them to any subscribers.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)h:hopen 5010</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)h(`.u.upd;`stocks;data)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now that our data pipeline is in place, it’s time to build the Complex Event Processing Engine that will execute our trading strategy.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="complex-event-processing-engine-cep-effortless-business-logic-in-motion">Complex Event Processing Engine (CEP): Effortless Business Logic in Motion<a href="#complex-event-processing-engine-cep-effortless-business-logic-in-motion" class="hash-link" aria-label="Direct link to Complex Event Processing Engine (CEP): Effortless Business Logic in Motion" title="Direct link to Complex Event Processing Engine (CEP): Effortless Business Logic in Motion">​</a></h2>
<p>For our trading strategy, we’ll implement a straightforward moving average crossover model. It uses two averages: a short-term 50-day moving average and a long-term 200-day one. The signal rules are simple: when the short average crosses above the long average, we generate a buy signal; when it crosses below, we trigger a sell signal. This captures the classic idea that prices tend to revert toward their longer-term trend over time.</p>
<p>Calculating the moving averages couldn’t be easier, KDB-X gives us the <code>mavg</code> keyword out of the box. This is another perfect example of why it excels at analytical workloads. Using <code>mavg</code>, we can directly update our table with both moving averages. The only detail to watch out for is that our dataset contains multiple symbols, so we need to compute the averages for each symbol. That’s easily achieved using a <code>by</code> clause as you can see in the line below</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)update sma50:mavg[50;close],sma200:mavg[200;close] by sym from `stocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`stocks</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So far so good, we’ve made solid progress. But now it’s time to bring our data to life. Let’s start building our dashboard. As a reminder, this is what the final result will look like:</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard" src="/assets/images/tradingDashboard-d1d0b201c5177b8955fbea5dfbb1264c.png" width="1917" height="1102" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pulse-the-catwalk-for-your-data-model">Pulse: The Catwalk for Your Data Model<a href="#pulse-the-catwalk-for-your-data-model" class="hash-link" aria-label="Direct link to Pulse: The Catwalk for Your Data Model" title="Direct link to Pulse: The Catwalk for Your Data Model">​</a></h2>
<p>For those who know me, I’m much more of a backend person, I usually steer clear of UI and front-end work. But Pulse is so simple and intuitive that even I found myself <em><strong>almost</strong></em> enjoying the UI side of things.
Once you’ve installed Pulse (installation guide linked <a href="https://www.timestored.com/pulse/" target="_blank" rel="noopener noreferrer">here</a>), you can launch it directly from your terminal. This opens a new tab in your browser where you can begin designing your dashboard. The first step is to set up a connection to the KDB-X process that holds our data.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Start Pulse from your terminal. This will launch Pulse and open the landing page</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alexanderunterrainer@Mac:~|⇒  java -jar pulse.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Landing Page" src="/assets/images/PulseLandingPage-690acff77edc98a79b58c26c14a2be4d.png" width="1917" height="924" class="img_ev3q">
<strong>Pulse Landing Page</strong></p>
<p>Now let’s create a new connection by specifying the host and port. In our example, the process is running on <code>localhost</code> using port <code>5001</code>.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Add Connection" src="/assets/images/PulseAddConnection-d52b33d33e5937124b7d8f892d72da57.png" width="1065" height="975" class="img_ev3q"></p>
<p>With the connection configured, we can move on to creating our dashboard. Go ahead and add a new one to get started.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Add Connection" src="/assets/images/PulseAddDashboard-49f3260346d28080a6fb20d932e350f6.png" width="1217" height="318" class="img_ev3q"></p>
<p>A new dashboard will open in design mode, and we can start adding components right away. I’m a big believer in the “low-hanging fruit principle”, tackle the easiest wins first. So let’s begin by charting the volume.
Before that, though, let’s quickly save and rename our dashboard.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Save Dashboard" src="/assets/images/PulseSaveDashboard-ab3c81a513d86b125fa893c77916124a.png" width="500" height="372" class="img_ev3q"></p>
<p>Once that’s done, click the <strong>Time Series</strong> button in the top panel to add a new time-series chart.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Add TimeSeries" src="/assets/images/PulseAddTimeSeries1-e4b998f46265e5ab73a229483a75eb7f.png" width="1522" height="181" class="img_ev3q"></p>
<p>Pulse will generate a placeholder chart with simulated data, which we can now replace by updating the query to display the volume we’re interested in.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Dummy TimeSeries" src="/assets/images/PulseTimeSeriesDummy-dc20ee9dd5051a80ac46a369b8c90ffd.png" width="1920" height="1078" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Query for volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`time xasc select time,volume from stocks</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Volume Time Series Chart" src="/assets/images/PulseTimeSeriesVolume-5ce6b58f502a51b671e5b24ae6296315.png" width="1916" height="1070" class="img_ev3q"></p>
<p>Hold on, something looks off. There are far too many data points, and the volume fluctuations don’t make much sense. That’s because our <code>stocks</code> table contains data for multiple symbols, so when we chart the volume directly, we’re plotting everything at once. The fix is simple: we add a drop-down selector so we can choose the specific stock we want to display.</p>
<p>To do this, add a <strong>User Form</strong>. Click the <strong>User Form button</strong> in the top panel and place it above your volume chart. Then, in the Form Editor on the right, add a Dropdown component. We can populate the drop-down with our stock symbols by running a simple KDB-X query. Details below.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse User Form" src="/assets/images/PulseuserForm-e78f58ec459d287b62a8a6b3c058c6c2.png" width="1920" height="1105" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">asc select distinct sym from stocks</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse User Form Stock Query" src="/assets/images/PulseUserFormStockQuery-ac9b7937c43d4bea6c6663d82a61aa04.png" width="1287" height="569" class="img_ev3q">
<img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Volume Stock Dropdown" src="/assets/images/PulseStockDropdown-895fd13ac549ccdfd977208cafbc3b6d.png" width="459" height="628" class="img_ev3q"></p>
<p>All that’s left is to connect the drop-down to our volume chart so that selecting a symbol updates the chart accordingly. We can do this by referencing the drop-down’s assigned key directly in the chart’s query. The updated query looks like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">`time xasc select time,volume from stocks where sym=`${{key1}}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Dashboard With Stock Dropdown" src="/assets/images/PulseDashboardWithStockDropdown-c6ffd7f1329be8117ccad068b86e9f79.png" width="1914" height="1103" class="img_ev3q"></p>
<p>Not too bad, right? Since our historical dataset spans several decades, it’s useful to control how much of it we display at once. Let’s add another drop-down to let us choose the time range. Later, when we switch to real-time backtesting, this drop-down won’t be needed anymore and can be removed.</p>
<p>We start by adding another drop-down to choose the date range we want to display. This time, instead of populating the options with a Q-SQL query, we simply hard-code a list of day counts that correspond to 1, 2, 3, 5, 7, 10, and 15 years. We also include a large value to allow selecting the full time series.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Dashboard Period Dropdown" src="/assets/images/PulsePeriodList-e21254aad151c0c65cbcad09242d2926.png" width="702" height="485" class="img_ev3q">
<img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Dashboard Period Dropdown" src="/assets/images/PulsePeriodDropdown-e2734f15e66665de56673575cf72e868.png" width="291" height="445" class="img_ev3q"></p>
<p>Next, we update the volume query to incorporate the drop-down’s key so the chart adjusts based on the selected range. For a small visual upgrade, we switch the chart from a <strong>line plot</strong> to a <strong>bar chart</strong>, and just like that, we have a clean, intuitive volume visualization for our stocks.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Dashboard Period Query" src="/assets/images/PulsePeriodQuery-102348e70ed8e8c6f849c214d1a42099.png" width="700" height="466" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-{{key2}}#select time,volume from stocks where sym=`${{key1}}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Alright, with the volume chart in place, it’s time to move on to the price chart and start implementing our trading strategy. As before, we’ll tackle the easy part first, plotting the price series along with the moving averages.</p>
<p>Just like we did for the volume chart, we’ll add a new time-series component and define a Q-SQL query that selects the <code>time</code>, <code>close</code>, <code>sma50</code> (50-day simple moving average), and <code>sma200</code> (200-day simple moving average). As before, we’ll use the values from our drop-downs to limit the chart to a specific stock and chosen time range.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Dashboard SMA Chart" src="/assets/images/PulseSMAChart-101329c05963a2a6d0cf3b73d31b864a.png" width="1919" height="689" class="img_ev3q"></p>
<p>And just like that, we now have a clean visual of the price data alongside both moving averages. But how do we turn this into trading signals?
Our rules are simple:</p>
<ul>
<li><strong>buy</strong> when the short-term moving average (<code>sma50</code>) crosses above the long-term average (<code>sma200</code>).</li>
<li><strong>sell</strong> when the short-term moving average (<code>sma50</code>) crosses below the long-term average (<code>sma200</code>).</li>
</ul>
<p>Instead of jumping straight into solving this on our full dataset, let’s first strip the problem down and build the logic step by step. We’ll start with two simple lists: one for the short moving average and one for the long moving average:</p>
<ul>
<li><code>s: 3 7 8 12 10 11 9 7</code> (short MA)</li>
<li><code>l: 5 9 10 11 8 7 12 13</code> (long MA)</li>
</ul>
<p>First, we subtract the long moving average <code>l</code> from the short moving average <code>s</code>. This tells us whether the short MA is above or below the long MA at each point.</p>
<p>Next, we apply the built-in <code>signum</code> function to that result. <code>signum</code> returns <code>-1</code> for <strong>negative</strong> values, <code>1</code> for <strong>positive</strong> values, and <code>0</code> when the input is <strong>zero</strong>. We then compare this list against <code>0</code> to get a boolean mask indicating where the short MA is below the long MA. This effectively captures when the relationship between the two averages flips from negative to positive (or the other way around).</p>
<p>Finally, we use <code>deltas</code> on this boolean sequence to generate our trading signals:</p>
<ul>
<li>A delta of <code>+1</code> → we buy</li>
<li>A delta of <code>-1</code> → we sell</li>
<li>A delta of <code>0</code> → we do nothing</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)s:3 7 8 12 10 11 9 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)l:5 9 10 11 8 7 12 13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)s-l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-2 -2 -2 1 2 4 -3 -6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)signum s-l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-1 -1 -1 1 1 1 -1 -1i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)0&lt;signum s-l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00011100b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)deltas 0&lt;signum s-l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 0 0 1 0 0 -1 0i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)1+deltas 0&lt;signum s-l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 1 1 2 1 1 0 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)`sell`doNothing`buy 1+deltas 0&lt;signum s-l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`doNothing`doNothing`doNothing`buy`doNothing`doNothing`sell`doNothing</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The final step is to use the <code>deltas</code> output as an index into a list of symbols, allowing us to map the numeric values directly to their corresponding trading signals.</p>
<p>Now let’s integrate the signal-generation logic into our dashboard so we can produce a chart like the one shown below. It’s not particularly complicated, but it does require a few lines of code. We’ll also take advantage of some built-in Pulse features to display those nice visual marker, bubbles that highlight each buy or sell signal right on the chart.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Dashboard SMA Chart with Signal" src="/assets/images/PulsePriceChartSignals-0a62881af79d53e064e500c447f0f28c.png" width="1916" height="685" class="img_ev3q"></p>
<p>Pulse is extremely flexible and even lets you write logic directly inside the chart’s code editor. However, to keep things clean and maintainable, we’ll follow good coding practices and wrap our logic in a function that Pulse can call, with parameters controlled by the UI.</p>
<p>We’ll create a function called <code>priceChart</code> that takes two arguments: the stock symbol we want to plot and the time range (in days). We’ll build it step by step. First, we reuse the original query that returns the price and the two moving averages.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">select time,sym,sma50:mavg[50;close],sma200:mavg[200;close],price:close from stocks where sym=stock</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then we extend that result with our signal-generation logic, keeping the numeric encoding for now: <code>-1</code> for <strong>sell</strong>, <code>1</code> for <strong>buy</strong>, and <code>0</code> for <strong>no action</strong>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">update signal:deltas 0&lt;signum sma50-sma200 from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select time,sym,sma50:mavg[50;close],sma200:mavg[200;close],price:close from stocks where sym=stock</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, we derive a trade action and the corresponding buy/sell price, which for simplicity we set to the closing price at the signal time (ignoring bid/ask). After that, we create the visual “bubbles” that mark buys and sells using Pulse’s built-in conventions: if you add a column named <code>&lt;field&gt;_SD_CIRCLE</code> and define <code>&lt;field&gt;_SD_SIZE</code>, Pulse will draw a bubble of that size at the corresponding point. By adding four columns, <code>buy_SD_CIRCLE</code>, <code>buy_SD_SIZE</code>, <code>sell_SD_CIRCLE</code>, and <code>sell_SD_SIZE</code>, we get clear visual markers for our buy and sell signals.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">update buy_SD_CIRCLE:buy*signal,buy_SD_SIZE:10,sell_SD_CIRCLE:abs sell*signal,sell_SD_SIZE:10 from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">update action:`sell`doNothing`buy 1+signal,buy:?[signal=1;price;0N],sell:?[-1=signal;price;0n] from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">update signal:deltas 0&lt;signum sma50-sma200 from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select time,sym,sma50:mavg[50;close],sma200:mavg[200;close],price:close from stocks where sym=stock</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the final step, we narrow things down to just the columns we care about and apply <code>sublist</code> to restrict the output to the selected date range. Here’s the full function in one piece.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">priceChart:{[stock;range]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sublist[range;] select time,price,sma50,sma200,buy_SD_CIRCLE,buy_SD_SIZE,sell_SD_CIRCLE,sell_SD_SIZE from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        update buy_SD_CIRCLE:buy*signal,buy_SD_SIZE:10,sell_SD_CIRCLE:abs sell*signal,sell_SD_SIZE:10 from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        update action:`sell`doNothing`buy 1+signal,buy:?[signal=1;price;0N],sell:?[-1=signal;price;0n] from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        update signal:deltas 0&lt;signum sma50-sma200 from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        select time,sym,sma50:mavg[50;close],sma200:mavg[200;close],price:close from stocks where sym=stock}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Following the same good coding practices, let’s also create a dedicated function for the volume chart.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">volumeChart:{[stock;range] select time, avgVolume:avg volume, volume from sublist[range;] select time,volume from stocks where sym=stock }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you’ve probably noticed, we also added the average volume to our volume chart. However, because KDB-X evaluates expressions from right to left, we can’t just compute the average volume first and then apply <code>sublist</code>, that would calculate the average over the <em><strong>entire</strong></em> dataset, giving us the wrong value for the selected time window.</p>
<p>To get the correct result, we must first extract the sublist for the chosen date range and <em><strong>then</strong></em> compute the average volume on that subset.</p>
<p>If you’re wondering why we use <code>sublist</code> instead of the <strong>take</strong> <code>#</code> operator, it comes down to their different behaviors. When you use <code>take #</code> on a list of <code>5</code> elements and request <code>7</code>, <code>take</code> will start cycling through the list again from the beginning to reach the desired length. In contrast, <code>sublist</code> returns only <code>min(n; count list)</code> elements.</p>
<p>This matters when a stock’s price history is shorter than the time range the user selects, <code>sublist</code> prevents accidental cycling and ensures we only return the data that actually exists.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)7#til 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3 4 0 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)7 sublist til 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 1 2 3 4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now that our functions are in place, the final step is simply adding them into our Pulse dashboard. We just add the function calls to the TimeSeries code editor and pass in the selected stock and time-range values from our drop-down inputs. That’s all it takes, let’s hook everything up.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Dashboard Volume Chart with refactored analytics function" src="/assets/images/PulseVolumeChartRefactored-4753ce09c1a9dd8f8b519cc66664192e.png" width="1918" height="1080" class="img_ev3q"></p>
<p>The last element to complete our dashboard is a summary table positioned at the top. This table presents key information at a glance, buy or sell price, the generated signal, volume, SMA50, SMA200, and the current price. It adds a numerical layer of context to complement the visual cues from our charts, rounding out the trading interface with clear, actionable insight.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Dashboard Summary Table" src="/assets/images/PulseSummaryTableAnalytics-3738681bf0f3b5355bca501aeb24b747.png" width="1920" height="376" class="img_ev3q"></p>
<p>If we look closely at our <code>priceChart</code> function, we’ll notice that nearly all the data required for our summary table is already being produced. The only real difference is the set of columns we want to return. So instead of duplicating logic, we’ll refactor the function, rename it to <code>analytics</code>, and introduce a third parameter that specifies which column set we want, whether for the price chart or for the summary table.</p>
<p>By using a <code>functional select</code>, we can make the underlying query far more flexible and dynamic. It’s yet another great example of how expressive and powerful KDB-X can be. You’ll find the refactored version of the code below.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>You can read everything about functional selects on my dedicated blog post <a href="https://www.defconq.tech/docs/concepts/functionalSelect" target="_blank" rel="noopener noreferrer">here</a></p></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">analytics:{[stock;range;columns]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         chartColumns:`time`price`sma50`sma200`buy_SD_CIRCLE`buy_SD_SIZE`sell_SD_CIRCLE`sell_SD_SIZE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         tableColumns:`time`sym`action`buy`sell`price`volume`sma50`sma200;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         c:();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         if[columns=`tab;c:tableColumns];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         if[columns=`chart;c:chartColumns];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ?[;();0b;{x!x} c]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         sublist[range;] `time xasc update buy_SD_CIRCLE:buy*signal,buy_SD_SIZE:10,sell_SD_CIRCLE:abs sell*signal,sell_SD_SIZE:10 from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         update action:`sell`doNothing`buy 1+signal,buy:?[signal=1;price;0N],sell:?[-1=signal;price;0n] from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         update signal:deltas 0&lt;signum sma50-sma200 from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         select time,sym,sma50:mavg[50;close],sma200:mavg[200;close],price:close,volume from stocks where sym=stock}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now all that remains is a bit of clean-up to make the dashboard look polished and professional. Rename each component to something meaningful, add some spacing to the left and right of the charts, and tidy up the layout. And just like that, voilà, you’ve got a sleek, production-ready dashboard that supports your traders’ decision-making with clarity and style.</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Margin Settings for Charts" src="/assets/images/PulseMargin-0c8c05b2dec28795d7b56bb371144c2d.png" width="689" height="252" class="img_ev3q">
<img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Dashboard Professional Version" src="/assets/images/PulseDashboardProfessional-ce4a72ffdb4168617e65296af92958ea.png" width="1920" height="1099" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="backtesting-for-alpha-turning-strategy-into-performance">Backtesting for Alpha: Turning Strategy Into Performance<a href="#backtesting-for-alpha-turning-strategy-into-performance" class="hash-link" aria-label="Direct link to Backtesting for Alpha: Turning Strategy Into Performance" title="Direct link to Backtesting for Alpha: Turning Strategy Into Performance">​</a></h2>
<p>At the start of this tutorial, I promised we would build a backtesting engine for our trading strategy, and I always deliver. In this final section, we’ll put everything together by creating a simple yet powerful backtester, powered by KDB-X’s built-in timer functionality: <a href="https://code.kx.com/q/ref/dotz/#zts-timer" target="_blank" rel="noopener noreferrer"><code>.z.ts</code></a>.</p>
<p>Normally, <code>.z.ts</code> is undefined, but once you assign a function to it, that function is executed automatically every <code>n</code> milliseconds. You control this interval via a system command <code>\t</code>, either when starting your process with <code>-t n</code> or dyhnamically at runtime with <code>\t n</code>.</p>
<p>Let’s look at a small example to understand how it works. We define <code>.z.ts:{show x}</code>, which prints the argument <code>x</code> every time the timer fires. By default, <code>x</code> is the current timestamp. So, when we set the timer to fire every <code>1000 milliseconds</code> using <code>\t 1000</code>, we get the current time printed once per second. Simple, elegant, and exactly what we’ll use to “time-lapse” our historical data for backtesting. You can reseet the timer by setting it to zero <code>\t 0</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q).z.ts:{show x}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)\t 1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)2025.12.07D15:23:23.316105000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2025.12.07D15:23:24.316105000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2025.12.07D15:23:25.316105000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2025.12.07D15:23:26.316105000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2025.12.07D15:23:27.316105000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2025.12.07D15:23:28.316105000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2025.12.07D15:23:29.316105000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2025.12.07D15:23:30.316105000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\t 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Remember, our original feed handler holds the <em><strong>entire</strong></em> price history for our stocks, about 75,000 records spanning from 1980 all the way to 2025. For the backtesting engine, we want to replay this history as a time-lapse, streaming one day’s worth of data every 100 milliseconds.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)count data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">75863</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)exec `startDate`EndDate!(min;max)@\:time by sym from data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       | startDate                     EndDate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------ | -----------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7203.T | 1999.05.06D00:00:00.000000000 2025.05.26D00:00:00.000000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9988.HK| 2019.11.26D00:00:00.000000000 2025.05.26D00:00:00.000000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AAPL   | 1980.12.12D00:00:00.000000000 2025.05.23D00:00:00.000000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AMZN   | 1997.05.15D00:00:00.000000000 2025.05.23D00:00:00.000000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOOG   | 2004.08.19D00:00:00.000000000 2025.05.23D00:00:00.000000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">META   | 2012.05.18D00:00:00.000000000 2025.05.23D00:00:00.000000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSFT   | 1986.03.13D00:00:00.000000000 2025.05.23D00:00:00.000000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QQQ    | 1999.03.10D00:00:00.000000000 2025.05.23D00:00:00.000000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SPY    | 1993.01.29D00:00:00.000000000 2025.05.23D00:00:00.000000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TSLA   | 2010.06.29D00:00:00.000000000 2025.05.23D00:00:00.000000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VOW3.DE| 1998.07.22D00:00:00.000000000 2025.05.26D00:00:00.000000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VTI    | 2001.06.15D00:00:00.000000000 2025.05.23D00:00:00.000000000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The logic is straightforward:</p>
<ol>
<li>Extract the list of all distinct trading dates from our dataset.</li>
<li>Initialize a counter to track our current position within that date list.</li>
<li>On each timer tick (every 100 ms), publish the data for the next date to the Tickerplant.</li>
<li>Increment the counter so the following tick streams the next day in sequence.</li>
</ol>
<p>Alright, time to bring it all together!</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)dateList:exec distinct `date$time from data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)dateList</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06 1999.05.07 1999.05.10 1999.05.11 1999.05.12 1999.05.13 1999.05.14 1999.05.17 1999.05.18 1999.05.19 1999.05.20 1999.05.21 1999.05.24 1999.05.25 1999.05.26 1999.05.27 1999.05.28 1999.05.31 1999.06.01 1999.06.02 1999.06.03 1999.06...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)(min;max)@\:dateList</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1980.12.12 2025.05.26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)cntr:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)select from data where $[`date;time]=dateList 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time                          sym     feedHandlerTime               open      high      low       close     volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------------------------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06D00:00:00.000000000 7203.T  1999.05.06D00:00:00.000000000 396.8346  410.4793  392.2863  410.4793  15575000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06D00:00:00.000000000 AAPL    1999.05.06D00:00:00.000000000 0.3498498 0.3521977 0.3305959 0.3343524 433148800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06D00:00:00.000000000 AMZN    1999.05.06D00:00:00.000000000 3.7       3.775     3.39375   3.434375  365688000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06D00:00:00.000000000 MSFT    1999.05.06D00:00:00.000000000 24.73093  24.86503  23.75395  23.88805  74021000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06D00:00:00.000000000 QQQ     1999.05.06D00:00:00.000000000 45.50791  45.90524  43.83911  44.26293  15173400</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06D00:00:00.000000000 SPY     1999.05.06D00:00:00.000000000 84.72099  85.15424  83.42122  84.43543  13507200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1999.05.06D00:00:00.000000000 VOW3.DE 1999.05.06D00:00:00.000000000 12.69323  12.72496  12.17915  12.50283  107812</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)stream:{-1&quot;Streaming data for date:&quot;,string dateList cntr;select from data where $[`date;time]=dateList cntr;cntr::cntr+1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)stream[]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Streaming data for date:1999.05.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)stream[]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Streaming data for date:1999.05.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)stream[]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Add the actual publishing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stream:{-1&quot;Streaming data for date:&quot;,string dateList cntr;h(`.u.upd;`stocks;select from data where $[`date;time]=dateList cntr);cntr::cntr+1}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Before we begin streaming, let’s reset the CEP by clearing out any previously stored data and create a copy of our Pulse dashboard to preserve the historical version. In the new <em><strong>Backtesting Dashboard</strong></em>, we’ll remove the date-range drop-down and adjust our functions accordingly. With these two changes in place, we’re ready to fire up the backtesting engine. It&#x27;s showtime!!!</p>
<p><img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Margin Settings for Charts" src="/assets/images/PulseBacktestingBefore-1d118e10fcd86f1a1d13a35a5d1f0c61.png" width="1920" height="1102" class="img_ev3q">
<img decoding="async" loading="lazy" alt="DefconQ Trading Hub Dashboard - Pulse Margin Settings for Charts" src="/assets/images/PulseBacktestingAfter-647019672ae8c5a59b7d1e747cf5dc7d.png" width="1917" height="1070" class="img_ev3q">
<img decoding="async" loading="lazy" alt="DefconQ Pulse Backtesting Dashboard" src="/assets/images/DefconQPulseBacktestingDashboard-578104de644d24fb037e90ff6bf87145.mov" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="video-tutorial">Video Tutorial<a href="#video-tutorial" class="hash-link" aria-label="Direct link to Video Tutorial" title="Direct link to Video Tutorial">​</a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Cya2BD1hJOY?si=pcRrxFBD4YkSSxLn" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin"></iframe>
<p>Code repo: <a href="https://github.com/DefconQ/defconQ/tree/master/projects/tradingStrategy" target="_blank" rel="noopener noreferrer">Pulse Powered Alpha: Building your First Trading Strategy with KDB-X and Pulse</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tutorials/realTimeStocksUpdate"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Streaming Smarter: Real-Time Market Data with Kola, Python, and Databento</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/productivity-tools"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Productivity Tools</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#before-we-dive-in-gearing-up-for-the-strategy-build" class="table-of-contents__link toc-highlight">Before We Dive In: Gearing Up for the Strategy Build</a></li><li><a href="#blueprints-before-code-designing-your-trading-engine-the-right-way" class="table-of-contents__link toc-highlight">Blueprints Before Code: Designing Your Trading Engine the Right Way</a></li><li><a href="#feeding-the-beast-bringing-data-into-your-trading-engine" class="table-of-contents__link toc-highlight">Feeding the Beast: Bringing Data Into Your Trading Engine</a></li><li><a href="#complex-event-processing-engine-cep-effortless-business-logic-in-motion" class="table-of-contents__link toc-highlight">Complex Event Processing Engine (CEP): Effortless Business Logic in Motion</a></li><li><a href="#pulse-the-catwalk-for-your-data-model" class="table-of-contents__link toc-highlight">Pulse: The Catwalk for Your Data Model</a></li><li><a href="#backtesting-for-alpha-turning-strategy-into-performance" class="table-of-contents__link toc-highlight">Backtesting for Alpha: Turning Strategy Into Performance</a></li><li><a href="#video-tutorial" class="table-of-contents__link toc-highlight">Video Tutorial</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Learn</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/defconq/" target="_blank" rel="noopener noreferrer" class="footer__link-item">DefconQ Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/alexanderunterrainer/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Alexander Unterrainer Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://defconq.myspreadshop.co.uk" target="_blank" rel="noopener noreferrer" class="footer__link-item">DefconQ Swag<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://www.youtube.com/@DefconQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube Channel<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Substack Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://medium.com/@defconq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/DefconQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 DefconQ Ltd. This website is maintained by Alexander Unterrainer. Disclaimer: All content shared on this website reflect solely his personal thoughts and opinions, and is not representative of any past, current, or future employers or affiliations.</div></div></div></footer></div>
</body>
</html>