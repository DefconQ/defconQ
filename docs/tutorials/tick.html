<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/tick" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">KDB Tick Explained: A Walkthrough [PART 1] | DefconQ</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://DefconQ.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://DefconQ.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://DefconQ.github.io/docs/tutorials/tick"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="KDB Tick Explained: A Walkthrough [PART 1] | DefconQ"><meta data-rh="true" name="description" content="In this blog post, we&#x27;re diving into the code of a simple Tickerplant. We&#x27;ll break it down line by line, explaining what each part does and how it fits into the big picture. This will not only demystify Tickerplants but also shed light on important KDB/Q programming concepts. By doing so, you&#x27;ll gain insights into the inner workings of a Tickerplant and acquire a deeper understanding of key concepts in the KDB/Q programming language."><meta data-rh="true" property="og:description" content="In this blog post, we&#x27;re diving into the code of a simple Tickerplant. We&#x27;ll break it down line by line, explaining what each part does and how it fits into the big picture. This will not only demystify Tickerplants but also shed light on important KDB/Q programming concepts. By doing so, you&#x27;ll gain insights into the inner workings of a Tickerplant and acquire a deeper understanding of key concepts in the KDB/Q programming language."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://DefconQ.github.io/docs/tutorials/tick"><link data-rh="true" rel="alternate" href="https://DefconQ.github.io/docs/tutorials/tick" hreflang="en"><link data-rh="true" rel="alternate" href="https://DefconQ.github.io/docs/tutorials/tick" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://R6JV2N50EX-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="DefconQ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="DefconQ Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E9ED09HNE3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-E9ED09HNE3",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="DefconQ" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.5860f28a.css">
<script src="/assets/js/runtime~main.2e176c5a.js" defer="defer"></script>
<script src="/assets/js/main.b0506ebd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#74e8a3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Stay up to date with the latest blogs posts - subscribe to my free Substack newsletter now <a href="https://defconq.substack.com">Free Substack Newsletter</a> or follow me on <a href="https://medium.com/@defconq">Medium</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="DefconQ Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="150" width="50"><img src="/img/logoLight.svg" alt="DefconQ Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="150" width="50"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Learn</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/about/about">About</a><a class="navbar__item navbar__link" href="/testimonials/testimonials">Testimonials</a><a class="navbar__item navbar__link" href="/happyHour/happyHour">Happy Hour</a><a class="navbar__item navbar__link" href="/cv/cv">CV</a><a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Substack Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://medium.com/@defconq" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://defconq.myspreadshop.co.uk" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Swag<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/DefconQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-study-roadmap">KDB/Q Study Roadmap</a><button aria-label="Expand sidebar category &#x27;KDB/Q Study Roadmap&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-language">KDB/Q Language</a><button aria-label="Expand sidebar category &#x27;KDB/Q Language&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kdbq-architecture">KDB/Q Architecture</a><button aria-label="Expand sidebar category &#x27;KDB/Q Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/important-concepts">Important Concepts</a><button aria-label="Expand sidebar category &#x27;Important Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/design-patterns-for-kdbq-systems">Design Patterns for KDB/Q Systems</a><button aria-label="Expand sidebar category &#x27;Design Patterns for KDB/Q Systems&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/tutorials">Tutorials</a><button aria-label="Collapse sidebar category &#x27;Tutorials&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorials/tick">KDB Tick Explained: A Walkthrough [PART 1]</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/tick2">KDB Tick Explained: A Walkthrough [PART 2]</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/realTimeStocks">A Real Time Stock Market Feed</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/researchHDB">Back to the Future: Building Your Research HDB for Stock Market Insights</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/realTimeStocksUpdate">Streaming Smarter: Real-Time Market Data with Kola, Python, and Databento</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/productivity-tools">Productivity Tools</a><button aria-label="Expand sidebar category &#x27;Productivity Tools&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/tutorials"><span itemprop="name">Tutorials</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">KDB Tick Explained: A Walkthrough [PART 1]</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>KDB Tick Explained: A Walkthrough [PART 1]</h1>
<p>In this blog post, we&#x27;re diving into the code of a simple Tickerplant. We&#x27;ll break it down line by line, explaining what each part does and how it fits into the big picture. This will not only demystify Tickerplants but also shed light on important KDB/Q programming concepts. By doing so, you&#x27;ll gain insights into the inner workings of a Tickerplant and acquire a deeper understanding of key concepts in the KDB/Q programming language.</p>
<p>We&#x27;ll also chat about the limitations of a basic Tickerplant, get cozy with fundamental KDB/Q operators, and explore their many flavors. To make the most of this, prior knowledge of the Tick architecture is crucial. If you need a refresher, check out my previous post <a href="https://defconq.tech/docs/architecture/plain" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>Our approach will involve a systematic breakdown. We will start with an in-depth explanation of each function, highlighting its purpose and contextual relevance. Following this, we will broaden our perspective to examine the entire code comprehensively in a line-by-line analysis of the code, delving into the specifics of input and output for each function.</p>
<p>You can access the KDB Tick code on the official KX GitHub page <a href="https://github.com/KxSystems/kdb-tick/tree/master" target="_blank" rel="noopener noreferrer">here</a>. Note, this blog post is based on the code as of November 2023 and any future change need to be re-examined.</p>
<p>To enhance readability and minimize the need to switch between this blog and the codebase, I&#x27;m providing the code here:</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-tickerplant-core-tickq">The Tickerplant Core <code>tick.q</code><a href="#the-tickerplant-core-tickq" class="hash-link" aria-label="Direct link to the-tickerplant-core-tickq" title="Direct link to the-tickerplant-core-tickq">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  1 system&quot;l tick/&quot;,(src:first .z.x,enlist&quot;sym&quot;),&quot;.q&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3 if[not system&quot;p&quot;;system&quot;p 5010&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  5 \l tick/u.q</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  6 \d .u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  7 ld:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  8   if[not type key L::`$(-10_string L),string x;.[L;();:;()]];i::j::-11!(-2;L);if[0&lt;=type i;-2 (string L),&quot; is a corrupt log. Truncate to length &quot;,(string last i),&quot; and restart&quot;;    exit 1];hopen L};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 10 tick:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 11   init[];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 12   if[not min(`time`sym~2#key flip value@)each t;&#x27;`timesym];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 13   @[;`sym;`g#]each t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 14   d::.z.D;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 15   if[l::count y;L::`$&quot;:&quot;,y,&quot;/&quot;,x,10#&quot;.&quot;;l::ld d]};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 17 endofday:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 18   end d;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 19   d+:1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 20   if[l;hclose l;l::0(`.u.ld;d)]};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 21</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 22 ts:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 23   if[d&lt;x;if[d&lt;x-1;system&quot;t 0&quot;;&#x27;&quot;more than one day?&quot;];endofday[]]};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 25 if[system&quot;t&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 26   .z.ts:{pub&#x27;[t;value each t];@[`.;t;@[;`sym;`g#]0#];i::j;ts .z.D};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 27   upd:{[t;x]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 28   if[not -16=type first first x;if[d&lt;&quot;d&quot;$a:.z.P;.z.ts[]];a:&quot;n&quot;$a;x:$[0&gt;type first x;a,x;(enlist(count first x)#a),x]];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 29   t insert x;if[l;l enlist (`upd;t;x);j+:1];}];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 31 if[not system&quot;t&quot;;system&quot;t 1000&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 32   .z.ts:{ts .z.D};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 33   upd:{[t;x]ts&quot;d&quot;$a:.z.P;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 34   if[not -16=type first first x;a:&quot;n&quot;$a;x:$[0&gt;type first x;a,x;(enlist(count first x)#a),x]];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 35   f:key flip value t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 36   pub[t;$[0&gt;type first x;enlist f!x;flip f!x]];if[l;l enlist (`upd;t;x);i+:1];}];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 38 \d .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 39</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 40 .u.tick[src;.z.x 1];</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="helper-functions---uq">Helper Functions - <code>u.q</code><a href="#helper-functions---uq" class="hash-link" aria-label="Direct link to helper-functions---uq" title="Direct link to helper-functions---uq">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  1 \d .u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2 init:{w::t!(count t::tables`.)#()}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4 del:{w[x]_:w[x;;0]?y};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  6 .z.pc:{del[;x]each t};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  8 sel:{$[`~y;x;select from x where sym in y]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 10 pub:{[t;x] {[t;x;w]if[count x:sel[x]w 1;(neg first w)(`upd;t;x)]}[t;x]each w t}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 12 add:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 13   $[(count w x)&gt;i:w[x;;0]?.z.w;.[`.u.w;(x;i;1);union;y];w[x],:enlist(.z.w;y)];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 14   (x;$[99=type v:value x;sel[v]y;@[0#v;`sym;`g#]])}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 16 sub:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 17   if[x~`;:sub[;y]each t];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 18   if[not x in t;&#x27;x];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 19   del[x].z.w;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 20   add[x;y]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 21</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 22 end:{(neg union/[w[;;0]])@\:(`.u.end;x)}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-real-time-database-rdb-code---rq">The Real-Time Database (RDB) code - <code>r.q</code><a href="#the-real-time-database-rdb-code---rq" class="hash-link" aria-label="Direct link to the-real-time-database-rdb-code---rq" title="Direct link to the-real-time-database-rdb-code---rq">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  1 if[not &quot;w&quot;=first string .z.o;system &quot;sleep 1&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3 upd:insert;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  5 .u.x:.z.x,(count .z.x)_(&quot;:5010&quot;;&quot;:5012&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  7 .u.end:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  8   t:tables`.;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  9   t@:where `g=attr each t@\:`sym;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 10   .Q.hdpf[`$&quot;:&quot;,.u.x 1;`:.;x;`sym];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 11   @[;`sym;`g#] each t;};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 13 .u.rep:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 14   (.[;();:;].)each x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 15   if[null first y;:()];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 16   -11!y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 17   system &quot;cd &quot;,1_-10_string first reverse y };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 19 .u.rep .(hopen `$&quot;:&quot;,.u.x 0)&quot;(.u.sub[`;`];`.u `i`L)&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It&#x27;s remarkable to see how much you can accomplish in KDB/Q with such concise code. In a little over 80 lines, we&#x27;ve established the fundamental processes of a KDB/Q Tick system. Let&#x27;s now have a closer look at the content of each file and the functions in it:</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kdbq-tick-demystified">KDB/Q Tick demystified<a href="#kdbq-tick-demystified" class="hash-link" aria-label="Direct link to KDB/Q Tick demystified" title="Direct link to KDB/Q Tick demystified">​</a></h2>
<p>Before we have a deeper look into the code in each file, let&#x27;s have a look at the global variables used in a Tickerplant.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="global-variables">Global variables<a href="#global-variables" class="hash-link" aria-label="Direct link to Global variables" title="Direct link to Global variables">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> .u.w - A dictionary mapping all available tables to the handles of the real-time subscribers and the symbols they subscribe to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> .u.i - The message count in the TP log file. Note, because we can receive several records (rows) per message, this does not represent the total number of rows, but total numberof messages received</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> .u.j - The total message count (TP log file plus those messages held in memory if we run the Tickerplant in batch mode)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> .u.t - All table names available in the Tickerplant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> .u.L - The Tickerplant Log filename, e.g. `:./sym2023.10.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> .u.l - The handle to the Tickerplant Log file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> .u.d - The date for which the Tickerplant processes data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>While the majority of the global variables explained above are pretty much straight forward, <code>.u.w</code> deserves a closer look:</p>
<p>If we connect to a running Tickerplant and look at <code>.u.w</code> we will observe the following</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quote| 8i ` 9i `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trade| 8i ` 9i `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w[`quote]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8i `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9i `</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We soon realise, that <code>.u.w</code> is a dictionary, mapping each table to a list of lists, where each element is a pair consisting of the handle of the real-time subscriber and the list of symbols they subscribe to. If we wanted to recreate such a dictionary we could do so using the following code:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w:`trade`quote!(((8;`);(9;`));((8;`);(9;`)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trade| 8 ` 9 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quote| 8 ` 9 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w[`trade]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)0N!.u.w[`trade]	// Note: 0N! is a very helpful tool to output data to the console. This comes especially handy when debugging code.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">((8;`);(9;`))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 `</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It&#x27;s crucial to grasp the structure of this dictionary, as it proves beneficial when accessing information about the real-time subscribers.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="walkthrough">Walkthrough<a href="#walkthrough" class="hash-link" aria-label="Direct link to Walkthrough" title="Direct link to Walkthrough">​</a></h2>
<p>Let&#x27;s now start with our walkthrough and look at the code.</p>
<p>We start the Tickerplant by running the below command in our terminal passing the following parameters:</p>
<ul>
<li><strong>tick.q</strong> - the KDB/Q file containing the Tickerplant functions and logic</li>
<li><strong>SOURCE</strong> - the name of the file with the table defintions which is also used as directory name for where we want to store the data and the initial part of the Tickerplant Log file name</li>
<li><strong>DESTINATION</strong> [optional] - the location of where we want to store our data</li>
<li><strong><code>-p PORT</code></strong> [optional] - the port on which we want the Tickerplant to run on</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// q tick.q SOURCE DESTINATION[optional] -p 5010[optional]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Example: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Alexander@Alexanders-MBP:~/Desktop/kdb/tick</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⇒q tick.q sym  .  -p 5010	</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-symq-file">The <code>sym.q</code> file<a href="#the-symq-file" class="hash-link" aria-label="Direct link to the-symq-file" title="Direct link to the-symq-file">​</a></h3>
<p><code>tick.q</code> starts by loading the <code>sym.q</code> file into memory. The <code>sym.q</code> file contains all the table definitions of the tables we want to capture and is a prerequisite for the Tickerplant. A simple example can be found below:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  1 // sym.q</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2 // quote table schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3 quote:([]time:`timespan$();sym:`g#`symbol$();bid:`float$();ask:`float$();bsize:`int$();asize:`int$());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4 // trade table schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  5 trade:([]time:`timespan$();sym:`g#`symbol$();price:`float$();size:`int$());</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Below code loads our schemas:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">system &quot;l tick/&quot;,(src:first .z.x,enlist&quot;sym&quot;),&quot;.q&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>.z.x</code> contains the parameters we passed to the KDB/Q process. In case there were no parameters passed, we append the string <code>&quot;sym&quot;</code> to the list and then select the first element of this list. Note: we have to enlist our string <code>&quot;sym&quot;</code> otherwise it would be concatenated character by character to the existing list. The below code should illustrate this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q).z.x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;sym&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,&quot;.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).z.x,&quot;sym&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;sym&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,&quot;.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;y&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;m&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)first .z.x,enlist &quot;sym&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;sym&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As a next step we will append <code>&quot;.q&quot;</code> the file extenstion to the sym file and prepend the rest of the path to the location of the sym file. We then use the <code>system &quot;l&quot;</code> command to load the content of the <code>sym.q</code> file. This will load all table definitions into memory.</p>
<p>Next we check if the port of the Tickerplant has been set on startup with the <code>-p</code> flag and if not we set it to <code>5010</code>. All our KDB/Q processes need to run on a specific port in order for other services to connect to them. We do so by using an <code>if</code> statement and the <code>system</code> command:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if[not system&quot;p&quot;;system&quot;p 5010&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We then load the code stored in the <code>u.q</code> file which loads all the <code>.u</code> helper functions used in the Tickerplant</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">\l tick/u.q</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="uq-helper-functions"><code>u.q</code> Helper functions<a href="#uq-helper-functions" class="hash-link" aria-label="Direct link to uq-helper-functions" title="Direct link to uq-helper-functions">​</a></h2>
<p>The first line within <code>u.q</code> changes the default namespace into a <code>.u</code> namespace. In order to avoid name clashes of varibales or functions within the same processs, KDB/Q introduces the concept of namespaces. If you are not familiar with namespaces, you can read about this concept in <a href="https://code.kx.com/q4m3/12_Workspace_Organization/#121-namespaces" target="_blank" rel="noopener noreferrer">Chapter 12</a> of &quot;Q for Mortals&quot;.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">\d .u		// Change the namespace from default to .u</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For simplicity and readability, we will include the full, compound name (including namespace and context) of each function when describing them. I will describe the functions in a logical order, which will help you to comprehend the flow of the code. This order may slightly deviate from the order of the function definitions in <code>u.q</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="uinit"><code>.u.init</code><a href="#uinit" class="hash-link" aria-label="Direct link to uinit" title="Direct link to uinit">​</a></h2>
<p>Even though <code>.u.init</code> only consists of one line of code, it performs two very important tasks:</p>
<ul>
<li>it defines the list of tables <code>.u.t</code> a real-time subscribers can subscribe to</li>
<li>it creates a dictionary <code>.u.w</code> to keep track of the handles of all real-time subscribers and the tables and symbols they subscribe to. It does so by mapping each table name to a list of pairs consisting of the handle of the real-time subscriber and the corresponding symbols they susbcribe to. An example of a symbol would be the ticker symbol of an equity.</li>
</ul>
<p><code>.u.init</code> is called inside the <code>.u.tick</code> function, the entry function of the Tickerplant, which is the first function called when the Tickerplant comes up.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// @ param:		 	None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @ return:		None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.u.init:{[]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .u.w::.u.t!(count .u.t::tables `.)#()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As we already know, KDB/Q is read <a href="https://code.kx.com/q4m3/4_Operators/#412-left-of-right-evaluation" target="_blank" rel="noopener noreferrer">left-of-right</a> (or read from the right-to-left) which means we have to start at the end of the line. <code>(count .u.t::tables `.)#()</code> creates a list of empty lists of length <code>count tables `.</code>. We first retrieve the names of all tables defined in the Tickerplant (the ones we defined in the <code>sym.q</code> file and loaded at the beginning) and assign this list to the global variable <code>.u.t</code> using the <code>::</code> operator. If you&#x27;re within a function and want to assign a variable as global variable, which will exist beyond the scope of the current function, you can do so by using the <code>::</code> operators. We use <code>count</code> to identify how many tables exist and create a list of empty lists of exactly that length using the take <a href="https://code.kx.com/q/ref/take/" target="_blank" rel="noopener noreferrer"><code>#</code></a> operator. Next we map this list of empty lists to the table names we stored in <code>.u.t</code> creating a dictionary and finally we assign this dictionary to <code>.u.w</code> using a global variable assignment. As explained previously, <code>.u.w</code> keeps track of the handles of all real-time subscribers and the tables and symbols they subscribe to.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>You can also use <a href="https://code.kx.com/q/ref/get/#set" target="_blank" rel="noopener noreferrer"><code>set</code></a> to assign global variables and <a href="https://code.kx.com/q/ref/get/#get" target="_blank" rel="noopener noreferrer"><code>get</code></a> to access them.</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If you are following along this blog post, break the code down into each individual command. For example, you can split up above code into the following pieces:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)tables `.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`s#`quote`trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)count .u.t:tables `.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)0N!(count .u.t:tables `.)#()		// Note: 0N! is a helpful tool to output variables to the console, especially during debugging. The empty list () wouldn&#x27;t be printed otherwise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(();())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)0N!.u.t!(count .u.t::tables `.)#()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`s#`quote`trade!(();())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quote|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trade|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w::.u.t!(count .u.t::tables `.)#()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`s#`quote`trade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)0N!.u.w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`s#`quote`trade!(();())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quote|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trade|</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Observe each output in your console and inspect the content of <code>.u.t</code> and <code>.u.w</code> when you are done!</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="usub"><code>.u.sub</code><a href="#usub" class="hash-link" aria-label="Direct link to usub" title="Direct link to usub">​</a></h2>
<p><code>.u.sub</code> is the function utilized by real-time subscribers (e.g. Real-time Database) to subscribe to particular tables and symbols published by the Tickerplant. This function has the capability to add a subscription to a specific table when the corresponding table name is passed as a parameter. Alternatively, if an empty symbol is passed, it subscribes to all tables. It first ensures that the specified table is among the subscribable tables, then clears all existing subscriptions for the caller by invoking <code>.u.del</code>, and finally adds the new subscription using <code>.u.add</code>. This sequence helps prevent duplicate subscriptions. In the context of <code>.u.add</code>, the schemas of all tables are retrieved, which are then used to initialize the tables on the real-time subscriber.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Examples: 1. Subscribe to all tables and all symbols .u.sub[`;`]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//           2. Subscribe to specific tables and symbols .u.sub[`trade`quote;`AAPL`GOOG]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @param: 	x (symbol) 	- the table name to subscribe to, empty symbol ` for all tables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @param: 	y (symbolList) 	- list of symbols to subscribe to, empty symbol ` for all symbols</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @return:	A list of lists (to be more specific a list of pairs) is returned. Because .u.add returns a pair consisting of (`tableName;schema) and we invoke .u.add</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//		for every table, `.u.sub` returns a list of list (pairs) containing the name of each table and the corresponding schema.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//		((table1;schema1);(table2;schema2); ... ; (tableN;schemaN))	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.u.sub:{[x;y]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if[x~`;:.u.sub[;y] each .u.t];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if[not x in .u.t;&#x27;x];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .u.del[x].z.w;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .u.add[x;y]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We first check if the real-time subscriber wants to subscribe to all tables (empty symbol) and if so, we call <code>.u.sub</code> recursively for the symbols <code>y</code> they want to subscribe to. This will be invoked for all tables defined in <code>.u.t</code>. We do so by creating a projection on <code>.u.sub</code> and looping over every table name stored in <code>.u.t</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if[x~`;:.u.sub[;y] each .u.t];</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If the table the real-time subscriber wants to subscribe to is not in the list of subscribable tables we throw an error (<code>&#x27;</code> is used to throw errors)</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if[not x in .u.t;&#x27;x];</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next we call <code>.u.del</code> for the table <code>x</code> and the real time subscriber who called <code>.u.sub</code>. <code>.z.w</code> is the connection handle of the process which invoked the function, in this case the real-time subscriber. <code>.u.del</code> is a dyadic function which will remove all subscriptions for table<code> x</code> and subscriber <code>.z.w</code> if there exists one already.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.u.del[x].z.w;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Lastly we add a new subscription for table <code>x</code> and symbols <code>y</code>. This will add the details of the real time subscriber to <code>.u.w</code> the dictionary containing all details about real time subscribers and which tables they subscribe to.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.u.add[x;y]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>It is crucial that we omit the last semicolon after <code>.u.add[x;y]</code>. The semicolon suppresses the result of a function from being returned. In the case of <code>.u.add</code>, the result is a list of table names and their corresponding schemas. This information is used by the real-time subscriber to initialize the tables. Suppressing this result would be counterproductive as the real-time subscriber can&#x27;t initialise the tables they receive updates for.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="udel"><code>.u.del</code><a href="#udel" class="hash-link" aria-label="Direct link to udel" title="Direct link to udel">​</a></h2>
<p><code>.u.del</code> will remove an existing subscription for a specific real-time subscriber and the corresponding table within <code>.u.w</code>, the dictionary storing all information about real time subscribers. This is done to avoid duplicate subscriptions. <code>.u.del</code> is called within <code>.u.sub</code>, the function a real-time subscriber would call to subscribe to the Tickerplant</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// @param:	x (symbol) - the name of the table for which we need to remove the subscriber </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @param:	y (int)	   - the handle of the subscriber</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @return:	None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.u.del:{[x;y]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .u.w[x]_:.u.w[x;;0]?y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As evident, the <code>.u.del</code> function appears to consist of just a single line of code, but there&#x27;s more complexity beneath the surface. Let&#x27;s take a brief detour to delve into the drop operator <code>_</code>, the concept of eliding, and in-place assignment:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-drop-operator-_">The drop operator <code>_</code><a href="#the-drop-operator-_" class="hash-link" aria-label="Direct link to the-drop-operator-_" title="Direct link to the-drop-operator-_">​</a></h3>
<p>According to the official documentation <a href="https://code.kx.com/q/ref/drop/" target="_blank" rel="noopener noreferrer">here</a>, the drop operator <code>_</code>:<em>&quot;Drop items from a list, entries from a dictionary or columns from a table&quot;</em>. Like many other KDB/Q operators, the drop operator has multiple overloads depending on the input parameters. While a comprehensive explanation of all these overloads is beyond the scope of this blog post, I recommend exploring the various use cases of the drop operator as they can be quite useful. Let&#x27;s examine a specific use case: removing the i-th element from a list, which is precisely what we observe in <code>.u.del</code>:</p>
<p>Given a list of N elements, the below code will drop the ith element from the list</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)1 2 3 _ 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, he drop operator eliminated the element at index 1 from the list 1 2 3 and returned the updated list. Be sure to review the remaining use cases and grasp their functionalities.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="eliding">Eliding<a href="#eliding" class="hash-link" aria-label="Direct link to Eliding" title="Direct link to Eliding">​</a></h3>
<p><a href="https://code.kx.com/q4m3/3_Lists/#310-elided-indices" target="_blank" rel="noopener noreferrer">Eliding</a> is the concept of providing only a &quot;partial&quot; index when accessing data structures at depth. Let&#x27;s illustrate this important concept with an example. Consider the 4 by 4 matrix m:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)m:(1 2 3 4;10 20 30 40;100 200 300 400;1000 2000 3000 4000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1    2    3    4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10   20   30   40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">100  200  300  400</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1000 2000 3000 4000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If we want to access all elements of the first row we could use the following</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)m[0;0 1 2 3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 2 3 4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>In KDB/Q indexing starts at index 0</p></div></div>
<p>Nonetheless, this approach can be cumbersome and inefficient, especially when dealing with larger matrices that have numerous columns. For instance, if we have a matrix with 100 columns, would we need to write out all 100 indexes? This is where eliding becomes useful. We can achieve the same outcome by simply omitting the second index.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)m[0;]                 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 2 3 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Note: m[0] obtains the same result but for readability it&#x27;s better to add the ; making it clear that we are eliding the second index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)m[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 2 3 4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As described in <a href="https://code.kx.com/q4m3/3_Lists/#310-elided-indices" target="_blank" rel="noopener noreferrer">Q for Mortals</a>: <em>&quot;This indeed works because eliding an index in any slot is equivalent to specifying all legitimate indices for that slot.&quot;</em></p>
<p>Note, that if we wish to access only the second column of our matrix, we can do so using the following method:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)m[;1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 20 200 2000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Eliding is a versatile technique and extends to more than two dimensions. Let&#x27;s examine its use in the context of <code>.u.w</code>, which is utilized in our Tickerplant. This dictionary stores the handles of subscribers, tables they are subscribed to, and the symbols they have subscribed to.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w:`trade`quote!(((8;`);(9;`));((8;`);(9;`)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trade| 8 ` 9 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quote| 8 ` 9 `</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Suppose we have two real-time subscribers with handles 8 and 9, both subscribing to the tables <code>trade</code> and <code>quote</code> and all symbols. The dictionary <code>.u.w</code> represents this mapping. Now, let&#x27;s say you want to retrieve the list of pairs that represent all subscriber handles and the symbols they subscribe to for the <code>trade</code> table. How can you achieve this? Well, you can simply elide into the dictionary <code>.u.w</code> with <code>.u.w[`trade]</code>, resulting in the following output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w[`trade]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)0N!.u.w[`trade]      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">((8;`);(9;`))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 `</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, suppose we want only the first element from all pairs. How can we accomplish this? Given the list <code>((8;`);(9;`))</code>, which represents our intermediate result, we can simply elide the first index and use 0 as the second index. Eliding the first index is equivalent to selecting all elements at the first level.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)((8;`);(9;`))[;0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)((8;`);(9;`))[0 1;0]		// Eliding the first index is equivalent to selecting all elements at depth level 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Combining this knowledge, we can now retrieve the handles of all real-time subscribers that subscribe to table <code>trade</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w[`trade;;0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Eliding is an important and powerful concept, make sure you fully understand it and how to use it. You can find more details about it <a href="https://code.kx.com/q4m3/3_Lists/#310-elided-indices" target="_blank" rel="noopener noreferrer">here</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="assignment-in-place">Assignment in place<a href="#assignment-in-place" class="hash-link" aria-label="Direct link to Assignment in place" title="Direct link to Assignment in place">​</a></h3>
<p>If you are transitioning from another programming language such as Java or C++, you might be familiar with the concept of assignment in place. Assignment in place, or <a href="https://code.kx.com/q4m3/4_Operators/#46-amend" target="_blank" rel="noopener noreferrer">amend</a> how it&#x27;s referenced in KDB/Q, is essentially a way to achieve the same result with less code, providing a more concise syntax.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)a:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)a+:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)a:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)a:a+1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now we can return to our Tickerplant code and examine the <code>.u.del</code> function in detail</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.u.del:{[x;y]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .u.w[x]_:.u.w[x;;0]?y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We start again reading from the right and can see that our first operation involves find <code>?</code>. If you remember, <code>y</code> is the handle of the subscriber we are trying to remove from the dictionary and thus the operation <code>expression?y</code> is searching for the handle of the subscriber in the list on the left of the <code>?</code> operator. From the previous section, we know that</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w[`tablename;;0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w[`trade;;0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>will return all the handles of the real-time subscribers that subscribe to that particular table. In the above case, we retrieve all the handles of the subscribers of the <code>trade</code> table.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Even though find <code>?</code> only returns the index of the first element found, we don&#x27;t have to worry about this as there should be no duplication in the list of handles. If you need to search a list of non-unique elements be aware that find will only return the index of the first element.</p></div></div>
<p>Once we found the index of the handle of the real-time subscriber we want to remove from the dictionary, we use drop <code>_</code> to remove the element and re-assign the modified list to the key that matches table <code>x</code> in place. The entry for table <code>x</code> is thus updated and the real time subscriber has been removedi.</p>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w:`trade`quote!(((8;`);(9;`));((8;`);(9;`)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trade| 8 ` 9 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quote| 8 ` 9 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w[`trade] _ .u.w[`trade;;0]?9	// Removing handle 9 for table trade from the dictionary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 `</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="uadd"><code>.u.add</code><a href="#uadd" class="hash-link" aria-label="Direct link to uadd" title="Direct link to uadd">​</a></h2>
<p><code>.u.add</code> is the second function invoked by <code>.u.sub</code>. This function adds a new subscription for a real time subscriber by adding the handle of the subscriber and the table it subscribes to, to the dictionary <code>.u.w</code>. It then returns the empty schema of the table that has been subscribed to.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// @param:	x (symbol)	 	- the name of the table we want to subscribe to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @param:	y (symbolList)	- List of symbols we want to subscribe to. Empty symbol ` for all symbols</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @return:	List (pair)		- List containing the table name for which we added the subscription and the corresponding schema  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.u.add:{[x;y]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $[(count .u.w[x])&gt;i:.u.w[x;;0]?.z.w;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .[`.u.w;(x;i;1);union;y];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .u.w[x],:enlist(.z.w;y)];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (x;$[99=type v:value x;.u.sel[v]y;@[0#v;`sym;`g#]])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is the lengthiest function we&#x27;ve encountered thus far, and it&#x27;s the most extensive function in the <code>u.q</code> file. However, by dissecting each line into its constituent steps, we can gain a clear understanding of its operation.</p>
<p>We are already familiar with the first part of the code <code>.u.w[x;;0]?.z.w</code> as this is similar to what we have seen in <code>.u.del</code>. We retrieve the index of the real-time subscriber that invoked the function for a particular table <code>x</code>. Remember, <code>.z.w</code> is the connection handle of the process which called the function. We then store this index in variable <code>i</code> as we will use it later in the function.</p>
<p>Before we continue, let&#x27;s pause for a moment and observe what the find <code>?</code> operator returns when we are searching for an element that isn&#x27;t present in the list we searching in.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)1 2 3?2       // If the element we search for, is in the list, find will return its index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// However, if the element we&#x27;re searching for isn&#x27;t within the list, the find operator will return </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// count[list]+1, indicating the index at which the element would be appended</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)1 2 3?4       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Knowing this, we can establish two cases we check for:</p>
<ul>
<li><strong>Case 1</strong>: <code>(count .u.w[x])&gt;i</code> the length of the list of pairs for table <code>x</code> (established with <code>count .u.w[x]</code>), is larger than the index <code>i</code> returned by find. This means the handle of the real-time subscriber has been found within the list of pairs and is therefore already present</li>
<li><strong>Case 2</strong>: <code>(count .u.w[x])&gt;i</code> the length of the list of pairs for table <code>x</code> is smaller than the index <code>i</code>. This means that the handle isn&#x27;t present yet</li>
</ul>
<p>We can now use the conditional operator <code>$</code> (similar to an if-else statement) to action on these two cases:</p>
<p><strong>Case 1</strong>: If the handle of the subscriber is already there. We use amend to add the new symbols <code>y</code> we want to subscribe for table <code>x</code>, to the already existing ones. <strong>Note</strong>: Because <code>.u.w</code> is not a simple dictionary but its values are list of lists, we need to use the <code>.</code> version of amend using nested indexes. <strong>Remember</strong>: the list of pairs consists of (handle;symbols) elements, thus the symbols are at index 1, while handles are at index 0.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Using the nested index `(x;i;1)` we retrieve the symbols this particular subscriber is interested </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// in and create the union with the new symbols that we need to add. `i` contains the index of the </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// subscriber in the list of pairs for the table `x`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.[`.u.w;(x;i;1);union;y]		</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s illustrate above with an example.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Recreate .u.w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w:`trade`quote!(((8;`GOOG`APPL);(9;`MSFT`GS));((10;`IBM`TSLA);(11;`C`NVDA)))	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trade| 8 `GOOG`APPL 9 `MSFT`GS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quote| 10 `IBM`TSLA 11 `C`NVDA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Assume we are interested in subscriber at index 1 for table `trade. This retrieves all </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// symbols they currently subscribe to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w[`trade;1;1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`MSFT`GS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Append two new symbols to the symbols already subscribed to.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).[`.u.w;(`trade;1;1);union;`GOOG`APPL]		</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trade| 8 `GOOG`APPL         9 `MSFT`GS`GOOG`APPL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quote| 10 `IBM`TSLA         11 `C`NVDA</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Case 2</strong>: The subscriber is not yet present in <code>.u.w</code>. In this case we simply have to add the new entry to the enties already present for table <code>x</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// We are using `enlist` to create a singleton list of a pair containing the handle of the subscriber </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// .z.w and the symbols they want to subscribe to and add it to the already existing list for table x </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.u.w[x],:enlist (.z.w;y)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The last remaining step is to return a pair consisting of the table name x and an empty schema.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Nevertheless, there is one section of the code that remains somewhat unclear to me. In the conditional evaluation, we verify whether the table is a keyed table. However, the tables in the Tickerplant are normal tables and not keyed. I haven&#x27;t encountered a production system where the Tickerplant stores keyed tables.</p></div></div>
<p>Below code creates a tuple/pair consisting of <code>x</code> the table name and an expression that will evaluate to the schema of the corresponding table. Let&#x27;s have a look at it:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(x;$[99=type v:value x;.u.sel[v]y;@[0#v;`sym;`g#]])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The first part of the tuple is straightforward, it&#x27;s simply the table name. The second part is a conditional evaluation. Because <code>x</code> only contains the symbol name of the table, we first have to apply <code>value</code> to it in order to retrieve the actual content of the table. We then check if the type of this data is 99, which corresponds to a keyed table. I have never seen a Tickerplant that processes keyed tables, so this evaluation should be always false. However, in case this evaluates to true, we apply the <code>.u.sel</code> function to the data we stored in <code>v</code> for the symbols <code>y</code> and return the result.
For the case the table isn&#x27;t keyed (this should be always the case) we return the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@[0#v;`sym;`g#]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We first take 0 rows from the data stored in <code>v</code> using <code>0#v</code>. This basically creates an empty table. We then use this construct in combination with the apply at <code>@</code> operator to apply the grouped attribute <code>g</code> to the <code>sym</code> column. If you are not familiar with with the behaviour of <strong>Apply At</strong> you can have a read <a href="https://code.kx.com/q/ref/apply/#apply-at-index-at" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="usel"><code>.u.sel</code><a href="#usel" class="hash-link" aria-label="Direct link to usel" title="Direct link to usel">​</a></h2>
<p>This function is responsible for extracting a specific set of rows from a table using a list of symbols. It is used within both <code>.u.add</code> and <code>.u.pub</code> to fetch the subset of rows corresponding to the symbols that a real-time subscriber is interested in.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// @param:		x (table)		- the data we want to select from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @param:		y (symbolList)	- the list of symbols we are interested in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @return: 	A table containing the relevant data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.u.sel:{[x;y]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $[`~y;x;select from x where sym in y]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This function is another one-liner and is relatively straight forward. We first distinguish whether the real-time subscriber is interested in all symbols, passing the empty symbol <code>`</code> to the function, or in a specific list of symbols. In the former case, the function returns the complete data stored in parameter <code>x</code>. In the latter case, where the subscriber is only interested in a specific subset of symbols, the function uses q-sql to retrieve the relevant data and returns it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="upub"><code>.u.pub</code><a href="#upub" class="hash-link" aria-label="Direct link to upub" title="Direct link to upub">​</a></h2>
<p>This function publishes all relevant data to the interested real-time subscribers and is used within <code>.z.ts</code>, if the Tickerplant runs in batch mode on a timer, or within <code>.u.upd</code> if the Tickerplant publishes every incoming row straight away.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// @param:	x (symbol)	- the table name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @param:	y (table)	- the corresponding data stored in table x at the time of publishing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @return:	None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.u.pub:{[t;x]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {[t;x;w] if[count x:.u.sel[x] w 1;(neg first w)(`upd;t;x)]}[t;x] each .u.w[t]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>While <code>.u.pub</code> is a concise function, it involves multiple steps. It starts by creating a projection of a three-parameter anonymous function. This effectively fixes the parameters <code>t</code> and <code>x</code>, which denote the table name and the actual data.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Create a projecton of a triadic function fixing the first two parameters.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{[t;x;w] ... }[t;x]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We proceed by iterating through each pair, which consists of the subscriber handle and the list of symbols they are interested in for the table <code>t</code> we aim to publish data for, involing the anonymous function.</p>
<p>Inside the lambda function, we initially confirm the data&#x27;s relevance to the subscriber by fetching the symbols of interest for that subscriber (stored in <code>w 1</code>). We then combine this list of symbols with the data and pass it to <code>.u.sel</code>, which will provide us with the relevant data. If there is any data available for publishing, we do so asynchronously to the real-time subscriber.</p>
<p>We send an asynchronous message by utilizing the negative handle of the real-time subscriber. The data is sent in the form of a parse tree where the first element of the parse tree represents the function to be called on the real-time subscriber, and the subsequent elements are the parameters passed to that function. In our context, we invoke the <code>update</code> function <code>upd</code> on the subscriber, with <code>t</code> as the table name and <code>x</code> as the data to be inserted. It is important to note that the <code>upd</code> function must be defined on the real-time subscriber; otherwise, an error will be thrown on the real-time subscriber.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Send the data asynchronously to the real time subscriber</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(neg first x)(`upd;t;x)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Communication between the Tickerplant and the real-time subscriber should always be asynchronous when publishing data. Not only do we not need a response from the real-time subscriber (we don&#x27;t really care whether the real-time subscriber received the message or not) but we avoid waiting for a response from the real-time subscriber to prevent potential delays and the risk of the Tickerplant crashing, which can occur with synchronous messaging</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="uend"><code>.u.end</code><a href="#uend" class="hash-link" aria-label="Direct link to uend" title="Direct link to uend">​</a></h2>
<p><code>.u.end</code> sends an asynchronous message to all real time subscribers invoking their <code>.u.end</code> function at the end of the day. It is triggered within the <code>.u.endofday</code> function of the Tickerplant.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// @param:	x (date) - the date of the day that just ended, basically yesterday&#x27;s date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// @return:	None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.u.end:{ (neg union/[w[;;0]])@\:(`.u.end;x) }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This concise function, although just a single line, covers various significant KDB/Q concepts, including iterators, eliding, asynchronous IPC, and parse trees.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parse-trees">Parse trees<a href="#parse-trees" class="hash-link" aria-label="Direct link to Parse trees" title="Direct link to Parse trees">​</a></h3>
<p>Starting from the right, we first encounter a parse tree. The expression <code>(`.u.end;x)</code> represents a parse tree that, upon evaluation, will trigger the <code>.u.end</code> function with the parameter <code>x</code>. If you are not familiar with parse trees, I encourage you to read this very informative <a href="https://code.kx.com/q/wp/parse-trees/" target="_blank" rel="noopener noreferrer">whitepaper</a>. In simple terms, a parse tree is a list containing a function, which could be in the form of an anonymous lambda function or the name of a function if it&#x27;s defined within the process. It is followed by a list of parameters that serve as arguments for the function. A straightforward example would be:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)value (+;2;2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)value ({x*y};2;2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="each-left">Each-left<a href="#each-left" class="hash-link" aria-label="Direct link to Each-left" title="Direct link to Each-left">​</a></h3>
<p>The function then employs an each-left operation in conjunction with apply to execute the given parse tree on each element of the left expression. Each-left is one of the eight Iterators, which were previously referred to as Averbs. You can find a more in-depth explanation of iterators <a href="https://code.kx.com/q/basics/iteration/" target="_blank" rel="noopener noreferrer">here</a>. Let me illustrate how each-left functions with the following example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)&quot;ABC&quot;,\:&quot;XY&quot;		// We apply the whole list of characters &quot;XY&quot; to each element on the left</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;AXY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;BXY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;CXY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// In comparison, each-right, applies the whole list of characters &quot;ABC&quot; to each element on the right</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q)&quot;ABC&quot;,/:&quot;XY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;ABCX&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;ABCY&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s now have a look at the expression on the left:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(neg union/[w[;;0]])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We come across another iterator in the code. First, we extract all the handles of real-time subscribers by using elide operations on the dictionary containing subscriber information. By omitting the first index, we access all the details for all tables initially. Then, by excluding the second index, we obtain all pairs in the form of <code>(handle; symbolList)</code>, and finally, by accessing elements at index 0, we effectively retrieve all the handles.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w:`trade`quote!(((8;`);(9;`));((10;`);(11;`)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trade| 8 `  9 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quote| 10 ` 11 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q).u.w[;;0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trade| 8  9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quote| 10 11</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We subsequently employ the Iterator <code>Over /</code> in conjunction with the <code>union</code> operator to obtain the union of all the handles. Like many KDB/Q operators, <code>Over</code> has multiple overloads. In this particular scenario, <code>Over</code> functions as an accumulator. For a comprehensive understanding of <code>Over</code>, you can refer to the documentation linked <a href="https://code.kx.com/q/ref/accumulators/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)union/[.u.w[;;0]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 9 10 11</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, we apply the <code>neg</code> operator to negate all the handles, as we intend to send an asynchronous message.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">q)(neg union/[.u.w[;;0]])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-8 -9 -10 -11</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To recap, we send an asynchronous message to all real-time subscribers, triggering the execution of their <code>.u.end</code> function with the current date as the parameter.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(neg union/[w[;;0]])@\:(`.u.end;x)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We have now completed the detailed exploration of all the functions in the <code>u.q</code> file. We&#x27;ve covered a substantial amount of material up to this point. Let&#x27;s take a brief pause for reflection and review what we&#x27;ve learned so far. This will allow you to consolidate your understanding of the topics we&#x27;ve covered before we proceed to delve into the remaining code of our Tick system. Stay tuned for more insights!</p>
<p>Happy Coding!</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/tutorials"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tutorials</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tutorials/tick2"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">KDB Tick Explained: A Walkthrough [PART 2]</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-tickerplant-core-tickq" class="table-of-contents__link toc-highlight">The Tickerplant Core <code>tick.q</code></a></li><li><a href="#helper-functions---uq" class="table-of-contents__link toc-highlight">Helper Functions - <code>u.q</code></a></li><li><a href="#the-real-time-database-rdb-code---rq" class="table-of-contents__link toc-highlight">The Real-Time Database (RDB) code - <code>r.q</code></a></li><li><a href="#kdbq-tick-demystified" class="table-of-contents__link toc-highlight">KDB/Q Tick demystified</a></li><li><a href="#global-variables" class="table-of-contents__link toc-highlight">Global variables</a></li><li><a href="#walkthrough" class="table-of-contents__link toc-highlight">Walkthrough</a><ul><li><a href="#the-symq-file" class="table-of-contents__link toc-highlight">The <code>sym.q</code> file</a></li></ul></li><li><a href="#uq-helper-functions" class="table-of-contents__link toc-highlight"><code>u.q</code> Helper functions</a></li><li><a href="#uinit" class="table-of-contents__link toc-highlight"><code>.u.init</code></a></li><li><a href="#usub" class="table-of-contents__link toc-highlight"><code>.u.sub</code></a></li><li><a href="#udel" class="table-of-contents__link toc-highlight"><code>.u.del</code></a><ul><li><a href="#the-drop-operator-_" class="table-of-contents__link toc-highlight">The drop operator <code>_</code></a></li><li><a href="#eliding" class="table-of-contents__link toc-highlight">Eliding</a></li><li><a href="#assignment-in-place" class="table-of-contents__link toc-highlight">Assignment in place</a></li></ul></li><li><a href="#uadd" class="table-of-contents__link toc-highlight"><code>.u.add</code></a></li><li><a href="#usel" class="table-of-contents__link toc-highlight"><code>.u.sel</code></a></li><li><a href="#upub" class="table-of-contents__link toc-highlight"><code>.u.pub</code></a></li><li><a href="#uend" class="table-of-contents__link toc-highlight"><code>.u.end</code></a><ul><li><a href="#parse-trees" class="table-of-contents__link toc-highlight">Parse trees</a></li><li><a href="#each-left" class="table-of-contents__link toc-highlight">Each-left</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Learn</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/defconq/" target="_blank" rel="noopener noreferrer" class="footer__link-item">DefconQ Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/alexanderunterrainer/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Alexander Unterrainer Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://defconq.myspreadshop.co.uk" target="_blank" rel="noopener noreferrer" class="footer__link-item">DefconQ Swag<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://www.youtube.com/@DefconQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube Channel<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://defconq.substack.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Substack Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://medium.com/@defconq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/DefconQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 DefconQ Ltd. This website is maintained by Alexander Unterrainer. Disclaimer: All content shared on this website reflect solely his personal thoughts and opinions, and is not representative of any past, current, or future employers or affiliations.</div></div></div></footer></div>
</body>
</html>